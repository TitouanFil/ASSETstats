---
title: "Report_AE_Vietnam"
author: "Titouan"
date: "2023-07-06"
output:
  word_document:
    toc: yes
  html_document:
    df_print: paged
    toc: yes
    theme: united
---
# Introduction

The following data were collected following surveys conducted in 2023 in Cambodia, Laos and Vietnam as part of the ASSET project.

Additional information:

- NC answers stand for "Not Concerned", meaning that the question was not asked of household members because they were not concerned (e.g. livestock questions were not asked of households without livestock).

- NA answers correspond to "No Answer", meaning that the household did not answer this question by choice or omission on the part of the interviewer.

# I. Cambodia
```{r I, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis'}
##1.1 Packages loading and data import
#Packages loading
library(haven)
library(expss)
library(dplyr)
library(labelled)
library(foreign)
library(sjlabelled)
library(stringr)
library(tidyr)
library(plyr)
library(reshape2)
library(ggplot2)
library(wesanderson)
library(paletteer)
library(RColorBrewer)
library(ggthemes)
library(survey)
library(ggrepel)
library(haven)
library(expss)
#dta format (from Ky) datasets import
setwd("C:/Users/titou/OneDrive/Bureau/ASSET Stats/WORKDIRECTORY/1.ASSET_data_cleaning-Titouan/ASSET_data_cleaning")
#We import all the dta files transmitted by Ky as *Cambodia* database
HouseholdCambodia_2C <- readRDS("HouseholdCambodia_2C.rds")
ClowlandCambodia_2C <- readRDS("ClowlandCambodia_2C.rds")
CuplandCambodia_2C <- readRDS("CuplandCambodia_2.rds")
HouMemberCambodia_2C <- readRDS("HouMemberCambodia_2C.rds")

#
colnames(HouseholdCambodia_2C)[29] <- "commune_eng"

##1.2 - Preparation of functions and data

# # #1.2.a. YES, NO, DNK, NA  PIE PLOT
PiePlotYN <- function(data,list){
  #Changing the index by real answers:
  data$d <- list
  # Preparation of the plot
  # Compute percentages
  data$fraction <- data$n / sum(data$n)
  # Compute the cumulative percentages (top of each rectangle)
  data$ymax <- cumsum(data$fraction)
  # Compute the bottom of each rectangle
  data$ymin <- c(0, head(data$ymax, n=-1))
  # Compute label position
  data$labelPosition <- (data$ymax + data$ymin) / 2
  # Compute a good label
  data$label <- paste0(data$d, "\n", round(data$fraction*100, digits = 1), "%")
  #Prepare the color list
  col <- c("forestgreen","darkolivegreen2","lightblue","grey88")
  # Make the plot
  plot <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=d)) +
    geom_rect(fill = col[1:nrow(data)],colour = "black") +
    geom_label_repel( x=3.5, aes(y=labelPosition, label=label), size= 4, fill = col[1:nrow(data)]) +
    coord_polar(theta="y") +
    xlim(c(2, 4)) +
    theme_void() +
    theme(plot.title = element_text(hjust = 0.5, size = 13), legend.position = "none") +
    ggtitle(paste("Sample =", round(sum(data$n)/3.97, digits = 0), "/  Population = ",sum(data$n)))
  print(plot)
}

# # #1.2.b. ADAPTATIVE PIE PLOT
PiePlot <- function(data,list){
  #Changing the index by real answers:
  data$d <- list
  # Preparation of the plot
  # Compute percentages
  data$fraction <- data$n / sum(data$n)
  # Compute the cumulative percentages (top of each rectangle)
  data$ymax <- cumsum(data$fraction)
  # Compute the bottom of each rectangle
  data$ymin <- c(0, head(data$ymax, n=-1))
  # Compute label position
  data$labelPosition <- (data$ymax + data$ymin) / 2
  # Compute a good label
  data$label <- paste0(data$d, "\n", round(data$fraction*100, digits = 1), "%")
  #Prepare the color list
  col <- c("#0066CC","lightblue","grey88")
  # Make the plot
  plot <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=d)) +
    geom_rect(fill = col[1:nrow(data)],colour = "black") +
    geom_label_repel( x=3.5, aes(y=labelPosition, label=label), size=4, fill = col[1:nrow(data)]) +
    coord_polar(theta="y") +
    xlim(c(2, 4)) +
    theme_void() +
    theme(plot.title = element_text(hjust = 0.5, size = 13), legend.position = "none") +
    ggtitle(paste("Sample =", round(sum(data$n)/3.97, digits = 0), "/  Population = ",sum(data$n)))
  print(plot)
}

# # #1.2.c. List PLOT
ListBPlot <- function(data,list,pond,xT,ylimn,dig){
  colnames(data)[1] <- 'Answer'
  data$Answer <- list
  #We convert absolute values to % y divinding by the total number of households
  data$Percentage_of_households <- round(data$n/as.numeric(pond)*100, digits=dig)
  #And now a distribution plot
  Plota <- ggplot(data=data, aes(x= reorder(Answer, -Percentage_of_households), y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=9, angle = 85),
          legend.position = "none")+
    labs(x= xT)+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(ylimn,max(data$Percentage_of_households)+20)+
    ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plota)
}

# # #1.2.d. List PLOT without order
ListBPlotNO <- function(data,list,pond,xT,ylimn,dig){
  colnames(data)[1] <- 'Answer'
  data$Answer <- list
  #We convert absolute values to % y divinding by the total number of households
  data$Percentage_of_households <- round(data$n/as.numeric(pond)*100, digits=dig)
  #And now a distribution plot
  Plota <- ggplot(data=data, aes(x= reorder(Answer, Answer), y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=9, angle = 85),
          legend.position = "none")+
    labs(x= xT)+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(ylimn,max(data$Percentage_of_households)+20)+
    ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plota)
}

# # #1.2.e. List PLOT with Commune information (as x)
ListBPlotProv <- function(data,pond,ylimn,dig,pal){
  dcount <- data
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ commune_eng, data=HouseholdCambodia_2C, sum)
  dcount <- join(dcount, provtot, by = "commune_eng")
  colnames(dcount)[4] <- "nbHHtot"
  dcount$Percentage_of_households <- round(dcount$n/as.numeric(dcount$nbHHtot)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcount)/2
  mycolors <- colorRampPalette(brewer.pal(9,pal))(nb.cols)
  #And now a distribution plot
  plotb <- ggplot(data=dcount, aes(x= `commune_eng`, y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9), size = 3)+
    ylim(ylimn, max(dcount$Percentage_of_households)+20)+
    scale_fill_manual(values = mycolors)+
    theme_stata(base_size = 9)+
    theme(legend.title=element_blank())+
    ggtitle(paste("Reaksmei comm.: S =",round(pond*0.2/3.97,digits = 0), "/ P =", round(pond*0.2,digits = 0) ,
                  " - Rik Reay comm.: S = ",round(pond*0.25/3.97,digits = 0), "/ P =", round(pond*0.25,digits = 0),
                  "\n Rohas comm.: S = ",round(pond*0.25/3.97,digits = 0), "/ P =", round(pond*0.25,digits = 0),
                  " - Rous Ran comm.: S = ",round(pond*0.3/3.97,digits = 0), "/ P =", round(pond*0.3,digits = 0)))
  print(plotb)
}

# # #1.2.f. List PLOT with Commune information (as x)
ListBPlotProvYN <- function(data,pond,ylimn,dig,pal){
  dcount <- data
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ commune_eng, data=HouseholdCambodia_2C, sum)
  dcount <- join(dcount, provtot, by = "commune_eng")
  colnames(dcount)[4] <- "nbHHtot"
  dcount$Percentage_of_households <- round(dcount$n/as.numeric(dcount$nbHHtot)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcount)
  mycolors <- colorRampPalette(brewer.pal(9,pal))(nb.cols)
  #And now a distribution plot
  plotb <- ggplot(data=dcount, aes(x= `commune_eng`, y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",position="stack", stat="identity")+
    geom_text(aes(label = Percentage_of_households), position = position_stack(vjust = .5), size = 3)+
    scale_fill_manual(values = mycolors)+
    theme_stata(base_size = 9)+
    theme(legend.title=element_blank())+
    ggtitle(paste("Reaksmei comm.: S =",round(pond*0.2/3.97,digits = 0), "/ P =", round(pond*0.2,digits = 0) ,
                  " - Rik Reay comm.: S = ",round(pond*0.25/3.97,digits = 0), "/ P =", round(pond*0.25,digits = 0),
                  "\n Rohas comm.: S = ",round(pond*0.25/3.97,digits = 0), "/ P =", round(pond*0.25,digits = 0),
                  " - Rous Ran comm.: S = ",round(pond*0.3/3.97,digits = 0), "/ P =", round(pond*0.3,digits = 0)))
  print(plotb)
}

# # #1.2.g. PRACTICES PLOT
PracticePlot <- function(data,pond,pond2,xT,ylimn,ylimx,dig,pal){
  #Then we adapt the format to be able to plot it and create a table
  dmelt <- melt(data ,  id.vars = c('o9', 'commune_eng','village_eng_preload','fpc','Weight'), variable.name = 'Practices')
  dstratb <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Practices+value, design=dstratb, exclude=NULL))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcountNAR <- dcount %>%  filter(!is.na(Answer) & Answer != '' & Answer != 0)
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcountNAR)
  mycolors <- colorRampPalette(brewer.pal(8, pal))(nb.cols)
  #And now a distribution plot
  plota <- ggplot(data=dcountNAR, aes(x=reorder(Practices, -Percentage_of_households), y=Percentage_of_households, fill = Practices))+
    geom_bar(colour="black",stat="identity")+
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8,angle = 60), legend.position = "none")+
    geom_text(aes(label = Percentage_of_households, vjust = -1)) + ylim(ylimn, ylimx)+
    scale_fill_manual(values= mycolors)+
    labs(x= xT)+
    ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))
  print(plota)
  
  # # # #b.b Plot with Communes and total %
  #We create a counting table
  dcount <- as.data.frame(svytable(~commune_eng+Practices+value, design=dstratb, exclude=NULL))
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != '' & value != 0)
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ commune_eng, data=HouseholdCambodia_2C, sum)
  dcountNAR <- join(dcountNAR, provtot, by = "commune_eng")
  colnames(dcountNAR)[4] <- "n"
  colnames(dcountNAR)[5] <- "nbHHtot"
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(dcountNAR$nbHHtot)*100, digits=dig)
  #And now a distribution plot
  plotb <- ggplot(data=dcountNAR, aes(x=reorder(Practices, -Percentage_of_households), y=Percentage_of_households, fill = `commune_eng`))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    theme_stata(base_size = 9)+
    theme(axis.text.x = element_text(size=8,angle = 60),legend.title=element_blank())+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9), size = 3)+
    ylim(ylimn, ylimx)+
    scale_fill_brewer(palette= pal, direction = -1)+
    labs(x= xT)+
    ggtitle(paste("Reaksmei comm.: S =",round(pond2*0.2/3.97,digits = 0), "/ P =", round(pond2*0.2,digits = 0) ,
                  " - Rik Reay comm.: S = ",round(pond2*0.25/3.97,digits = 0), "/ P =", round(pond2*0.25,digits = 0),
                  "\n Rohas comm.: S = ",round(pond2*0.25/3.97,digits = 0), "/ P =", round(pond2*0.25,digits = 0),
                  " - Rous Ran comm.: S = ",round(pond2*0.3/3.97,digits = 0), "/ P =", round(pond2*0.3,digits = 0)))
  print(plotb)
}

# # #1.2.h. PRACTICES PLOT FOR MONTHS
Monthplot <- function(data,pond,pond2,xT,ylimn,ylimx,dig,pal){
  #Then we adapt the format to be able to plot it and create a table
  dmelt <- melt(data ,  id.vars = c('o9', 'commune_eng','village_eng_preload','fpc','Weight'), variable.name = 'Practices')
  dstratb <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Practices+value, design=dstratb, exclude=NULL))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcountNARa <- dcount %>%  filter(!is.na(Answer) & Answer != 0)
  #We convert absolute values to % y divinding by the total number of households
  dcountNARa$Percentage_of_households <- round(dcountNARa$n/as.numeric(pond)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcountNARa)
  mycolors <- colorRampPalette(brewer.pal(8, pal))(nb.cols)
  #And now a distribution plot
  plota <- ggplot(data=dcountNARa, aes(x=Practices, y=Percentage_of_households, fill = Practices))+
    geom_bar(colour="black",stat="identity")+
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8,angle = 60), legend.position = "none",
          panel.grid.major=element_line(colour="grey"))+
    geom_text(aes(label = Percentage_of_households, vjust = -1)) + ylim(ylimn, ylimx)+
    scale_fill_manual(values= mycolors)+
    labs(x= xT)+
    ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))
  print(plota)
  
  # # # #b.b Plot with Communes and total %
  #We create a counting table
  dcount <- as.data.frame(svytable(~commune_eng+Practices+value, design=dstratb, exclude=NULL))
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != 0)
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ commune_eng, data=HouseholdCambodia_2C, sum)
  dcountNAR <- join(dcountNAR, provtot, by = "commune_eng")
  colnames(dcountNAR)[4] <- "n"
  colnames(dcountNAR)[5] <- "nbHHtot"
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(dcountNAR$nbHHtot)*100, digits=dig)
  #And now a distribution plot
  plotb <- ggplot(data=dcountNAR, aes(x=Practices, y=Percentage_of_households, fill = `commune_eng`))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8,angle = 60),legend.title=element_blank())+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9), size = 3)+
    ylim(ylimn, ylimx)+
    scale_fill_brewer(palette= pal, direction = -1)+
    labs(x= xT)+
    ggtitle(paste("Reaksmei comm.: S =",round(pond2*0.2/3.97,digits = 0), "/ P =", round(pond2*0.2,digits = 0) ,
                  " - Rik Reay comm.: S = ",round(pond2*0.25/3.97,digits = 0), "/ P =", round(pond2*0.25,digits = 0),
                  "\n Rohas comm.: S = ",round(pond2*0.25/3.97,digits = 0), "/ P =", round(pond2*0.25,digits = 0),
                  " - Rous Ran comm.: S = ",round(pond2*0.3/3.97,digits = 0), "/ P =", round(pond2*0.3,digits = 0)))
  print(plotb)
}

# # #1.2.I. CROP PLOT (big or small tables)
#For this function, we should use a database including column with household id 
#+ 11 columns with binary values for each crops
CropPlot <- function(data,pond, ylimn,ylimx,dig){
  #We replace binary values by crop names
  for (i in 3:13){
    data[,i] <- as.character(data[,i])
    for (j in 1:595){
      data[j,i] <- ifelse(data[j,i] == '1', dcrops[j,i], data[j,i])
    }
  }
  # We melt data frame into long format
  dmelt <- melt(data, id.vars = c("o9","village_eng_preload","fpc","Weight"))
  dmelt <- dmelt %>%  filter(!is.na(o9))
  # SVy design implementation
  dstrate <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  #We count the answers and filter NA and "no" values
  dcount <- as.data.frame(svytable(~value, design=dstrate, exclude=NULL))
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != 0 & value != 1)
  colnames(dcountNAR)[2] <- "n"
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=dig)
  #We order the table
  dcountNAR <- dcountNAR[order(-dcountNAR$Percentage_of_households), ]
  if (nrow(dcountNAR) > 15){
    dcountNARa <- dcountNAR[1:as.numeric(nrow(dcountNAR)/2),]
    dcountNARb <- dcountNAR[as.numeric((nrow(dcountNAR)/2+1)):as.numeric(nrow(dcountNAR)),]
    #And now a distribution plot
    Plota <- ggplot(data=dcountNARa, aes(x= reorder(value, -Percentage_of_households), y=Percentage_of_households, fill = value))+
      geom_bar(colour="black",stat="identity") +
      theme_stata(base_size = 9)+
      theme(axis.text.x = element_text(size=9, angle = 85), legend.position = "none"
            , axis.title.x = element_blank())+
      geom_text(aes(label = Percentage_of_households, vjust = -1))+
      ylim(ylimn,ylimx)+
      ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))+
      scale_fill_viridis_d(alpha = 1,
                           begin = 0,
                           end = 1,
                           direction = 1,
                           option = "E",
                           na.value = "grey50",
                           guide = "colourbar",
                           aesthetics = "fill")
    print(Plota)
    #2nd plot
    Plotb  <- ggplot(data=dcountNARb, aes(x= reorder(value, -Percentage_of_households), y=Percentage_of_households, fill = value))+
      geom_bar(colour="black",stat="identity") +
      theme_stata(base_size = 8)+
      theme(axis.text.x = element_text(size=9, angle = 85), legend.position = "none", 
            axis.title.x = element_blank())+
      geom_text(aes(label = Percentage_of_households, vjust = -1))+
      ylim(ylimn,ylimx)+
      ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))+
      scale_fill_viridis_d(alpha = 1,
                           begin = 0,
                           end = 1,
                           direction = 1,
                           option = "E",
                           na.value = "grey50",
                           guide = "colourbar",
                           aesthetics = "fill")
    print(Plotb)} else {
      #And now a distribution plot
      Plota <- ggplot(data=dcountNAR, aes(x= reorder(value, -Percentage_of_households), y=Percentage_of_households, fill = value))+
        geom_bar(colour="black",stat="identity") +
        theme_stata(base_size = 8)+
        theme(axis.text.x = element_text(size=9, angle = 85), legend.position = "none"
              , axis.title.x = element_blank())+
        geom_text(aes(label = Percentage_of_households, vjust = -1))+
        ylim(ylimn,ylimx)+
        ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))+
        scale_fill_viridis_d(alpha = 1,
                             begin = 0,
                             end = 1,
                             direction = 1,
                             option = "E",
                             na.value = "grey50",
                             guide = "colourbar",
                             aesthetics = "fill")
      print(Plota)
      
    }
}

# # #1.2.j. ANIMAL PLOT
AnimalPlot <- function(data,pond){
  data[,3] <- as.character(data[,3])
  colnames(data)[2] <- "Animal"
  for (j in 1:594){
    data[j,3] <- ifelse(data[j,3] == 1, data[j,2], data[j,3])
  }
  data$Animal <- ifelse(is.na(data$Animal), '', data$Animal)
  #We count the answers and filter NA and "no" values
  dstratAn <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = data)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Animal, design=dstratAn, exclude=NULL))
  colnames(dcount)[2] <- "n"
  dcountNAR <- dcount %>%  filter(Animal != 0 & Animal != '')
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=1)
  #We order the table
  dcountNAR <- dcountNAR[order(-dcountNAR$Percentage_of_households), ]
  #And now a distribution plot
  Plota <- ggplot(data=dcountNAR, aes(x= reorder(Animal, -Percentage_of_households), y=Percentage_of_households, fill = Animal))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8, angle = 85), legend.position = "none", 
          axis.title.x = element_blank())+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(-10,max(dcountNAR$Percentage_of_households)+20)+
    ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plota)
}

# # #1.3 Preparation of Crops reference table
{
  #First we turn upland and lowland data to wide format (Duplicate alert = Normal,
  #we had no time to take care of it yet)
  dlowc <- ClowlandCambodia_2C[,c(2:3,10)]
  dlowcwide <- reshape(dlowc, direction = "wide", timevar = "crop1_now", idvar = "hhid_re2")
  dlowcwide <- dlowcwide %>% relocate(d2_13e.2 , .before = d2_13e.3)
  dlowcwide <- dlowcwide %>% relocate(d2_13e.4 , .before = d2_13e.5)
  dlowcwide <- dlowcwide %>% relocate(d2_13e.6 , .after = d2_13e.5)
  dupc <- CuplandCambodia_2C[,c(2:3,9)]
  colnames(dupc)[colnames(dupc) == "hhid_re3"] ="hhid_re2"
  dupcwide <- reshape(dupc, direction = "wide", timevar = "crop2_now", idvar = "hhid_re2")
  #We create a table with all the id
  HHid <- HouseholdCambodia_2C[,1:2]
  colnames(HHid)[colnames(HHid) == "o9"] = "hhid_re2"
  #We merge the tables
  dcrops <- merge(HHid, dlowcwide, by.x= "hhid_re2", all = T)
  dcrops <- merge(dcrops, dupcwide, by.x = "hhid_re2", all = T)
  #And we remove useless columns
  dcrops <- dcrops[,-c(2,8)]
  x <- HouseholdCambodia_2C[,c(1,2)]
  colnames(x)[1] <- "hhid_re2"
  dcrops <- join(x,dcrops,by = "hhid_re2", match = "first")
  # #Additionnal stuffs
  #We convert data to the proper format
  dlowc$d2_13e <- as.factor(dlowc$d2_13e)
  dupc$d2_23e <- as.factor(dupc$d2_23e)
  #We create a column including the information if the household is growing crops or no
  HouseholdCambodia_2C$CropYN <- ifelse(is.na(HouseholdCambodia_2C$no_crop1) & is.na(HouseholdCambodia_2C$no_crop2), '0', '1')
}

# # #Preparation of household head table and related stuff
{
  Commune <- cbind(as.character(HouseholdCambodia_2C$o9),as.character(HouseholdCambodia_2C$commune_eng))
  HouMemberProv <- merge(Commune, HouMemberCambodia_2C, by.x = "V1", by.y = "hhid_re1")
  HouHead <- HouMemberProv[HouMemberProv$a2 == '1',]
  HouHead <- copy_labels(HouHead, HouMemberCambodia_2C)
  colnames(HouMemberProv)[1:2] <- c("o9","Commune")
  colnames(HouHead)[1:2] <- c("o9","Commune")
  #We add HH information to the main table
  HouseholdCambodia_2C <- join(HouseholdCambodia_2C, HouHead, by = "o9", match = "first")
  
  #Also, we create a categorical variable with age range instead of quantitative value
  HouseholdCambodia_2C$AgeCat <- cut(HouseholdCambodia_2C$a4_1,
                                     breaks=c(20,30, 35, 40, 45, 50, 55, 60, 65, 70,100),
                                     labels=c('<30', '30-34', '35-39', '40-44','45-49','50-54',
                                              '55-59','60-64','65-69','>69'))
}

# # #Preparation of other columns
{
  #Other changes
  HouseholdCambodia_2C$o11 <- ifelse(HouseholdCambodia_2C$o10 == '1','3',HouseholdCambodia_2C$o11)
  #For some columns, we just add NA as factor level to include it to the tables then
  HouseholdCambodia_2C$a3 <- factor(HouseholdCambodia_2C$a3, exclude=NULL)
  HouseholdCambodia_2C$AgeCat <- factor(HouseholdCambodia_2C$AgeCat, exclude=NULL)
  HouseholdCambodia_2C$a6 <- factor(HouseholdCambodia_2C$a6, exclude=NULL)
  HouseholdCambodia_2C$d17 <- factor(HouseholdCambodia_2C$d17, exclude=NULL)
  HouseholdCambodia_2C$d20 <- factor(HouseholdCambodia_2C$d20, exclude=NULL)
  HouseholdCambodia_2C$e13 <- factor(HouseholdCambodia_2C$e13, exclude=NULL)
  HouseholdCambodia_2C$e13_1 <- factor(HouseholdCambodia_2C$e13_1, exclude=NULL)
  HouseholdCambodia_2C$d140 <- factor(HouseholdCambodia_2C$d140, exclude=NULL)
  HouseholdCambodia_2C$e58 <- factor(HouseholdCambodia_2C$e58, exclude=NULL)
  HouseholdCambodia_2C$e59 <- factor(HouseholdCambodia_2C$e59, exclude=NULL)
  HouseholdCambodia_2C$e60 <- factor(HouseholdCambodia_2C$e60, exclude=NULL)
  HouseholdCambodia_2C$e26 <- factor(HouseholdCambodia_2C$e26, exclude=NULL)
  HouseholdCambodia_2C$e40 <- factor(HouseholdCambodia_2C$e40, exclude=NULL)
  HouseholdCambodia_2C$e54 <- factor(HouseholdCambodia_2C$e54, exclude=NULL)
  HouseholdCambodia_2C$d32 <- factor(HouseholdCambodia_2C$d32, exclude=NULL)
  HouseholdCambodia_2C$e5_b <- factor(HouseholdCambodia_2C$e5_b, exclude=NULL)
  HouseholdCambodia_2C$TotCrop <- ifelse(!is.na(HouseholdCambodia_2C$no_crop1),HouseholdCambodia_2C$no_crop1,0) +
    ifelse(!is.na(HouseholdCambodia_2C$no_crop2),HouseholdCambodia_2C$no_crop2,0)
  HouseholdCambodia_2C$TotCrop <- as.factor(HouseholdCambodia_2C$TotCrop)
  HouseholdCambodia_2C$TotCrop <- factor(HouseholdCambodia_2C$TotCrop, exclude=NULL)
  HouseholdCambodia_2C$d26 <- factor(HouseholdCambodia_2C$d26, exclude=NULL)
  HouseholdCambodia_2C$b1 <- factor(HouseholdCambodia_2C$b1, exclude=NULL)
  HouseholdCambodia_2C$b2 <- factor(HouseholdCambodia_2C$b2, exclude=NULL)
  HouseholdCambodia_2C$b9 <- factor(HouseholdCambodia_2C$b9, exclude=NULL)
  HouseholdCambodia_2C$c8 <- factor(HouseholdCambodia_2C$c8, exclude=NULL)
  HouseholdCambodia_2C$l7 <- factor(HouseholdCambodia_2C$l7, exclude=NULL)
  HouseholdCambodia_2C$b10 <- factor(HouseholdCambodia_2C$b10, exclude=NULL)
  HouseholdCambodia_2C$b16 <- factor(HouseholdCambodia_2C$b16, exclude=NULL)
  HouseholdCambodia_2C$l2 <- factor(HouseholdCambodia_2C$l2, exclude=NULL)
  
  #(Need to create an indicator including all the product household sell,
  #animal and crops)
  #1st for lowland
  Commune <- cbind(as.character(HouseholdCambodia_2C$o9),as.character(HouseholdCambodia_2C$commune_eng))
  LowlandProv <- merge(Commune, ClowlandCambodia_2C, by.x = "V1", by.y = "hhid_re2")
  colnames(LowlandProv)[1:2] <- c("o9","Commune")
  LowlandSold <- LowlandProv %>% filter(LowlandProv$d2_136c != 0)
  ncrop_soldl <- LowlandSold %>%
    dplyr::count(`Commune`,`o9`)
  #2nd for upland
  UplandProv <- merge(Commune, CuplandCambodia_2C, by.x = "V1", by.y = "hhid_re3")
  colnames(UplandProv)[1:2] <- c("o9","Commune")
  UplandSold <- UplandProv %>% filter(UplandProv$d2_236c != 0)
  ncrop_soldu <- UplandSold %>%
    dplyr::count(`Commune`,`o9`)
  #3rd for the 3 main animals
  HouseholdCambodia_2C[,2078] <- as.numeric(HouseholdCambodia_2C[,2078])
  AniSold <- HouseholdCambodia_2C[,c(1,29,2078,2108,2129)]
  for (i in 3:5){
    AniSold[,i] <- ifelse(AniSold[,i] > 0, '1', '0')
    AniSold[,i] <- as.numeric(AniSold[,i])
  }
  AniSold$Nani <- ifelse(!is.na(AniSold$e5_4),AniSold$e5_4,0) + ifelse(!is.na(AniSold$e6_4),AniSold$e6_4,0) + ifelse(!is.na(AniSold$e7_4),AniSold$e7_4,0)
  #Now we merge these 3 tables together
  Dummy <- merge(ncrop_soldl, ncrop_soldu, by = "o9", all = T)
  SoldProd <- merge(AniSold,Dummy, by = "o9", all = T)
  SoldProd$SoldProdTot <- as.numeric(ifelse(!is.na(SoldProd$Nani), SoldProd$Nani,'0'))+ 
    as.numeric(ifelse(!is.na(SoldProd$n.x), SoldProd$n.x,'0'))+
    as.numeric(ifelse(!is.na(SoldProd$n.y), SoldProd$n.y,'0'))
  SoldProd <- SoldProd[,c(1,11)]
  HouseholdCambodia_2C <- join(HouseholdCambodia_2C,SoldProd, by = "o9")
  
  #Create another column for pasure owning
  HouseholdCambodia_2C$OwnPast <- ifelse(HouseholdCambodia_2C$e12_1 == '1' |
                                           HouseholdCambodia_2C$e12_3 == '1' |
                                           HouseholdCambodia_2C$e12_5 == '1', '1', '0')
  HouseholdCambodia_2C$OwnPast <- factor(HouseholdCambodia_2C$OwnPast, exclude=NULL)
}

##1.4 Preparation of Sampling weight through svy design function
{
  #First we add a column in which we add the sampling weight for each household
  x <- as.data.frame(summary(HouseholdCambodia_2C$village_eng_preload))
  x$fpc <- c(141,228,130,94,286,118,260,90,37,124,198,78,95,165,233,140)
  x$Weight <- x$fpc/x$`summary(HouseholdCambodia_2C$village_eng_preload)`
  x$village_eng_preload <- rownames(x)
  colnames(x)[1] <- "SurH"
  HouseholdCambodia_2C <- join(HouseholdCambodia_2C, x, by = "village_eng_preload")
  dstrat <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = HouseholdCambodia_2C,
    fpc = ~fpc)
  #We add the proper labels to the main database
  label <- readRDS("HouseholdCambodia_2C.rds")
  HouseholdCambodia_2C <- copy_labels(HouseholdCambodia_2C,label)
}
```

## I.1. Data analysis - General

### I.1.1 Household characteristics
```{r I.1.1, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
##I.1.1 Household characteristics
{
  # # #I.1.1.a. o10. Are both the man and the woman available for the interview?
  cat('\n####',"I.1.1.a o10. Are both the man and the woman available for the interview?", '\n')
  #We create a counting table and a title
  o10count <- as.data.frame(svytable(~o10, design=dstrat))
  colnames(o10count)[2] <- "n"
  list <- c("yes","no")
  #Now we create the plot with the corresponding function
  PiePlotYN(o10count,list)
  cat('\n')
  #Check
  
  # # #I.1.1.b. o11. Who do you do the interview with? (Men and Women
  #distribution as respondent) - General
  cat('\n####',"I.1.1.b. o11. Who do you do the interview with? (Men and Women distribution as respondent) - General", '\n')
  #We create a counting table and a title
  o11count <- as.data.frame(svytable(~o11, design=dstrat))
  colnames(o11count)[2] <- "n"
  list <- c("Male","Female","Both")
  pond <- sum(o11count$n)
  #Now we create the plot with the corresponding function
  PiePlot(o11count,list)
  cat('\n')
  #Check
  
  # # #I.1.1.c. o11. Who do you do the interview with? (Men and Women
  #distribution as respondent) - /commune
  cat('\n####',"I.1.1.c. o11. Who do you do the interview with? (Men and Women distribution as respondent) - /commune", '\n')
  #We create a counting table and add the information required for the function
  dcount <- as.data.frame(svytable(~commune_eng+o11, design=dstrat))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcount$Answer <- c("Male","Male","Male","Male","Female","Female","Female","Female",
                     "Both","Both","Both","Both")
  pond <- sum(dcount$n)
  ylimn <- 0
  dig = 1
  pal = "Blues"
  #Now we create the plot with the corresponding function
  ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
  cat('\n')
  #Check
  
  # # #I.1.1.d. a3. What is the sex of a1 (Household head)?
  cat('\n####',"I.1.1.d. a3. What is the sex of a1 (Household head)?", '\n')
  #We create a counting table and a title
  a3count <- as.data.frame(svytable(~a3, design=dstrat, exclude=NULL))
  colnames(a3count)[2] <- "n"
  list <- c("Male","Female","NA")
  pond <- sum(a3count$n)
  #Now we create the table with the corresponding function
  PiePlot(a3count,list)
  print("COMMENT: HH maybe passed away, I wait for confirmation (also for following plots)")
  cat('\n')
  #Check
  
  # # #I.1.1.e. Household head age distribution
  cat('\n####',"I.1.1.e. Household head age distribution", '\n')
  #First we create a counting table and a title
  dcount <- as.data.frame(svytable(~commune_eng+AgeCat, design=dstrat))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
  pond <- sum(dcount$n)
  xT <- "Age (years)"
  ylimn <- 0
  dig = 0
  pal = "Greens"
  #Now we create the plot with the corresponding function
  ListBPlotProv(dcount,pond,ylimn,dig,pal)
  cat('\n')
  #Check
  
  # # #I.1.1.f. Household head occupation distribution
  cat('\n####',"I.1.1.f. Household head occupation distribution", '\n')
  dcount <- as.data.frame(svytable(~commune_eng+a6, design=dstrat))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
  dcount$Answer <- c('a. Agricultural work\n (own farm)','c.Other farm\n salaried employment\n (temporary)',
                     'd.Daily wage sale of labor','e.Business (owner)', 
                     'f.Other non-agricultural work (please specify)','g.Salaried employment with government',
                     'h.Salaried employment with company','I.Salaried employment with NGOs',
                     'j.Housewife/ caregiver','k.Unable to work','l.Other',NA)
  pond <- sum(dcount$n)
  xT <- "Occupation"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the plot with the corresponding function
  ListBPlotProv(dcount,pond,ylimn,dig,pal)
  cat('\n')
  #Check
  
  # # #I.1.1.g. Distribution of Household members number
  cat('\n####',"I.1.1.g. Distribution of Household members number", '\n')
  #First we create a counting table and a title
  dcount <- as.data.frame(svytable(~commune_eng+a0, design=dstrat))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
  pond <- sum(dcount$n)
  xT <- "Num of household members"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  ListBPlotProv(dcount,pond,ylimn,dig,pal)
  cat('\n')
  #Check
}

```

### I.1.2 Land & Crops characteristics
```{r I.1.2, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.1.2.a. d1. What kinds of land did your household have in the past 12 months?
cat('\n####',"I.1.2.a. d1. What kinds of land did your household have in the past 12 months?", '\n')
#First, we select the useful data
d1dat <- HouseholdCambodia_2C[,c(1,29,32,582:589,2658,2659)]
#We restore the column proper names
colnames(d1dat)[4:11] <- var_label(d1dat)[4:11]
#We fulfil the information required in the function
pond <- sum(HouseholdCambodia_2C$Weight)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Kind of land owned"
ylimn <- -10
ylimx <- 100
dig = 0
pal = "Dark2"
PracticePlot(d1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.1.2.b. Growing crops - Yes or No
cat('\n####',"I.1.2.b. Growing crops - Yes or No", '\n')
#We create a counting table and a title
CropYNcount <- as.data.frame(svytable(~CropYN, design=dstrat))
CropYNcount <- CropYNcount[c("2","1"),]
colnames(CropYNcount)[2] <- "n"
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(CropYNcount,list)
cat('\n')
#Check

# # #I.1.2.c. Crop diversity - Lowland (Household based)
cat('\n####',"I.1.2.c. Crop diversity - Lowland (Household based)", '\n')
#First we need to apply a new survey design
Dumm <- HouseholdCambodia_2C[,c(1,32,2658,2659)]
colnames(dlowc)[2] <- "o9"
dlowc2 <- join(dlowc, Dumm, by = "o9")
dstratf <- svydesign(
  id = ~1, strata = ~village_eng_preload,
  weights = ~Weight, data = dlowc2)
#We create a counting table and a title
Cropcount <- as.data.frame(svytable(~d2_13e, design=dstratf))
colnames(Cropcount)[2] <- "n"
#We determine other function parameters
pond <- sum(HouseholdCambodia_2C$Weight)
#As there are many different crops, we'll display several plots
Cropcount <- Cropcount[order(-Cropcount$n),]
Cropcount$d2_13e <- as.character(Cropcount$d2_13e)
#We change too large crops label names 
Cropcount[1,1] <- "Wet season\n rice broadcasted"
Cropcount[2,1] <- "Wet season\n rice transplanted"
Cropcount[6,1] <- "Long bean,\n Chinese"
Cropcount[7,1] <- "Savoy cabbage\n (curly)"
Cropcount[13,1] <- "Cassava +\n cashew"
Cropcount[14,1] <- "Melon local,\n young"
xT <- "Crops"
ylimn <- -20
#For the 14 first crops
Cropcount1 <- Cropcount[c(1:16),]
list1 <- Cropcount$d2_13e[c(1:16)]
dig <- 1
ListBPlot(Cropcount1,list1,pond,xT,ylimn,dig)
cat('\n')
#Check

# # #I.1.2.d. Crop diversity - Upland (Household based)
cat('\n####',"I.1.2.d. Crop diversity - Upland (Household based)", '\n')
#First we need to apply a new survey design
colnames(dupc)[2] <- "o9"
dupc2 <- join(dupc, Dumm, by = "o9")
dupc2 <- dupc2[!is.na(dupc2$Weight),]
dstratg <- svydesign(
  id = ~1, strata = ~village_eng_preload,
  weights = ~Weight, data = dupc2)
#We create a counting table and a title
Cropcount <- as.data.frame(svytable(~d2_23e, design=dstratg))
colnames(Cropcount)[2] <- "n"
#We determine other function parameters
pond <- sum(HouseholdCambodia_2C$Weight)
#As there are many different crops, we'll display several plots
Cropcount <- Cropcount[order(-Cropcount$n),]
Cropcount$d2_23e <- as.character(Cropcount$d2_23e)
#We change too large crops label names 
Cropcount[3,1] <- "Cashew nut +\n cassava/others"
Cropcount[4,1] <- "Cassava +\n cashew"
Cropcount[6,1] <-"Soybean +\n cashew"
Cropcount[14,1] <- "Other fibre crops\n (cotton etc.)"
Cropcount[15,1] <- "Sunhemp +\n cashew"
Cropcount[16,1] <-"Upland rice +\n cashew / mango"
xT <- "Crops"
ylimn <- -10
#For the 14 first crops
Cropcount1 <- Cropcount[c(1:17),]
list1 <- Cropcount$d2_23e[c(1:17)]
dig <- 1
ListBPlot(Cropcount1,list1,pond,xT,ylimn,dig)
cat('\n')
#Check

# # #I.1.2.e. Crop diversity - Lowland (Area based)
cat('\n####',"I.1.2.e. Crop diversity - Lowland (Area based)", '\n')
dlowc2 <- ClowlandCambodia_2C[,c(2:3,10,12)]
dlowc2$d2_132 <- as.character(dlowc2$d2_132)
dlowc2$d2_132 <- as.numeric(dlowc2$d2_132)
colnames(dlowc2)[2] <- "o9"
dlowc2 <- join(dlowc2, Dumm, by = "o9")
dlowc2$NewAre <- dlowc2$d2_132*dlowc2$Weight
#We sum the area per crops
result  <- aggregate(NewAre ~ d2_13e, dlowc2, sum)
result$AverageTot <- result$NewAre/sum(ifelse(!is.na(HouseholdCambodia_2C$no_crop1), 1, 0)*HouseholdCambodia_2C$Weight)
result$AverageTot <- as.numeric(format(result$AverageTot,scientific = FALSE, digits = 1))
result$AverageTot <- round(result$AverageTot, digits = 1)
#Now we prepare the data for the function
#We determine other function parameters
pond <- round(sum(ifelse(!is.na(HouseholdCambodia_2C$no_crop1), 1, 0)*HouseholdCambodia_2C$Weight), digits = 0)
result <- result[order(-result$AverageTot),]
#As there are many different crops, we'll display several plots
result$d2_13e <- as.character(result$d2_13e)
colnames(result)[3] <- 'n'
#We change too large crops label names 
result[1,1] <- "Wet season\n rice broadcasted"
result[2,1] <- "Wet season\n rice transplanted"
result[6,1] <- "Cassava +\n cashew" 
result[10,1] <- "Savoy cabbage\n (curly)"
result[9,1] <- "Long bean,\n Chinese"
result[11,1] <- "Melon local,\n young"
xT <- "Crops"
ylimn <- -400
#We'll plot only the 10 first crops
result1 <- result[c(1:16),]
list1 <- result$d2_13e[c(1:16)]
dig <- 1
Plota <- ggplot(data=result1, aes(x= reorder(d2_13e, -n), y= n, fill = d2_13e))+
  geom_bar(colour="black",stat="identity") +
  theme_stata(base_size = 8)+
  theme(axis.text.x = element_text(size=8, angle = 85),
        legend.position = "none")+
  labs(x= xT)+
  labs(y= "area (m2)")+
  geom_text(aes(label = n, vjust = -1), size = 3)+
  ylim(-3000,max(result1$n)+2000)+
  ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))+
  scale_fill_viridis_d(alpha = 1,
                       begin = 0,
                       end = 1,
                       direction = 1,
                       option = "E",
                       na.value = "grey50",
                       guide = "colourbar",
                       aesthetics = "fill")
print(Plota)
cat('\n')
#Check

# # #I.1.2.f. Crop diversity - Upland (Area based)
cat('\n####',"I.1.2.f. Crop diversity - Upland (Area based)", '\n')
dupc2 <- CuplandCambodia_2C[,c(2:3,9,11)]
dupc2$d2_232 <- as.character(dupc2$d2_232)
dupc2$d2_232 <- as.numeric(dupc2$d2_232)
colnames(dupc2)[2] <- "o9"
dupc2 <- join(dupc2, Dumm, by = "o9")
dupc2$NewAre <- dupc2$d2_232*dupc2$Weight
#We sum the area per crops
result  <- aggregate(NewAre ~ d2_23e, dupc2, sum)
result$AverageTot <- result$NewAre/sum(ifelse(!is.na(HouseholdCambodia_2C$no_crop2), 1, 0)*HouseholdCambodia_2C$Weight)
result$AverageTot <- round(result$AverageTot, digits = 0)
#Now we prepare the data for the function
#We determine other function parameters
pond <- round(sum(ifelse(!is.na(HouseholdCambodia_2C$no_crop2), 1, 0)*HouseholdCambodia_2C$Weight), digits = 0)
result <- result[order(-result$AverageTot),]
#As there are many different crops, we'll display several plots
result$d2_23e <- as.character(result$d2_23e)
colnames(result)[3] <- 'n'
#We change too large crops label names 
result[3,1] <- "Cashew nut +\n cassava/others"
result[4,1] <- "Cassava +\n cashew"
result[6,1] <-"Soybean +\n cashew"
result[17,1] <- "Other fibre crops\n (cotton etc.)"
result[12,1] <- "Sunhemp +\n cashew"
result[14,1] <-"Upland rice +\n cashew / mango"
xT <- "Crops"
ylimn <- -600
#We'll plot only the 10 first crops
result1 <- result[c(1:17),]
list1 <- result$d2_23e[c(1:17)]
dig <- 0
Plota <- ggplot(data=result1, aes(x= reorder(d2_23e, -n), y= n, fill = d2_23e))+
  geom_bar(colour="black",stat="identity") +
  theme_stata(base_size = 8)+
  theme(axis.text.x = element_text(size=9, angle = 85),
        legend.position = "none")+
  labs(x= xT)+
  labs(y= "area (m2)")+
  geom_text(aes(label = n, vjust = -1), size = 3)+
  ylim(-3000,max(result1$n)+2000)+
  ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))+
  scale_fill_viridis_d(alpha = 1,
                       begin = 0,
                       end = 1,
                       direction = 1,
                       option = "E",
                       na.value = "grey50",
                       guide = "colourbar",
                       aesthetics = "fill")
print(Plota)
cat('\n')
#Check
```

### I.1.3 Animal characteristics
```{r I.1.3, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.1.3.a. e2. If yes, which below animal does your household have?
cat('\n####',"I.1.3.a. e2. If yes, which below animal does your household have?", '\n')
#First, we select the useful data
e2dat <- HouseholdCambodia_2C[,c(1,29,32,2032:2044,2658,2659)]
for (i in 4:16){
  e2dat[,i] <- as.factor(e2dat[,i])
  #We restore the column label real names
  colnames(e2dat)[i] <- var_label(e2dat)[i]
}
pond <- round(sum(ifelse(HouseholdCambodia_2C$e1 == '1',1,0)*HouseholdCambodia_2C$Weight), digits = 0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Animals"
ylimn <- -10
ylimx <- 100
dig = 0
pal = "Dark2"
PracticePlot(e2dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

## I.2. Data analysis for Agroecological principles

### I.2.1 - Recycling
```{r I.2.1, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.1.a. d17. Does your household use ecological/agroecological/integrated practices to maintain/enhance soil fertility in your fields?
cat('\n####',"I.2.1.a. d17. Does your household use ecological/agroecological/integrated practices to maintain/enhance soil fertility in your fields?", '\n')
#We create a counting table and a title
d17count <- as.data.frame(survey::svytable(~d17, design=dstrat, exclude=NULL))
d17count$d17 <- as.character(d17count$d17)
colnames(d17count)[2] <- "n"
d17count$d17 <- c("No","Do not know","Yes","NC")
#We order the answers
d17count <- d17count[c("3","1","2","4"),]
list <- c("yes","no","do not know", "NC")
#Now we create the table with the corresponding function
PiePlotYN(d17count,list)
cat('\n')
#Check

# # #I.2.1.b. d18 - Which of the following ecological/agroecological/integrated practices
cat('\n####',"I.2.1.b. d18 - Which of the following ecological/agroecological/integrated practices", '\n')
#does your household use to maintain/enhance soil fertility in your fields?
#First, we select the useful data
d18dat <- HouseholdCambodia_2C[,c(1,29,32,1106:1117,2658,2659)]
#We modify long label names
var_label(d18dat$d183) <- 'Bokashi (fermented\norganic matter)'
var_label(d18dat$d184) <- 'Legume-based\ngreen manure'
var_label(d18dat$d185) <- 'Pulses in association and/or\n rotation with main crop'
var_label(d18dat$d186) <- 'Cover crops in association and/\nor rotation with main crop'
var_label(d18dat$d188) <- 'Crop residue\nmaintenance'
var_label(d18dat$d189) <- 'Recycling\ncrop waste'
var_label(d18dat$d1810) <- 'Ramial Wood Chip (RWC) or\n otherwood chips'
var_label(d18dat$d1811) <- 'Organic agro-\nindustrial waste'
colnames(d18dat)[4:15] <- var_label(d18dat)[4:15]
pond <- round(sum(ifelse(HouseholdCambodia_2C$d17 == 'Yes', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Practices"
ylimn <- -30
ylimx <- 100
dig = 0
pal = "Dark2"
PracticePlot(d18dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.1.c. d18_11. For which crop(s) do you use animal manure?
cat('\n####',"I.2.1.c. d18_11. For which crop(s) do you use animal manure?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1811dat <- HouseholdCambodia_2C[,c(1,32,1120:1130,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d181 != 0 & !is.na(HouseholdCambodia_2C$d181), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -30
ylimx <- 100
dig = 1
#We apply the plotting function
CropPlot(d1811dat,val,ylimn,ylimx,dig)
cat('\n')
print("COMMENT: We are not taking into account Homegarden crops")
#Check

# # #I.2.1.d. d18_21. For which crop(s) do you use Compost (heap)?
cat('\n####',"I.2.1.d. d18_21. For which crop(s) do you use Compost (heap)?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1821dat <- HouseholdCambodia_2C[,c(1,32,1137:1147,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d182 != 0 & !is.na(HouseholdCambodia_2C$d182), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -30
ylimx <- 60
dig = 1
#We apply the plotting function
CropPlot(d1821dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #I.2.1.e. d18_31. For which crop(s) do you use Bokashi (fermented organic matter)?
cat('\n####',"I.2.1.e. d18_31. For which crop(s) do you use Bokashi (fermented organic matter)?", '\n')
print("No household use recycling crop waste")
cat('\n')

# # #I.2.1.f. d18_41. For which crop(s) do you use legume-based green manure?
cat('\n####',"I.2.1.f. d18_41. For which crop(s) do you use legume-based green manure?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1841dat <- HouseholdCambodia_2C[,c(1,32,1171:1181,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d184 != 0 & !is.na(HouseholdCambodia_2C$d184), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 100
dig = 0
#We apply the plotting function
CropPlot(d1841dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #I.2.1.g. d18_51. For which crop(s) do you use pulses in association and/or rotation with main crop ?
cat('\n####',"I.2.1.g. d18_51. For which crop(s) do you use pulses in association and/or rotation with main crop ?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1851dat <- HouseholdCambodia_2C[,c(1,32,1188:1198,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d185 != 0 & !is.na(HouseholdCambodia_2C$d185), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d1851dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #I.2.1.h. d18_61. For which crop(s) do you use cover crops in association and/or rotation with main crop ?
cat('\n####',"I.2.1.h. d18_61. For which crop(s) do you use cover crops in association and/or rotation with main crop ?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1861dat <- HouseholdCambodia_2C[,c(1,32,1205:1215,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d186 != 0 & !is.na(HouseholdCambodia_2C$d186), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -20
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d1861dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #I.2.1.I. d18_71. For which crop(s) do you use Biochar ?
cat('\n####',"I.2.1.I. d18_71. For which crop(s) do you use Biochar ?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1871dat <- HouseholdCambodia_2C[,c(1,32,1222:1232,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d187 != 0 & !is.na(HouseholdCambodia_2C$d187), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -20
ylimx <- 130
dig = 0
#We apply the plotting function
CropPlot(d1871dat,val,ylimn,ylimx,dig)
cat('\n')

# # #I.2.1.j. d18_81. For which crop(s) do you use crop residue maintenance?
cat('\n####',"I.2.1.j. d18_81. For which crop(s) do you use crop residue maintenance?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1881dat <- HouseholdCambodia_2C[,c(1,32,1239:1249,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d188 != 0 & !is.na(HouseholdCambodia_2C$d188), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 100
dig = 0
#We apply the plotting function
CropPlot(d1881dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #I.2.1.k. d18_91. For which crop(s) do you use recycling crop waste?
cat('\n####',"I.2.1.k. d18_91. For which crop(s) do you use recycling crop waste?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1891dat <- HouseholdCambodia_2C[,c(1,32,1256:1266,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d189 != 0 & !is.na(HouseholdCambodia_2C$d189), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -30
ylimx <- 100
dig = 0
#We apply the plotting function
CropPlot(d1891dat,val,ylimn,ylimx,dig)
cat('\n')

# # #I.2.1.l. d18_101. For which crop(s) do you use ramial Wood Chip (RWC) or other wood chips?
cat('\n####',"I.2.1.l. d18_101. For which crop(s) do you use ramial Wood Chip (RWC) or other wood chips?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d18101dat <- HouseholdCambodia_2C[,c(1,32,1273:1283,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d1810 != 0 & !is.na(HouseholdCambodia_2C$d1810), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -30
ylimx <- 100
dig = 0
#We apply the plotting function
CropPlot(d18101dat,val,ylimn,ylimx,dig)
cat('\n')


# # #I.2.1.m. d18_111. For which crop(s) do you use Organic agro-industrial waste ?
cat('\n####',"I.2.1.m. d18_111. For which crop(s) do you use Organic agro-industrial waste ?", '\n')
print("No household use waste")
cat('\n')

# # #I.2.1.n. d18_99. For which crop(s) do you use Other ?
cat('\n####',"I.2.1.n. d18_99. For which crop(s) do you use Other ?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d18991dat <- HouseholdCambodia_2C[,c(1,32,1307:1317,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d1899 != 0 & !is.na(HouseholdCambodia_2C$d1899), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 100
dig = 0
#We apply the plotting function
CropPlot(d18991dat,val,ylimn,ylimx,dig)
print("COMMENT: No translation for these data for now")
cat('\n')
```

### I.2.2 - Input reduction
```{r I.2.2, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.2.a. d20. Does your household use any ecological/ agroecological/ integrated practices to control weeds in your fields?
cat('\n####',"I.2.2.a. d20. Does your household use any ecological/ agroecological/ integrated practices to control weeds in your fields?", '\n')
#First, we select the useful data
#We create a counting table and a title
d20count <- as.data.frame(survey::svytable(~d20, design=dstrat, exclude=NULL))
d20count <- d20count[c("2","1","3","4"),]
colnames(d20count)[2] <- "n"
d20count$d20 <- as.character(d20count$d20)
d20count[4,1] <- '/'
list <- c("yes","no","do not know","NA")
#Now we create the table with the corresponding function
PiePlotYN(d20count,list)
cat('\n')
#Check

# # #I.2.2.b. d21. Which of the following ecological/agroecological/integrated practices
cat('\n####',"I.2.2.b. d21. Which of the following ecological/agroecological/integrated practices", '\n')
#does your household use to control weeds in your fields?
#First, we select the useful data
d21dat <- HouseholdCambodia_2C[,c(1,29,32,1326:1340,2658,2659)]
#We modify long label names
var_label(d21dat$d211) <- "Crop rotation /\n intercropping"
var_label(d21dat$d214) <- "Sowing date /\n rate / depth"
var_label(d21dat$d215) <- "Crop spatial\n arrangement"
var_label(d21dat$d216) <- "Seed cleaning\n before sowing"
var_label(d21dat$d2114) <- "Post harvest weed seed\n destruction in field"
colnames(d21dat)[4:18] <- var_label(d21dat)[4:18]
pond <- round(sum(ifelse(HouseholdCambodia_2C$d20 == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Practices"
ylimn <- -20
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(d21dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.2.c. e13. Does your household fertilize the forage or improved pasture?
cat('\n####',"I.2.2.c. e13. Does your household fertilize the forage or improved pasture?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~commune_eng+e13, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
dcount$Answer <- c("No","Yes","NC")
pond <- sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.2.d. e13_1. if yes, is it with Synthetic fertilizer, Organic manure or Both above ?
cat('\n####',"I.2.2.d. e13_1. if yes, is it with Synthetic fertilizer, Organic manure or Both above ?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~commune_eng+e13_1, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
dcount <- dcount %>% filter(!is.na(dcount$Answer))
dcount$Answer <- c("1.Synthetic fertilizer","2.Organic manure")
pond <- sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Set3"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.2.e. e29. Does your household use antibiotics on your cattle/buffalo?
cat('\n####',"I.2.2.e. e29. Does your household use antibiotics on your cattle/buffalo?", '\n')
#First, we select the useful data
e29dat <- HouseholdCambodia_2C[,c(1,29,32,2206:2209,2658,2659)]
#We modify long label names
var_label(e29dat$e291) <- "For treatment\n diseases only"
var_label(e29dat$e292) <- "For prevention of\n diseases only"
var_label(e29dat$e293) <- "For growth\n promotion"
var_label(e29dat$e290) <- "I dont use\n antibiotics at all"
colnames(e29dat)[4:7] <- var_label(e29dat)[4:7]
pond <- round(sum(ifelse(!is.na(HouseholdCambodia_2C$e28), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Answer"
ylimn <- -10
ylimx <- 90
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e29dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
print("COMMENT: Many households mentionned several answers")
cat('\n')
#Check

# # #I.2.2.f. e43. Does your household use antibiotics on your pigs?
cat('\n####',"I.2.2.f. e43. Does your household use antibiotics on your pigs?", '\n')
#First, we select the useful data
e43dat <- HouseholdCambodia_2C[,c(1,29,32,2273:2276,2658,2659)]
#We modify long label names
var_label(e43dat$e431) <- "For treatment\n diseases only"
var_label(e43dat$e432) <- "For prevention of\n diseases only"
var_label(e43dat$e433) <- "For growth\n promotion"
var_label(e43dat$e430) <- "I dont use\n antibiotics at all"
colnames(e43dat)[4:7] <- var_label(e43dat)[4:7]
pond <- round(sum(ifelse(!is.na(HouseholdCambodia_2C$e43) & HouseholdCambodia_2C$e43 != '', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Answer"
ylimn <- -10
ylimx <- 90
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e43dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
print("COMMENT: Many households mentionned several answers")
cat('\n')
#Check

# # #I.2.2.g. e57. Does your household use antibiotics on your poultry?
cat('\n####',"I.2.2.g. e57. Does your household use antibiotics on your poultry?", '\n')
#First, we select the useful data
e57dat <- HouseholdCambodia_2C[,c(1,29,32,2341:2344,2658,2659)]
#We modify long label names
var_label(e57dat$e571) <- "For treatment\n diseases only"
var_label(e57dat$e572) <- "For prevention of\n diseases only"
var_label(e57dat$e573) <- "For growth\n promotion"
var_label(e57dat$e570) <- "I dont use\n antibiotics at all"
colnames(e57dat)[4:7] <- var_label(e57dat)[4:7]
pond <- round(sum(ifelse(!is.na(HouseholdCambodia_2C$e56), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e57dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
print("COMMENT: Many households mentionned several answers")
cat('\n')
#Check
```

### I.2.3 - Soil health
```{r I.2.3, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.3.a. Soil conservation practices Yes or No
cat('\n####',"I.2.3.a. Soil conservation practices Yes or No", '\n')
#We create a counting table and a title
d140count <- as.data.frame(svytable(~d140, design=dstrat, exclude=NULL))
colnames(d140count)[2] <- "n"
#We order the answers
d140count$d140 <- as.character(d140count$d140)
d140count[3,1] <- '/'
d140count <- d140count[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(d140count,list)
cat('\n')
#Check

# # #I.2.3.b. d14. Which of the following soil conservation practices do you use ?
cat('\n####',"I.2.3.b. d14. Which of the following soil conservation practices do you use ?", '\n')
#First, we select the useful data
d14dat <- HouseholdCambodia_2C[,c(1,29,32,957:965,2658,2659)]
#We modify long label names
var_label(d14dat$d141) <-  "Sowing in \ncontour lines"
var_label(d14dat$d142) <- "Natural or planted\n grass strips"
var_label(d14dat$d143) <- "Trees conservation \nin agricultural plots"
var_label(d14dat$d144) <- "Agroforestry \n(trees + crops)"
var_label(d14dat$d145) <- "Crop residues\n maintained to\n cover the soil"
var_label(d14dat$d147) <- "Reduced to\n no-tillage"
var_label(d14dat$d140) <- "No soil conservation\n practice"
colnames(d14dat)[4:12] <- var_label(d14dat)[4:12]
pond <- round(sum(ifelse(HouseholdCambodia_2C$d140 == '0', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Practices"
ylimn <- -10
ylimx <- 110
dig = 0
pal ="Dark2"
PracticePlot(d14dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### I.2.4 - Animal health
```{r I.2.4, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.4.a. e58. Can you see the Ribs/ Bones of the ruminants, in the past 1 year?
cat('\n####',"I.2.4.a. e58. Can you see the Ribs/ Bones of the ruminants, in the past 1 year?", '\n')
#We create a counting table and a title
e58count <- as.data.frame(svytable(~e58, design=dstrat, exclude=NULL))
colnames(e58count)[2] <- "n"
e58count <- e58count[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(e58count,list)
cat('\n')
#Check

# # #I.2.4.b. e58_1. If yes to e58, which months?
cat('\n####',"I.2.4.b. e58_1. If yes to e58, which months?", '\n')
#First, we select the useful data
e58_1dat <- HouseholdCambodia_2C[,c(1,29,32,2351:2362,2658,2659)]
#We prepare the parameters for the function
colnames(e58_1dat)[4:15] <- var_label(e58_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdCambodia_2C$e58 == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 100
dig = 0
pal = "Dark2"
Monthplot(e58_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.4.c e59. Is there any month in the year when there is a lack of feed for the animals?
cat('\n####',"I.2.4.c e59. Is there any month in the year when there is a lack of feed for the animals?", '\n')
#We create a counting table and a title
e59count <- as.data.frame(svytable(~e59, design=dstrat, exclude=NULL))
colnames(e59count)[2] <- "n"
e59count <- e59count[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(e59count,list)
cat('\n')
#Check

# # #I.2.4.d. e59_1. If yes to e59, which months?
cat('\n####',"I.2.4.d. e59_1. If yes to e59, which months?", '\n')
#First, we select the useful data
e59_1dat <- HouseholdCambodia_2C[,c(1,29,32,2365:2376,2658,2659)]
#We prepare the parameters for the function
colnames(e59_1dat)[4:15] <- var_label(e59_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdCambodia_2C$e59 == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 100
dig = 0
pal = "Dark2"
Monthplot(e59_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.4.e. e60. Do the animals have access to the water?
cat('\n####',"I.2.4.e. e60. Do the animals have access to the water?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~commune_eng+e60, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
dcount$Answer <- c("No","Yes","NC")
pond <-sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.4.f. e26. Does your household have problems with Cattle/Buffalo parasites?
cat('\n####',"I.2.4.f. e26. Does your household have problems with Cattle/Buffalo parasites?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~commune_eng+e26, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),] 
dcount$Answer <- c("No","Yes","NC")
pond <- sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.4.g. e27. How does your household deal with it? - Cattle/Buffalo
cat('\n####',"I.2.4.g. e27. How does your household deal with it? - Cattle/Buffalo", '\n')
#Chemicals (define)
#First, we select the useful data
e27dat <- HouseholdCambodia_2C[,c(1,29,32,2197:2199,2658,2659)]
colnames(e27dat)[4:6] <- var_label(e27dat)[4:6]
pond <- round(sum(ifelse(!is.na(HouseholdCambodia_2C$e26_1), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e27dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.4.h. e40. Does your household have problems with Pigs parasites?
cat('\n####',"I.2.4.h. e40. Does your household have problems with Pigs parasites?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~commune_eng+e40, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),] 
dcount$Answer <- c("No","Yes","NC")
pond <- sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.4.I. e41. How does your household deal with it? - Pigs
cat('\n####',"I.2.4.I. e41. How does your household deal with it? - Pigs", '\n')
#Chemicals (define)
#First, we select the useful data
e41dat <- HouseholdCambodia_2C[,c(1,29,32,2264:2266,2658,2659)]
colnames(e41dat)[4:6] <- var_label(e41dat)[4:6]
pond <- round(sum(ifelse(HouseholdCambodia_2C$e40 == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e41dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.4.j. e54. Does your household have problems with Poultry parasites?
cat('\n####',"I.2.4.j. e54. Does your household have problems with Poultry parasites?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~commune_eng+e54, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),] 
dcount$Answer <- c("No","Yes","NC")
pond <- sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.4.k. e55. How does your household deal with it? - Poultry
cat('\n####',"I.2.4.k. e55. How does your household deal with it? - Poultry", '\n')
#Chemicals (define)
#First, we select the useful data
e55dat <- HouseholdCambodia_2C[,c(1,29,32,2331:2333,2658,2659)]
colnames(e55dat)[4:6] <- var_label(e55dat)[4:6]
pond <- round(sum(ifelse(HouseholdCambodia_2C$e54 == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e55dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### I.2.5 - Biodiversity
```{r I.2.5, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.5.a d32. Do you conserve and use traditional/local seeds?
cat('\n####',"I.2.5.a d32. Do you conserve and use traditional/local seeds?", '\n')
#We create a counting table and a title
d32count <- as.data.frame(svytable(~d32, design=dstrat, exclude=NULL))
colnames(d32count)[2] <- "n"
d32count <- d32count[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(d32count,list)
cat('\n')
#Check

# # #I.2.5.b. d32_1. If Yes to d32, for which crops?
cat('\n####',"I.2.5.b. d32_1. If Yes to d32, for which crops?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d32_1dat <- HouseholdCambodia_2C[,c(1,32,1944:1954,2658,2659)]
val <- round(sum(ifelse(HouseholdCambodia_2C$d32 == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
ylimn <- -15
ylimx <- 100
dig = 1
#We apply the plotting function
CropPlot(d32_1dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #I.2.5.c. e5_b. Do you have any local breeds of  e4_1 at the time of the survey?
cat('\n####',"I.2.5.c. e5_b. Do you have any local breeds of  e4_1 at the time of the survey?", '\n')
#We create a counting table and a title
e5_bcount <- as.data.frame(svytable(~e5_b, design=dstrat, exclude=NULL))
colnames(e5_bcount)[2] <- "n"
e5_bcount <- e5_bcount[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(e5_bcount,list)
cat('\n')
#Check

# # #I.2.5.d. e5_b_1. Animal diversity for local breeds (most important animal)
cat('\n####',"I.2.5.d. e5_b_1. Animal diversity for local breeds (most important animal)", '\n')
#First, we select the useful data
#We create a counting table and a title
e5_b_1count <- HouseholdCambodia_2C[,c(32,2067,2071,2658,2659)]
pond <- round(sum(ifelse(HouseholdCambodia_2C$e5_b == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
#Now we create the table with the corresponding function
AnimalPlot(e5_b_1count,pond)
cat('\n')
#Check


# # #I.2.5.e. Number of crops grown during the last 12 months
cat('\n####',"I.2.5.e. Number of crops grown during the last 12 months", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~commune_eng+TotCrop, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
pond <- sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check
```

### I.2.6 - Synergy
```{r I.2.6, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.6.a. d26. Does your household use agroecological/integrated practices to control pests and disease in your fields? 
cat('\n####',"I.2.6.a. d26. Does your household use agroecological/integrated practices to control pests and disease in your fields?", '\n')
#We create a counting table and a title
d26count <- as.data.frame(svytable(~d26, design=dstrat, exclude=NULL))
colnames(d26count)[2] <- "n"
d26count <- d26count[c("2","1","3","4"),]
list <- c("yes","no","DNK","NC")
#Now we create the table with the corresponding function
PiePlotYN(d26count,list)
cat('\n')
#Check

# # #I.2.6.b. d27. Which ecological/agroecological/integrated practices do you
#use to control pets and diseases in your fields?
cat('\n####',"I.2.6.b. d27. Which ecological/agroecological/integrated practices do you use to control pets and diseases in your fields?", '\n')
#First, we select the useful data
d27dat <- HouseholdCambodia_2C[,c(1,29,32,1603:1618,2658,2659)]
#We modify long label names
var_label(d27dat$d271) <- "Crop rotation /\n intercropping"
var_label(d27dat$d274) <- "Soil health \nmaintenance/improvement"
var_label(d27dat$d275) <- "Sanitation practices"
var_label(d27dat$d277) <- "Water and nutrient\n management"
var_label(d27dat$d278) <- "Cultivar choice (tolerant/\nresistant)/cultivar mixture"
var_label(d27dat$d279) <- "Biopesticide /\n organic pesticide"
var_label(d27dat$d2710) <- "BCAs"
var_label(d27dat$d2711) <- "Home-made efficient\n microorganism (EM)"
var_label(d27dat$d2712) <- "Commercial efficient\n microorganism (EM)"
colnames(d27dat)[4:19] <- var_label(d27dat)[4:19]
pond <- round(sum(ifelse(HouseholdCambodia_2C$d26 == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Practices"
ylimn <- -15
ylimx <- 60
dig = 0
pal = "Dark2"
#Function call
PracticePlot(d27dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### I.2.7 - Economic diversification
```{r I.2.7, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.7.a. b1. Does your household sell agricultural products 
#(crops, vegetables, fruits or processed products) and/or livestock?
cat('\n####',"I.2.7.a. b1. Does your household sell agricultural products (crops, vegetables, fruits or processed products) and/or livestock?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~commune_eng+b1, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
dcount$Answer <- c("0.No selling\n agri-products","1.Selling own\n crops/fruits/\n vegetable",
                   "2.Selling own\n livestock products","3.Selling both own\n crops/fruits/vegetables\n and livestock products")
pond <- sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.7.b. b2. Does your household sell derived/processed products and which?
cat('\n####',"I.2.7.b. b2. Does your household sell derived/processed products and which?", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~commune_eng+b2, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
dcount$Answer <- c("0.No processed/derived agri-products","1.Selling processed products from crops")
pond <- nrow(HouseholdCambodia_2C)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.7.c. Diversity of activities
cat('\n####',"I.2.7.c. Diversity of activities", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~commune_eng+SoldProdTot, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
dcount$Answer <- as.factor(dcount$Answer)
pond <- nrow(HouseholdCambodia_2C)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.7.d. b9.Are there specific months of the year in which you face financial difficulties?
cat('\n####',"I.2.7.d. b9.Are there specific months of the year in which you face financial difficulties?", '\n')
#We create a counting table and a title
b9count <- as.data.frame(svytable(~b9, design=dstrat, exclude=NULL))
b9count$b9 <- as.character(b9count$b9)
colnames(b9count)[2] <- "n"
b9count <- b9count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(b9count,list)
cat('\n')
#Check

# # #I.2.7.e. b9_1. If yes to b9, which months?
cat('\n####',"I.2.7.e. b9_1. If yes to b9, which months?", '\n')
#First, we select the useful data
b9_1dat <- HouseholdCambodia_2C[,c(1,29,32,173:184,2658,2659)]
#We prepare the parameters for the function
colnames(b9_1dat)[4:15] <- var_label(b9_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdCambodia_2C$b9 == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 80
dig = 0
pal = "Dark2"
Monthplot(b9_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### I.2.8 - Co-creation of knowledge
```{r I.2.8, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.8.a. c14. Do you exchange your agricultural products,
#equipment or animals with other farmers? 
cat('\n####',"I.2.8.a. c14. Do you exchange your agricultural products, equipment or animals with other farmers?", '\n')
#We create a counting table and a title
c14count <- as.data.frame(svytable(~c14, design=dstrat, exclude=NULL))
c14count$c14 <- as.character(c14count$c14)
colnames(c14count)[2] <- "n"
c14count <- c14count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(c14count,list)
cat('\n')
#Check

# # #I.2.8.b. f4. Do you have sufficient time to acquire new knowledge
#and improve your skills?
cat('\n####',"I.2.8.b. f4. Do you have sufficient time to acquire new knowledge and improve your skills?", '\n')
#First we select useful data
f4count <- as.data.frame(svytable(~f4, design=dstrat, exclude=NULL))
colnames(f4count)[1] <- "Answer"
colnames(f4count)[2] <- "n"
list <- c("1.No time","2.Very little time","3.Moderate amount of time","4.Almost enough time",
          "5.Sufficient amount of time", "6.Do not know")
pond <- sum(HouseholdCambodia_2C$Weight)
xT = "Answer"
ylimn <- -30
#Now we create the table with the corresponding function
ListBPlotNO(f4count,list,pond,xT,ylimn)
cat('\n')
#Check
```

### I.2.9 - Social value and diet
```{r I.2.9, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.9.a. i1. In general, what is the proportion of the food (rice, vegetable, animal products, etc.) consumed by your family that comes from your own farm or homegarden?
cat('\n####',"I.2.9.a. i1. In general, what is the proportion of the food (rice, vegetable, animal products, etc.) consumed by your family that comes from your own farm or homegarden?", '\n')
#First, we select the useful data
i1count <- as.data.frame(svytable(~i1, design=dstrat, exclude=NULL))
colnames(i1count)[1] <- "Answer"
colnames(i1count)[2] <- "n"
list <- c("1.Less than 25%","2.25-50%","3.50-75%","4.Over 75%")
pond <- sum(HouseholdCambodia_2C$Weight)
#Now we create the table with the corresponding function
xT = "Answer"
ylimn <- -10
ListBPlotNO(i1count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #I.2.9.b g5. Do you think the working hours (including household chores and taking care of family members) across family members are equitably distributed?
cat('\n####',"I.2.9.b g5. Do you think the working hours (including household chores and taking care of family members) across family members are equitably distributed?", '\n')
#We create a counting table and a title
g5count <- as.data.frame(svytable(~g5, design=dstrat, exclude=NULL))
g5count$g5 <- as.character(g5count$g5)
colnames(g5count)[2] <- "n"
g5count <- g5count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(g5count,list)
cat('\n')
#Check

# # #I.2.9.c. i2. Were there months, in the past 12 months, in which you did 
#not have enough food to meet your familys needs?
cat('\n####',"I.2.9.c. i2. Were there months, in the past 12 months, in which you did not have enough food to meet your familys needs?", '\n')
#We create a counting table and a title
i2count <- as.data.frame(svytable(~i2, design=dstrat, exclude=NULL))
i2count$i2 <- as.character(i2count$i2)
colnames(i2count)[2] <- "n"
i2count <- i2count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(i2count,list)
cat('\n')
#Check

# # #I.2.9.d. i3. If yes, which were the months in the past 12 months during 
#which you did not have enough food to meet your familys needs?
cat('\n####',"I.2.9.d. i3. If yes, which were the months in the past 12 months during which you did not have enough food to meet your familys needs?", '\n')
#First, we select the useful data
i3dat <- HouseholdCambodia_2C[,c(1,29,32,2409:2420,2658,2659)]
#We prepare the parameters for the function
colnames(b9_1dat)[4:15] <- var_label(b9_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdCambodia_2C$i2 == '1', 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 60
dig = 0
pal = "Dark2"
Monthplot(i3dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.9.e. g1. Who makes the decision on what (e.g. crops, animals) and how to produce (e.g., with or without herbicide, tillage or no tillage, compost or chemical fertiliser)?
cat('\n####',"I.2.9.e. g1. Who makes the decision on what (e.g. crops, animals) and how to produce (e.g., with or without herbicide, tillage or no tillage, compost or chemical fertiliser)?", '\n')
#We create a counting table and a title
g1count <- as.data.frame(svytable(~g1, design=dstrat, exclude=NULL))
g1count$g1 <- as.character(g1count$g1)
colnames(g1count)[2] <- "n"
list <- c("Myself alone","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members","DNK")
pond <- sum(HouseholdCambodia_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g1count,list)
cat('\n')
print("DNK = Do not know")
#Check

# # #I.2.9.f. g2. Who makes the decision on purchasing, selling, or transferring major household assets (land, cattle, equipment)?
cat('\n####',"I.2.9.f. g2. Who makes the decision on purchasing, selling, or transferring major household assets (land, cattle, equipment)?", '\n')
#We create a counting table and a title
g2count <- as.data.frame(svytable(~g2, design=dstrat, exclude=NULL))
g2count$g2 <- as.character(g2count$g2)
colnames(g2count)[2] <- "n"
list <- c("Myself alone","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members")
pond <- sum(HouseholdCambodia_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g2count,list)
cat('\n')
#Check

# # #I.2.9.g. g3. Who makes the decision on borrowing or lending money?
cat('\n####',"I.2.9.g. g3. Who makes the decision on borrowing or lending money?", '\n')
#We create a counting table and a title
g3count <- as.data.frame(svytable(~g3, design=dstrat, exclude=NULL))
g3count$g3 <- as.character(g3count$g3)
colnames(g3count)[2] <- "n"
list <- c("Myself alone","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members", "DNK")
pond <- sum(HouseholdCambodia_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g3count,list)
cat('\n')
print("DNK = Do not know")
#Check

# # #I.2.9.h. g4. Who makes the decision about how the household income is used?
cat('\n####',"I.2.9.h. g4. Who makes the decision about how the household income is used?", '\n')
#We create a counting table and a title
g4count <- as.data.frame(svytable(~g4, design=dstrat, exclude=NULL))
g4count$g4 <- as.character(g4count$g4)
colnames(g4count)[2] <- "n"
list <- c("Myself alone","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members")
pond <- sum(HouseholdCambodia_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g4count,list)
cat('\n')
#Check
```

### I.2.10 - Fairness
```{r I.2.10, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.10.a. b22. Did you sell any certified crop/vegetables/fruit/livestock
#related product in the past year/12 months?
cat('\n####',"I.2.10.a. b22. Did you sell any certified crop/vegetables/fruit/livestock related product in the past year/12 months?", '\n')
#We create a counting table and a title
b22count <- as.data.frame(svytable(~b22, design=dstrat, exclude=NULL))
b22count$b22 <- as.character(b22count$b22)
colnames(b22count)[2] <- "n"
b22count <- b22count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(b22count,list)
cat('\n')
#Check

# # #I.2.10.b. b22_1. If yes, which one(s)?
cat('\n####',"I.2.10.b. b22_1. If yes, which one(s)?", '\n')
#First, we select the useful data
b22_1dat <- HouseholdCambodia_2C[,c(1,29,32,260:268,2658,2659)]
#We modify long label names
var_label(b22_1dat$b22_113) <- "Dried meat (pork,\n beef, etc.)"
#We prepare the parameters for the function
colnames(b22_1dat)[4:12] <- var_label(b22_1dat)[4:12]
#WARNING
pond <- 213
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Certified crops"
ylimn <- -20
ylimx <- 200
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(b22_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.10.c. c8. Did you sign a contract whereby the buyer commits to buy 
#from you following some at specific conditions (price, volume, quality, time...)?
cat('\n####',"I.2.10.c. c8. Did you sign a contract whereby the buyer commits to buy from you following some at specific conditions (price, volume, quality, time...)?", '\n')
#First, we select the useful data
c8count <- as.data.frame(svytable(~c8, design=dstrat, exclude=NULL))
colnames(c8count)[1] <- "Answer"
colnames(c8count)[2] <- "n"
list <- c("yes","NC")
pond <- sum(HouseholdCambodia_2C$Weight)
xT = "Answer"
ylimn <- -20
#Now we create the table with the corresponding function
ListBPlotNO(c8count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #I.2.10.d. b14_1. Does buyer provide any of the following
cat('\n####',"I.2.10.d. b14_1. Does buyer provide any of the following", '\n')
#First, we select the useful data
b14_1dat <- HouseholdCambodia_2C[,c(1,29,32,655:663,2658,2659)]
#We prepare the parameters for the function
colnames(b14_1dat)[4:12] <- var_label(b14_1dat)[4:12]
pond <- round(sum(ifelse(!is.na(HouseholdCambodia_2C$b12_1), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Answer"
ylimn <- -20
ylimx <- 80
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(b14_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.10.e. b14_2. Does buyer provide any of the following
cat('\n####',"I.2.10.e. b14_2. Does buyer provide any of the following", '\n')
#First, we select the useful data
b14_2dat <- HouseholdCambodia_2C[,c(1,29,32,687:695,2658,2659)]
#We prepare the parameters for the function
colnames(b14_2dat)[4:12] <- var_label(b14_2dat)[4:12]
pond <- round(sum(ifelse(!is.na(HouseholdCambodia_2C$b12_2), 1,0)*HouseholdCambodia_2C$Weight), digits=0)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Answer"
ylimn <- -10
ylimx <- 60
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(b14_2dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.10.f. l7. In general, does your household have difficulties paying
#back your loans?
cat('\n####',"I.2.10.f. l7. In general, does your household have difficulties paying back your loans?", '\n')
#We create a counting table and a title
l7count <- as.data.frame(svytable(~l7, design=dstrat, exclude=NULL))
l7count$l7 <- as.character(l7count$l7)
colnames(l7count)[2] <- "n"
l7count <- l7count[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(l7count,list)
cat('\n')
#Check

# # #I.2.10.g. h1. Would you like your children to be farmers too?
cat('\n####',"I.2.10.g. h1. Would you like your children to be farmers too?", '\n')
#First, we select the useful data
h1count <- as.data.frame(svytable(~h1, design=dstrat, exclude=NULL))
colnames(h1count)[1] <- "Answer"
colnames(h1count)[2] <- "n"
list <- c("1. Yes, strongly","2. Yes, maybe",
          "4. No, agriculture is\n not a good job","5. Do not know")
pond <- sum(HouseholdCambodia_2C$Weight)
xT = "Answer"
ylimn <- -20
#Now we create the table with the corresponding function
ListBPlotNO(h1count,list,pond,xT,ylimn)
cat('\n')
#Check
```

### I.2.11 - Connectivity
```{r I.2.11, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.11.a. c13. Do you collaborate with other people for any task ?
cat('\n####',"I.2.11.a. c13. Do you collaborate with other people for any task ?", '\n')
#First, we select the useful data
c13dat <- HouseholdCambodia_2C[,c(1,29,32,569:576,2658,2659)]
#We modify long label names
var_label(c13dat$c131) <- "Share labor (mutual\n help, working together\n on each other farm)"
var_label(c13dat$c132) <- "Manage water/\nirrigation systems"
var_label(c13dat$c134) <- "Buy agricultural\n inputs"
var_label(c13dat$c135) <- "Selling products\n to the markets for\n other farmers"
var_label(c13dat$c136) <- "Experiment new\n farming practices"
var_label(c13dat$c130) <-"No collaboration\n with other people\n on these issues"
#We prepare the parameters for the function
colnames(c13dat)[4:11] <- var_label(c13dat)[4:11]
pond <- sum(HouseholdCambodia_2C$Weight)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Months"
ylimn <- -20
ylimx <- 100
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(c13dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.11.b c15. Are you involved in some form of advocacy work (aiming 
#to influence decision-making within political institutions)?
cat('\n####',"I.2.11.b c15. Are you involved in some form of advocacy work (aiming to influence decision-making within political institutions)?", '\n')
#We create a counting table and a title
c15count <- as.data.frame(svytable(~c15, design=dstrat, exclude=NULL))
c15count$c15 <- as.character(c15count$c15)
colnames(c15count)[2] <- "n"
c15count <- c15count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(c15count,list)
cat('\n')
#Check

# # #I.2.11.c f3.Do you have enough time for your family and your social relationships?
cat('\n####',"I.2.11.c f3.Do you have enough time for your family and your social relationships?", '\n')
#First, we select the useful data
f3count <- as.data.frame(svytable(~f3, design=dstrat, exclude=NULL))
colnames(f3count)[1] <- "Answer"
colnames(f3count)[2] <- "n"
list <- c("2. Very little time","3. Moderate amount of time",
          "4. Almost enough time","5. Sufficient amount of time")
pond <- sum(HouseholdCambodia_2C$Weight)
xT = "Answer"
ylimn <- -30
#Now we create the table with the corresponding function
ListBPlotNO(f3count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #I.2.11.d b10. If you sell crops/vegetables/fruits or processed products,
#do you know what is their main final destination?
cat('\n####',"I.2.11.d b10. If you sell crops/vegetables/fruits or processed products, do you know what is their main final destination?", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~commune_eng+b10, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
dcount$Answer <- c("a.The local market \n(lower or equal to commune level market)",
                   "b.The provincial or national market","c.Export","e.Do not know","f./")
pond <- sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Dark2"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #I.2.11.d b16. If you sell livestock or livestock derived products, 
#do you know what is their main final destination?
cat('\n####',"I.2.11.d b16. If you sell livestock or livestock derived products, do you know what is their main final destination?", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~commune_eng+b16, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$commune_eng,dcount$Answer),]
dcount$Answer <- c("a.The local market (lower\n or equal to commune level market)",
                   "b.The provincial or national market","c.Export",
                   "e.Do not know","f./")
pond <- sum(HouseholdCambodia_2C$Weight)
ylimn <- 0
dig = 0
pal = "Dark2"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check
```

### I.2.12 - Land and natural resource governance
```{r I.2.12, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.12.a. l1. In the past year/12 months, did your household benefit from government
#subsidies to support investment in production or commercialization activities?
cat('\n####',"I.2.12.a. l1. In the past year/12 months, did your household benefit from government subsidies to support investment in production or commercialization activities?", '\n')
#We create a counting table and a title
l1count <- as.data.frame(svytable(~l1, design=dstrat, exclude=NULL))
l1count$l1 <- as.character(l1count$l1)
colnames(l1count)[2] <- "n"
l1count <- l1count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(l1count,list)
cat('\n')
#Check

# # #I.2.12.b. l2. How much of your total household income in 2022 did these 
#government subsidies represent?
cat('\n####',"I.2.12.b. l2. How much of your total household income in 2022 did these government subsidies represent?", '\n')
#We create a counting table and a title
l2count <- as.data.frame(svytable(~l2, design=dstrat, exclude=NULL))
colnames(l2count)[1] <- "Answer"
colnames(l2count)[2] <- "n"
l2count <- l2count %>%  filter(!is.na(Answer))
list <- c("1.Less than 25%","2.25-50%","3.50-75%","4.Do not know")
pond <- round(sum(l2count$n),digits = 0)
xT = "Answer"
ylimn <- -20
#Now we create the table with the corresponding function
ListBPlotNO(l2count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #I.2.12.c. d9-10-11. Land ownership
cat('\n####',"I.2.12.c. d9-10-11. Land ownership", '\n')
#First, we select the useful data
d9_1dat <- HouseholdCambodia_2C[,c(1,29,32,790,793,796,2658,2659)]
#We modify long label names
var_label(d9_1dat$d9_1) <- "Having plots\n rented-in?"
var_label(d9_1dat$d10_1) <- "Having plots\n rented-out?"
var_label(d9_1dat$d11_1) <- "Having plots\n owned?"
#We prepare the parameters for the function
colnames(d9_1dat)[4:6] <- var_label(d9_1dat)[4:6]
pond <- sum(HouseholdCambodia_2C$Weight)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- ""
ylimn <- -20
ylimx <- 110
dig = 1
pal = "Dark2"
#Function call
PracticePlot(d9_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #I.2.12.c. e12. Does your household have private land to feed the animals?
cat('\n####',"I.2.12.c. e12. Does your household have private land to feed the animals?", '\n')
#We create a counting table and a title
e12count <- as.data.frame(svytable(~OwnPast, design=dstrat, exclude=NULL))
e12count$OwnPast <- as.character(e12count$OwnPast)
colnames(e12count)[2] <- "n"
e12count <- e12count[c("2","1","3"),]
list <- c("yes","no","NA")
#Now we create the table with the corresponding function
PiePlotYN(e12count,list)
cat('\n')
#Check
```

### I.2.13 - Participation
```{r I.2.13, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #I.2.13.a. c2. Are you a member of one or more farmer organization (e.g. crops/fruits/livestock/honey/ water/Forest etc)?
cat('\n####',"I.2.13.a. c2. Are you a member of one or more farmer organization (e.g. crops/fruits/livestock/honey/ water/Forest etc)?", '\n')
c2count <- as.data.frame(svytable(~c2, design=dstrat, exclude=NULL))
colnames(c2count)[1] <- "Answer"
colnames(c2count)[2] <- "n"
list <- c("1.No","2.Yes, one","3.Yes, more than one")
pond <- sum(HouseholdCambodia_2C$Weight)
xT = "Answer"
ylimn <- -25
#Now we create the table with the corresponding function
ListBPlotNO(c2count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #I.2.13.b. c1. Are you or anyone in your household active in one or several Unions? YN
cat('\n####',"I.2.13.b. c1. Are you or anyone in your household active in one or several Unions? YN", '\n')
c1_0count <- as.data.frame(svytable(~OwnPast, design=dstrat, exclude=NULL))
c1_0count$OwnPast <- as.character(c1_0count$OwnPast)
colnames(c1_0count)[2] <- "n"
c1_0count <- c1_0count[c("2","1","3"),]
list <- c("yes","no","NA")
#Now we create the table with the corresponding function
PiePlotYN(c1_0count,list)
cat('\n')
#Check

# # #I.2.13.c. c1. Are you or anyone in your household active in one or several of the following?
cat('\n####',"I.2.13.c. c1. Are you or anyone in your household active in one or several of the following?", '\n')
#First, we select the useful data
c1dat <- HouseholdCambodia_2C[,c(1,29,32,482:496,2658,2659)]
#We modify long label names
var_label(c1dat$c1_1) <- "c1_1. Women\n union"
var_label(c1dat$c1_2) <- "c1_2. Youth\n union"
var_label(c1dat$c1_3) <- "c1_3. Veteran\n union"
var_label(c1dat$c1_4) <- "c1_4. Farmer\n union"
var_label(c1dat$c1_5) <- "c1_5. Elderly\n union"
var_label(c1dat$c1_6) <- "c1_6. Political\n party"
#We prepare the parameters for the function
colnames(c1dat)[4:11] <- var_label(c1dat)[4:11]
pond <- sum(HouseholdCambodia_2C$Weight)
pond2 <- sum(HouseholdCambodia_2C$Weight)
xT <- "Months"
ylimn <- -20
ylimx <- 85
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(c1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```


# II. Laos
```{r II, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis'}
##1.1 Data import
#dta format (from Ky) datasets import
setwd("C:/Users/titou/OneDrive/Bureau/ASSET Stats/WORKDIRECTORY/1.ASSET_data_cleaning-Titouan/ASSET_data_cleaning")
#We import all the dta files transmitted by Ky as *Laos* database
HouseholdLaos_2C <- readRDS("HouseholdLaos_2C.rds")
ClowlandLaos_2C <- readRDS("ClowlandLaos_2.rds")
CuplandLaos_2C <- readRDS("CuplandLaos_2.rds")
HouMemberLaos_2C <- readRDS("HouMemberLaos_2C.rds")

#
colnames(HouseholdLaos_2C)[25] <- "district_eng"

##1.2 - Preparation of functions and data

# # #1.2.a. YES, NO, DNK, NA  PIE PLOT
PiePlotYN <- function(data,list){
  #Changing the index by real answers:
  data$d <- list
  # Preparation of the plot
  # Compute percentages
  data$fraction <- data$n / sum(data$n)
  # Compute the cumulative percentages (top of each rectangle)
  data$ymax <- cumsum(data$fraction)
  # Compute the bottom of each rectangle
  data$ymin <- c(0, head(data$ymax, n=-1))
  # Compute label position
  data$labelPosition <- (data$ymax + data$ymin) / 2
  # Compute a good label
  data$label <- paste0(data$d, "\n", round(data$fraction*100, digits = 1), "%")
  #Prepare the color list
  col <- c("forestgreen","darkolivegreen2","lightblue","grey88")
  # Make the plot
  plot <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=d)) +
    geom_rect(fill = col[1:nrow(data)],colour = "black") +
    geom_label_repel( x=3.5, aes(y=labelPosition, label=label), size=4, fill = col[1:nrow(data)]) +
    coord_polar(theta="y") +
    xlim(c(2, 4)) +
    theme_void() +
    theme(plot.title = element_text(hjust = 0.5, size = 13), legend.position = "none") +
    ggtitle(paste("Sample =", round(sum(data$n)/3.233, digits = 0), "/  Population = ",sum(data$n)))
  print(plot)
}

# # #1.2.b. ADAPTATIVE PIE PLOT
PiePlot <- function(data,list){
  #Changing the index by real answers:
  data$d <- list
  # Preparation of the plot
  # Compute percentages
  data$fraction <- data$n / sum(data$n)
  # Compute the cumulative percentages (top of each rectangle)
  data$ymax <- cumsum(data$fraction)
  # Compute the bottom of each rectangle
  data$ymin <- c(0, head(data$ymax, n=-1))
  # Compute label position
  data$labelPosition <- (data$ymax + data$ymin) / 2
  # Compute a good label
  data$label <- paste0(data$d, "\n", round(data$fraction*100, digits = 1), "%")
  #Prepare the color list
  col <- c("#0066CC","lightblue","grey88")
  # Make the plot
  plot <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=d)) +
    geom_rect(fill = col[1:nrow(data)],colour = "black") +
    geom_label_repel( x=3.5, aes(y=labelPosition, label=label), size=4, fill = col[1:nrow(data)]) +
    coord_polar(theta="y") +
    xlim(c(2, 4)) +
    theme_void() +
    theme(plot.title = element_text(hjust = 0.5, size = 13), legend.position = "none") +
    ggtitle(paste("Sample =", round(sum(data$n)/3.233, digits = 0), "/  Population = ",sum(data$n)))
  print(plot)
}

# # #1.2.c. List PLOT
ListBPlot <- function(data,list,pond,xT,ylimn,dig){
  colnames(data)[1] <- 'Answer'
  data$Answer <- list
  #We convert absolute values to % y divinding by the total number of households
  data$Percentage_of_households <- round(data$n/as.numeric(pond)*100, digits=dig)
  #And now a distribution plot
  Plota <- ggplot(data=data, aes(x= reorder(Answer, -Percentage_of_households), y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=9, angle = 85),
          legend.position = "none")+
    labs(x= xT)+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(ylimn,max(data$Percentage_of_households)+20)+
    ggtitle(paste("Sample =", round(pond/3.233, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plota)
}

# # #1.2.d. List PLOT without order
ListBPlotNO <- function(data,list,pond,xT,ylimn,dig){
  colnames(data)[1] <- 'Answer'
  data$Answer <- list
  #We convert absolute values to % y divinding by the total number of households
  data$Percentage_of_households <- round(data$n/as.numeric(pond)*100, digits=dig)
  #And now a distribution plot
  Plota <- ggplot(data=data, aes(x= reorder(Answer, Answer), y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=9, angle = 85),
          legend.position = "none")+
    labs(x= xT)+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(ylimn,max(data$Percentage_of_households)+20)+
    ggtitle(paste("Sample =", round(pond/3.233, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plota)
}

# # #1.2.e. List PLOT with province information (as x)
ListBPlotProv <- function(data,pond,ylimn,dig,pal){
  dcount <- data
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ district_eng, data=HouseholdLaos_2C, sum)
  dcount <- join(dcount, provtot, by = "district_eng")
  colnames(dcount)[4] <- "nbHHtot"
  dcount$Percentage_of_households <- round(dcount$n/as.numeric(dcount$nbHHtot)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcount)/2
  mycolors <- colorRampPalette(brewer.pal(9,pal))(nb.cols)
  #And now a distribution plot
  plotb <- ggplot(data=dcount, aes(x= `district_eng`, y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9), size = 3)+
    ylim(ylimn, max(dcount$Percentage_of_households)+20)+
    scale_fill_manual(values = mycolors)+
    theme_stata(base_size = 9)+
    theme(legend.title=element_blank())+
    ggtitle(paste("Kham dist.: S =",round(pond*0.39/3.233,digits = 0), "/ P =", round(pond*0.39,digits = 0) ,
                  " - Pek dist.: S = ",round(pond*0.29/3.233,digits = 0), "/ P =", round(pond*0.29,digits = 0),
                  "\n Phoukoud dist.: S = ",round(pond*0.32/3.233,digits = 0), "/ P =", round(pond*0.32,digits = 0)))
  print(plotb)
}

# # #1.2.f. List PLOT with province information (as x)
ListBPlotProvYN <- function(data,pond,ylimn,dig,pal){
  dcount <- data
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ district_eng, data=HouseholdLaos_2C, sum)
  dcount <- join(dcount, provtot, by = "district_eng")
  colnames(dcount)[4] <- "nbHHtot"
  dcount$Percentage_of_households <- round(dcount$n/as.numeric(dcount$nbHHtot)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcount)
  mycolors <- colorRampPalette(brewer.pal(9,pal))(nb.cols)
  #And now a distribution plot
  plotb <- ggplot(data=dcount, aes(x= `district_eng`, y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",position="stack", stat="identity")+
    geom_text(aes(label = Percentage_of_households), position = position_stack(vjust = .5), size = 3)+
    scale_fill_manual(values = mycolors)+
    theme_stata(base_size = 9)+
    theme(legend.title=element_blank())
    ggtitle(paste("Kham dist.: S =",round(pond*0.39/3.233,digits = 0), "/ P =", round(pond*0.39,digits = 0) ,
                  " - Pek dist.: S = ",round(pond*0.29/3.233,digits = 0), "/ P =", round(pond*0.29,digits = 0),
                  "\n Phoukoud dist.: S = ",round(pond*0.32/3.233,digits = 0), "/ P =", round(pond*0.32,digits = 0)))
  print(plotb)
}

# # #1.2.g. PRACTICES PLOT
PracticePlot <- function(data,pond,pond2,xT,ylimn,ylimx,dig,pal){
  #Then we adapt the format to be able to plot it and create a table
  dmelt <- melt(data ,  id.vars = c('o9', 'district_eng','village_eng_preload','fpc','Weight'), variable.name = 'Practices')
  dstratb <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Practices+value, design=dstratb, exclude=NULL))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcountNAR <- dcount %>%  filter(!is.na(Answer) & Answer != '' & Answer != 0)
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcountNAR)
  mycolors <- colorRampPalette(brewer.pal(8, pal))(nb.cols)
  #And now a distribution plot
  plota <- ggplot(data=dcountNAR, aes(x=reorder(Practices, -Percentage_of_households), y=Percentage_of_households, fill = Practices))+
    geom_bar(colour="black",stat="identity")+
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8,angle = 60), legend.position = "none")+
    geom_text(aes(label = Percentage_of_households, vjust = -1), size = 3) + ylim(ylimn, ylimx)+
    scale_fill_manual(values= mycolors)+
    labs(x= xT)+
    ggtitle(paste("Sample =", round(pond/3.233, digits = 0), "/  Population = ",pond))
  print(plota)
  
  # # # #b.b Plot with provinces and total %
  #We create a counting table
  dcount <- as.data.frame(svytable(~district_eng+Practices+value, design=dstratb, exclude=NULL))
  dcount <- dcount %>% filter(dcount$district_eng != '')
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != '' & value != 0)
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ district_eng, data=HouseholdLaos_2C, sum)
  dcountNAR <- join(dcountNAR, provtot, by = "district_eng")
  colnames(dcountNAR)[4] <- "n"
  colnames(dcountNAR)[5] <- "nbHHtot"
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(dcountNAR$nbHHtot)*100, digits=dig)
  #And now a distribution plot
  plotb <- ggplot(data=dcountNAR, aes(x=reorder(Practices, -Percentage_of_households), y=Percentage_of_households, fill = `district_eng`))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    theme_stata(base_size = 9)+
    theme(axis.text.x = element_text(size=8,angle = 60),legend.title=element_blank())+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9), size = 3)+
    ylim(ylimn, ylimx)+
    scale_fill_brewer(palette= pal, direction = -1)+
    labs(x= xT)+
    ggtitle(paste("Kham dist.: S =",round(pond2*0.39/3.233,digits = 0), "/ P =", round(pond2*0.39,digits = 0) ,
                  " - Pek dist.: S = ",round(pond2*0.29/3.233,digits = 0), "/ P =", round(pond2*0.29,digits = 0),
                  "\n Phoukoud dist.: S = ",round(pond2*0.32/3.233,digits = 0), "/ P =", round(pond2*0.32,digits = 0)))
  print(plotb)
}

# # #1.2.h. PRACTICES PLOT FOR MONTHS
Monthplot <- function(data,pond,pond2,xT,ylimn,ylimx,dig,pal){
  #Then we adapt the format to be able to plot it and create a table
  dmelt <- melt(data ,  id.vars = c('o9', 'district_eng','village_eng_preload','fpc','Weight'), variable.name = 'Practices')
  dstratb <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Practices+value, design=dstratb, exclude=NULL))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcountNARa <- dcount %>%  filter(!is.na(Answer) & Answer != 0)
  #We convert absolute values to % y divinding by the total number of households
  dcountNARa$Percentage_of_households <- round(dcountNARa$n/as.numeric(pond)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcountNARa)
  mycolors <- colorRampPalette(brewer.pal(8, pal))(nb.cols)
  #And now a distribution plot
  plota <- ggplot(data=dcountNARa, aes(x=Practices, y=Percentage_of_households, fill = Practices))+
    geom_bar(colour="black",stat="identity")+
    theme_stata(base_size = 9)+
    theme(axis.text.x = element_text(size=8,angle = 60), legend.position = "none",
          panel.grid.major=element_line(colour="grey"))+
    geom_text(aes(label = Percentage_of_households, vjust = -1)) + ylim(ylimn, ylimx)+
    scale_fill_manual(values= mycolors)+
    labs(x= xT)+
    ggtitle(paste("Sample =", round(pond/3.233, digits = 0), "/  Population = ",pond))
  print(plota)
  
  # # # #b.b Plot with provinces and total %
  #We create a counting table
  dcount <- as.data.frame(svytable(~district_eng+Practices+value, design=dstratb, exclude=NULL))
  dcount <- dcount %>% filter(dcount$district_eng != '')
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != 0)
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ district_eng, data=HouseholdLaos_2C, sum)
  dcountNAR <- join(dcountNAR, provtot, by = "district_eng")
  colnames(dcountNAR)[4] <- "n"
  colnames(dcountNAR)[5] <- "nbHHtot"
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(dcountNAR$nbHHtot)*100, digits=dig)
  #And now a distribution plot
  plotb <- ggplot(data=dcountNAR, aes(x=Practices, y=Percentage_of_households, fill = `district_eng`))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8,angle = 60),legend.title=element_blank())+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9), size = 3)+
    ylim(ylimn, ylimx)+
    scale_fill_brewer(palette= pal, direction = -1)+
    labs(x= xT)+
    ggtitle(paste("Kham dist.: S =",round(pond2*0.39/3.233,digits = 0), "/ P =", round(pond2*0.39,digits = 0) ,
                  " - Pek dist.: S = ",round(pond2*0.29/3.233,digits = 0), "/ P =", round(pond2*0.29,digits = 0),
                  "\n Phoukoud dist.: S = ",round(pond2*0.32/3.233,digits = 0), "/ P =", round(pond2*0.32,digits = 0)))
  print(plotb)
}

# # #1.2.i. CROP PLOT (big or small tables)
#For this function, we should use a database including column with household id 
#+ 11 columns with binary values for each crops
CropPlot <- function(data,pond, ylimn,ylimx,dig){
  #We replace binary values by crop names
  for (i in 3:13){
    data[,i] <- as.character(data[,i])
    for (j in 1:595){
      data[j,i] <- ifelse(data[j,i] == '1', dcrops[j,i], data[j,i])
    }
  }
  # We melt data frame into long format
  dmelt <- melt(data, id.vars = c("o9","village_eng_preload","fpc","Weight"))
  dmelt <- dmelt %>%  filter(!is.na(o9))
  # SVy design implementation
  dstrate <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  #We count the answers and filter NA and "no" values
  dcount <- as.data.frame(svytable(~value, design=dstrate, exclude=NULL))
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != 0)
  colnames(dcountNAR)[2] <- "n"
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=dig)
  #We order the table
  dcountNAR <- dcountNAR[order(-dcountNAR$Percentage_of_households), ]
  if (nrow(dcountNAR) > 15){
    dcountNARa <- dcountNAR[1:as.numeric(nrow(dcountNAR)/2),]
    dcountNARb <- dcountNAR[as.numeric((nrow(dcountNAR)/2+1)):as.numeric(nrow(dcountNAR)),]
    #And now a distribution plot
    Plota <- ggplot(data=dcountNARa, aes(x= reorder(value, -Percentage_of_households), y=Percentage_of_households, fill = value))+
      geom_bar(colour="black",stat="identity") +
      theme_stata(base_size = 8)+
      theme(axis.text.x = element_text(size=9, angle = 85), legend.position = "none"
            , axis.title.x = element_blank())+
      geom_text(aes(label = Percentage_of_households, vjust = -1))+
      ylim(ylimn,ylimx)+
      ggtitle(paste("Sample =", round(pond/3.233, digits = 0), "/  Population = ",pond))+
      scale_fill_viridis_d(alpha = 1,
                           begin = 0,
                           end = 1,
                           direction = 1,
                           option = "E",
                           na.value = "grey50",
                           guide = "colourbar",
                           aesthetics = "fill")
    print(Plota)
    #2nd plot
    Plotb  <- ggplot(data=dcountNARb, aes(x= reorder(value, -Percentage_of_households), y=Percentage_of_households, fill = value))+
      geom_bar(colour="black",stat="identity") +
      theme_stata(base_size = 8)+
      theme(axis.text.x = element_text(size=9, angle = 85), legend.position = "none", 
            axis.title.x = element_blank())+
      geom_text(aes(label = Percentage_of_households, vjust = -1))+
      ylim(ylimn,ylimx)+
      ggtitle(paste("Sample =", round(pond/3.233, digits = 0), "/  Population = ",pond))+
      scale_fill_viridis_d(alpha = 1,
                           begin = 0,
                           end = 1,
                           direction = 1,
                           option = "E",
                           na.value = "grey50",
                           guide = "colourbar",
                           aesthetics = "fill")
    print(Plotb)} else {
      #And now a distribution plot
      Plota <- ggplot(data=dcountNAR, aes(x= reorder(value, -Percentage_of_households), y=Percentage_of_households, fill = value))+
        geom_bar(colour="black",stat="identity") +
        theme_stata(base_size = 8)+
        theme(axis.text.x = element_text(size=9, angle = 85), legend.position = "none"
              , axis.title.x = element_blank())+
        geom_text(aes(label = Percentage_of_households, vjust = -1))+
        ylim(ylimn,ylimx)+
        ggtitle(paste("Sample =", round(pond/3.233, digits = 0), "/  Population = ",pond))+
        scale_fill_viridis_d(alpha = 1,
                             begin = 0,
                             end = 1,
                             direction = 1,
                             option = "E",
                             na.value = "grey50",
                             guide = "colourbar",
                             aesthetics = "fill")
      print(Plota)
      
    }
}

# # #1.2.j. ANIMAL PLOT
AnimalPlot <- function(data,pond){
  data[,2] <- as.character(data[,2])
  data[,3] <- as.character(data[,3])
  colnames(data)[2] <- "Animal"
  for (j in 1:549){
    data[j,3] <- ifelse(data[j,3] == '1', data[j,2], data[j,3])
  }
  data$Animal <- ifelse(is.na(data$Animal), '', data$Animal)
  #We count the answers and filter NA and "no" values
  dstratAn <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = data)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Animal, design=dstratAn, exclude=NULL))
  colnames(dcount)[2] <- "n"
  dcountNAR <- dcount %>%  filter(Animal != 0 & Animal != '')
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=1)
  #We order the table
  dcountNAR <- dcountNAR[order(-dcountNAR$Percentage_of_households), ]
  #And now a distribution plot
  Plota <- ggplot(data=dcountNAR, aes(x= reorder(Animal, -Percentage_of_households), y=Percentage_of_households, fill = Animal))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8, angle = 85), legend.position = "none", 
          axis.title.x = element_blank())+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(-10,max(dcountNAR$Percentage_of_households)+20)+
    ggtitle(paste("Sample =", round(pond/3.233, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plota)
}

# # #1.3 Preparation of Crops reference table
{
  #First we turn upland and lowland data to wide format (Duplicate alert = Normal,
  #we had no time to take care of it yet)
  dlowc <- ClowlandLaos_2C[,c(1:2,9)]
  dlowcwide <- reshape(dlowc, direction = "wide", timevar = "crop1_now", idvar = "hhid_re2")
  dupc <- CuplandLaos_2C[,c(1:2,8)]
  colnames(dupc)[colnames(dupc) == "hhid_re3"] ="hhid_re2"
  dupcwide <- reshape(dupc, direction = "wide", timevar = "crop2_now", idvar = "hhid_re2")
  #We create a table with all the id
  HHid <- HouseholdLaos_2C[,1:2]
  colnames(HHid)[colnames(HHid) == "o9"] = "hhid_re2"
  #We merge the tables
  dcrops <- merge(HHid, dlowcwide, by.x= "hhid_re2", all = T)
  dcrops <- merge(dcrops, dupcwide, by.x = "hhid_re2", all = T)
  #And we remove useless columns
  dcrops <- dcrops[,-c(2,8)]
  x <- HouseholdLaos_2C[,c(1,2)]
  colnames(x)[1] <- "hhid_re2"
  dcrops <- join(x,dcrops,by = "hhid_re2", match = "first")
  # #Additionnal stuffs
  #We convert data to the proper format
  dlowc$d2_13e <- as.factor(dlowc$d2_13e)
  dupc$d2_23e <- as.factor(dupc$d2_23e)
  #We create a column including the information if the household is growing crops or no
  HouseholdLaos_2C$CropYN <- ifelse(is.na(HouseholdLaos_2C$no_crop1) & is.na(HouseholdLaos_2C$no_crop2), '0', '1')
}

# # #Preparation of household head table and related stuff
{
  Province <- cbind(as.character(HouseholdLaos_2C$o9),as.character(HouseholdLaos_2C$district_eng))
  HouMemberProv <- merge(Province, HouMemberLaos_2C, by.x = "V1", by.y = "hhid_re1")
  HouHead <- HouMemberProv[HouMemberProv$a2 == 'Household head',]
  HouHead <- copy_labels(HouHead, HouMemberLaos_2C)
  colnames(HouMemberProv)[1:2] <- c("o9","Province")
  colnames(HouHead)[1:2] <- c("o9","Province")
  #We add HH information to the main table
  HouseholdLaos_2C <- join(HouseholdLaos_2C, HouHead, by = "o9", match = "first")

  #Also, we create a categorical variable with age range instead of quantitative value
  HouseholdLaos_2C$AgeCat <- cut(HouseholdLaos_2C$a4_1,
                                    breaks=c(20,30, 35, 40, 45, 50, 55, 60, 65, 70,100),
                                    labels=c('<30', '30-34', '35-39', '40-44','45-49','50-54',
                                             '55-59','60-64','65-69','>69'))
}

# # #Preparation of other columns
{
  #For some columns, we just add NA as factor level to include it to the tables then
  HouseholdLaos_2C$o11 <- ifelse(HouseholdLaos_2C$o11 == '', '2',HouseholdLaos_2C$o11)
  HouseholdLaos_2C$a3 <- factor(HouseholdLaos_2C$a3, exclude=NULL)
  HouseholdLaos_2C$AgeCat <- factor(HouseholdLaos_2C$AgeCat, exclude=NULL)
  HouseholdLaos_2C$a6 <- factor(HouseholdLaos_2C$a6, exclude=NULL)
  HouseholdLaos_2C$d17 <- factor(HouseholdLaos_2C$d17, exclude=NULL)
  HouseholdLaos_2C$d20 <- factor(HouseholdLaos_2C$d20, exclude=NULL)
  HouseholdLaos_2C$e13 <- factor(HouseholdLaos_2C$e13, exclude=NULL)
  HouseholdLaos_2C$e13_1 <- factor(HouseholdLaos_2C$e13_1, exclude=NULL)
  HouseholdLaos_2C$d140 <- factor(HouseholdLaos_2C$d140, exclude=NULL)
  HouseholdLaos_2C$e58 <- factor(HouseholdLaos_2C$e58, exclude=NULL)
  HouseholdLaos_2C$e59 <- factor(HouseholdLaos_2C$e59, exclude=NULL)
  HouseholdLaos_2C$e60 <- factor(HouseholdLaos_2C$e60, exclude=NULL)
  HouseholdLaos_2C$e26 <- factor(HouseholdLaos_2C$e26, exclude=NULL)
  HouseholdLaos_2C$e40 <- factor(HouseholdLaos_2C$e40, exclude=NULL)
  HouseholdLaos_2C$e54 <- factor(HouseholdLaos_2C$e54, exclude=NULL)
  HouseholdLaos_2C$d32 <- factor(HouseholdLaos_2C$d32, exclude=NULL)
  HouseholdLaos_2C$e5_b <- factor(HouseholdLaos_2C$e5_b, exclude=NULL)
  HouseholdLaos_2C$TotCrop <- ifelse(!is.na(HouseholdLaos_2C$no_crop1),HouseholdLaos_2C$no_crop1,0) +
    ifelse(!is.na(HouseholdLaos_2C$no_crop2),HouseholdLaos_2C$no_crop2,0)
  HouseholdLaos_2C$TotCrop <- as.factor(HouseholdLaos_2C$TotCrop)
  HouseholdLaos_2C$TotCrop <- factor(HouseholdLaos_2C$TotCrop, exclude=NULL)
  HouseholdLaos_2C$d26 <- factor(HouseholdLaos_2C$d26, exclude=NULL)
  HouseholdLaos_2C$b1 <- factor(HouseholdLaos_2C$b1, exclude=NULL)
  HouseholdLaos_2C$b2 <- factor(HouseholdLaos_2C$b2, exclude=NULL)
  HouseholdLaos_2C$b9 <- factor(HouseholdLaos_2C$b9, exclude=NULL)
  HouseholdLaos_2C$c8 <- factor(HouseholdLaos_2C$c8, exclude=NULL)
  HouseholdLaos_2C$l7 <- factor(HouseholdLaos_2C$l7, exclude=NULL)
  HouseholdLaos_2C$b10 <- factor(HouseholdLaos_2C$b10, exclude=NULL)
  HouseholdLaos_2C$b16 <- factor(HouseholdLaos_2C$b16, exclude=NULL)
  HouseholdLaos_2C$l2 <- factor(HouseholdLaos_2C$l2, exclude=NULL)
  
  #(Need to create an indicator including all the product household sell,
  #animal and crops)
  #1st for lowland
  Province <- cbind(as.character(HouseholdLaos_2C$o9),as.character(HouseholdLaos_2C$district_eng))
  LowlandProv <- merge(Province, ClowlandLaos_2C, by.x = "V1", by.y = "hhid_re2")
  colnames(LowlandProv)[1:2] <- c("o9","Province")
  LowlandSold <- LowlandProv %>% filter(LowlandProv$d2_136 != 0)
  ncrop_soldl <- LowlandSold %>%
    dplyr::count(`Province`,`o9`)
  #2nd for upland
  UplandProv <- merge(Province, CuplandLaos_2C, by.x = "V1", by.y = "hhid_re3")
  colnames(UplandProv)[1:2] <- c("o9","Province")
  UplandSold <- UplandProv %>% filter(UplandProv$d2_236 != 0)
  ncrop_soldu <- UplandSold %>%
    dplyr::count(`Province`,`o9`)
  #3rd for the 3 main animals
  AniSold <- HouseholdLaos_2C[,c(1,25,1886,1914,1933)]
  for (i in 3:5){
    AniSold[,i] <- ifelse(AniSold[,i] > 0, '1', '0')
    AniSold[,i] <- as.numeric(AniSold[,i])
  }
  AniSold$Nani <- ifelse(!is.na(AniSold$e5_4),AniSold$e5_4,0) + ifelse(!is.na(AniSold$e6_4),AniSold$e6_4,0) + ifelse(!is.na(AniSold$e7_4),AniSold$e7_4,0)
  #Now we merge these 3 tables together
  Dummy <- merge(ncrop_soldl, ncrop_soldu, by = "o9", all = T)
  SoldProd <- merge(AniSold,Dummy, by = "o9", all = T)
  SoldProd$SoldProdTot <- as.numeric(ifelse(!is.na(SoldProd$Nani), SoldProd$Nani,'0'))+ 
    as.numeric(ifelse(!is.na(SoldProd$n.x), SoldProd$n.x,'0'))+
    as.numeric(ifelse(!is.na(SoldProd$n.y), SoldProd$n.y,'0'))
  SoldProd <- SoldProd[,c(1,11)]
  HouseholdLaos_2C <- join(HouseholdLaos_2C,SoldProd, by = "o9")
  
  #Create another column
  HouseholdLaos_2C$OwnPast <- ifelse(HouseholdLaos_2C$e12_1 == 'Yes' |
                                          HouseholdLaos_2C$e12_3 == 'Yes' |
                                          HouseholdLaos_2C$e12_5 == 'Yes', '1', '0')
  HouseholdLaos_2C$OwnPast <- factor(HouseholdLaos_2C$OwnPast, exclude=NULL)
}

##1.4 Preparation of Sampling weight through svy design function
{
  #First we add a column in which we add the sampling weight for each household
  x <- as.data.frame(summary(HouseholdLaos_2C$village_eng_preload))
  x$fpc <- c(1,119,23,178,126,64,163,82,71,143,34,80,211,98,93,123,167)
  x <- x[c(2:17),]
  x$Weight <- x$fpc/x$`summary(HouseholdLaos_2C$village_eng_preload)`
  x$village_eng_preload <- rownames(x)
  colnames(x)[1] <- "SurH"
  HouseholdLaos_2C <- join(HouseholdLaos_2C, x, by = "village_eng_preload")
  dstrat <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = HouseholdLaos_2C,
    fpc = ~fpc)
  #We add the proper labels to the main database
  label <- readRDS("HouseholdLaos_2C.rds")
  HouseholdLaos_2C <- copy_labels(HouseholdLaos_2C,label)
}
```

## II.1. Data analysis - General

### II.1.1 Household characteristics
```{r II.1.1, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
##II.1.1 Household characteristics
{
  # # #II.1.1.a. o10. Are both the man and the woman available for the interview?
  cat('\n####',"II.1.1.a o10. Are both the man and the woman available for the interview?", '\n')
  #We create a counting table and a title
  o10count <- as.data.frame(svytable(~o10, design=dstrat))
  colnames(o10count)[2] <- "n"
  o10count <- o10count[c("2","1"),]
  list <- c("yes","no")
  #Now we create the plot with the corresponding function
  PiePlotYN(o10count,list)
  cat('\n')
  #Check
  
  # # #II.1.1.b. o11. Who do you do the interview with? (Men and Women
  #distribution as respondent) - General
  cat('\n####',"II.1.1.b. o11. Who do you do the interview with? (Men and Women distribution as respondent) - General", '\n')
  #We create a counting table and a title
  o11count <- as.data.frame(svytable(~o11, design=dstrat))
  colnames(o11count)[2] <- "n"
  list <- c("3.Both man and woman","1.Man","2.Woman")
  pond <- sum(o11count$n)
  #Now we create the plot with the corresponding function
  PiePlot(o11count,list)
  cat('\n')
  #Check
  
  # # #II.1.1.c. o11. Who do you do the interview with? (Men and Women
  #distribution as respondent) - /District
  cat('\n####',"II.1.1.c. o11. Who do you do the interview with? (Men and Women distribution as respondent) - /District", '\n')
  #We create a counting table and add the information required for the function
  dcount <- as.data.frame(svytable(~district_eng+o11, design=dstrat))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcount <- dcount %>% filter(dcount$district_eng != '')
  dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
  dcount$Answer <- c("Both man and woman","Man","Woman")
  pond <- sum(dcount$n)
  ylimn <- 0
  dig = 1
  pal = "Blues"
  #Now we create the plot with the corresponding function
  ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
  cat('\n')
  #Check
  
  # # #II.1.1.d. a3. What is the sex of a1 (Household head)?
  cat('\n####',"II.1.1.d. a3. What is the sex of a1 (Household head)?", '\n')
  #We create a counting table and a title
  a3count <- as.data.frame(svytable(~a3, design=dstrat, exclude=NULL))
  colnames(a3count)[2] <- "n"
  a3count <- a3count[c("2","1","3"),]
  list <- c("Male","Female","NA")
  pond <- sum(a3count$n)
  #Now we create the table with the corresponding function
  PiePlot(a3count,list)
  print("COMMENT: HH maybe passed away, I wait for confirmation (also for following plots)")
  cat('\n')
  #Check
  
  # # #II.1.1.e. Household head age distribution
  cat('\n####',"II.1.1.e. Household head age distribution", '\n')
  #First we create a counting table and a title
  dcount <- as.data.frame(svytable(~district_eng+AgeCat, design=dstrat))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcount <- dcount %>% filter(dcount$district_eng != '')
  dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
  pond <- sum(dcount$n)
  xT <- "Age (years)"
  ylimn <- 0
  dig = 0
  pal = "Greens"
  #Now we create the plot with the corresponding function
  ListBPlotProv(dcount,pond,ylimn,dig,pal)
  cat('\n')
  #Check
  
  # # #II.1.1.f. Household head occupation distribution
  cat('\n####',"II.1.1.f. Household head occupation distribution", '\n')
  dcount <- as.data.frame(svytable(~district_eng+a6, design=dstrat))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcount <- dcount %>% filter(dcount$district_eng != '')
  dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
  dcount$Answer <- c('a.Agricultural work\n (own farm)','e.Business (owner)','d.Government',
                     'g.Housewife/\n caregiver','i.No main occupation','j.Other',
                     'b.Other farm\n salaried employment\n (permanent)','f.Salaried employment\n (non-agricultural work)',
                     'h.Unable\n to work',NA)
  pond <- sum(dcount$n)
  xT <- "Occupation"
  ylimn <- -20
  dig <- 0
  pal = "Greens"
  #Now we create the plot with the corresponding function
  ListBPlotProv(dcount,pond,ylimn,dig,pal)
  cat('\n')
  #Check
  
  # # #II.1.1.g. Distribution of Household members number
  cat('\n####',"II.1.1.g. Distribution of Household members number", '\n')
  #First we create a counting table and a title
  dcount <- as.data.frame(svytable(~district_eng+a0, design=dstrat))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcount <- dcount %>% filter(dcount$district_eng != '')
  pond <- sum(dcount$n)
  xT <- "Num of household members"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  ListBPlotProv(dcount,pond,ylimn,dig,pal)
  cat('\n')
  #Check
}

```

### II.1.2 Land & Crops characteristics
```{r II.1.2, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.1.2.a. d1. What kinds of land did your household have in the past 12 months?
cat('\n####',"II.1.2.a. d1. What kinds of land did your household have in the past 12 months?", '\n')
#First, we select the useful data
d1dat <- HouseholdLaos_2C[,c(1,25,28,617:623,2396,2397)]
#We restore the column proper names
colnames(d1dat)[4:10] <- var_label(d1dat)[4:10]
#We fulfil the information required in the function
pond <- sum(HouseholdLaos_2C$Weight)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Kind of land owned"
ylimn <- -15
ylimx <- 110
dig = 0
pal = "Dark2"
PracticePlot(d1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.1.2.b. Growing crops - Yes or No
cat('\n####',"II.1.2.b. Growing crops - Yes or No", '\n')
#We create a counting table and a title
CropYNcount <- as.data.frame(svytable(~CropYN, design=dstrat))
CropYNcount <- CropYNcount[c("2","1"),]
colnames(CropYNcount)[2] <- "n"
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(CropYNcount,list)
cat('\n')
#Check

# # #II.1.2.c. Crop diversity - Lowland (Household based)
cat('\n####',"II.1.2.c. Crop diversity - Lowland (Household based)", '\n')
#First we need to apply a new survey design
Dumm <- HouseholdLaos_2C[,c(1,28,2396,2397)]
colnames(dlowc)[2] <- "o9"
dlowc2 <- join(dlowc, Dumm, by = "o9")
#TEMP: We remove crops with hhid with no correspondances
dlowc2 <- dlowc2[!is.na(dlowc2$Weight),]
dstratf <- svydesign(
  id = ~1, strata = ~village_eng_preload,
  weights = ~Weight, data = dlowc2)
#We create a counting table and a title
Cropcount <- as.data.frame(svytable(~d2_13e, design=dstratf))
colnames(Cropcount)[2] <- "n"
#We determine other function parameters
pond <- sum(HouseholdLaos_2C$Weight)
#As there are many different crops, we'll display several plots
Cropcount <- Cropcount[order(-Cropcount$n),]
Cropcount$d2_13e <- as.character(Cropcount$d2_13e)
#We change too large crops label names 
Cropcount[1,1] <- "Summer-autumn\n season rice"
Cropcount[12,1] <- "Other vegetable\n crop"
Cropcount[19,1] <- "Chinese\n flowering cabbage/\n choysum"
xT <- "Crops"
ylimn <- -15
#For the 14 first crops
Cropcount1 <- Cropcount[c(1:15),]
list1 <- Cropcount$d2_13e[c(1:15)]
dig <- 0
ListBPlot(Cropcount1,list1,pond,xT,ylimn,dig)
#For the 14 second crops
ylimn <- -10
dig <- 1
Cropcount2 <- Cropcount[c(16:29),]
list2 <- Cropcount$d2_13e[c(16:29)]
ListBPlot(Cropcount2,list2,pond,xT,ylimn,dig)
cat('\n')
#Check

# # #II.1.2.d. Crop diversity - Upland (Household based)
cat('\n####',"II.1.2.d. Crop diversity - Upland (Household based)", '\n')
#First we need to apply a new survey design
colnames(dupc)[2] <- "o9"
dupc2 <- join(dupc, Dumm, by = "o9")
dupc2 <- dupc2[!is.na(dupc2$Weight),]
dstratg <- svydesign(
  id = ~1, strata = ~village_eng_preload,
  weights = ~Weight, data = dupc2)
#We create a counting table and a title
Cropcount <- as.data.frame(svytable(~d2_23e, design=dstratg))
colnames(Cropcount)[2] <- "n"
#We determine other function parameters
pond <- sum(HouseholdLaos_2C$Weight)
#As there are many different crops, we'll display several plots
Cropcount <- Cropcount[order(-Cropcount$n),]
Cropcount$d2_23e <- as.character(Cropcount$d2_23e)
#We change too large crops label names 
Cropcount[5,1] <- "Summer-autumn\n season rice"
Cropcount[11,1] <- "Other vegetable\n crop"
Cropcount[25,1] <-"Chinese plantain,\n leaves"
Cropcount[28,1] <- "Other annual\n crop"
xT <- "Crops"
ylimn <- -10
#For the 14 first crops
Cropcount1 <- Cropcount[c(1:16),]
list1 <- Cropcount$d2_23e[c(1:16)]
dig <- 0
ListBPlot(Cropcount1,list1,pond,xT,ylimn,dig)
#For the 14 second crops
ylimn <- -5
dig <- 1
Cropcount2 <- Cropcount[c(16:32),]
list2 <- Cropcount$d2_23e[c(16:32)]
ListBPlot(Cropcount2,list2,pond,xT,ylimn,dig)
cat('\n')
#Check

# # #II.1.2.e. Crop diversity - Lowland (Area based)
cat('\n####',"II.1.2.e. Crop diversity - Lowland (Area based)", '\n')
dlowc2 <- ClowlandLaos_2C[,c(1:2,9,11)]
dlowc2$d2_132 <- as.character(dlowc2$d2_132)
dlowc2$d2_132 <- as.numeric(dlowc2$d2_132)
colnames(dlowc2)[2] <- "o9"
dlowc2 <- join(dlowc2, Dumm, by = "o9")
dlowc2$NewAre <- dlowc2$d2_132*dlowc2$Weight
#We sum the area per crops
result  <- aggregate(NewAre ~ d2_13e, dlowc2, sum)
result$AverageTot <- result$NewAre/sum(ifelse(!is.na(HouseholdLaos_2C$no_crop1), 1, 0)*HouseholdLaos_2C$Weight)
result$AverageTot <- as.numeric(format(result$AverageTot,scientific = FALSE, digits = 1))
result$AverageTot <- round(result$AverageTot, digits = 0)
#Now we prepare the data for the function
#We determine other function parameters
pond <- round(sum(ifelse(!is.na(HouseholdLaos_2C$no_crop1), 1, 0)*HouseholdLaos_2C$Weight), digits = 0)
result <- result[order(-result$AverageTot),]
#As there are many different crops, we'll display several plots
result$d2_13e <- as.character(result$d2_13e)
colnames(result)[3] <- 'n'
#We change too large crops label names 
result[1,1] <- "Summer-autumn\n season rice"
result[7,1] <- "Other vegetable\n crop"
result[18,1] <- "Chinese\n flowering cabbage/\n choysum"
xT <- "Crops"
ylimn <- -2000
#We'll plot only the 10 first crops
result1 <- result[c(1:10),]
list1 <- result$d2_13e[c(1:10)]
dig <- 0
Plota <- ggplot(data=result1, aes(x= reorder(d2_13e, -n), y= n, fill = d2_13e))+
  geom_bar(colour="black",stat="identity") +
  theme_stata(base_size = 8)+
  theme(axis.text.x = element_text(size=8, angle = 85),
        legend.position = "none")+
  labs(x= xT)+
  labs(y= "area (m2)")+
  geom_text(aes(label = n, vjust = -1))+
  ylim(ylimn,max(result1$n)+2000)+
  ggtitle(paste("Sample =", round(pond/3.233, digits = 0), "/  Population = ",pond))+
  scale_fill_viridis_d(alpha = 1,
                       begin = 0,
                       end = 1,
                       direction = 1,
                       option = "E",
                       na.value = "grey50",
                       guide = "colourbar",
                       aesthetics = "fill")
print(Plota)
cat('\n')
#Check

# # #II.1.2.f. Crop diversity - Upland (Area based)
cat('\n####',"II.1.2.f. Crop diversity - Upland (Area based)", '\n')
dupc2 <- CuplandLaos_2C[,c(1:2,8,10)]
dupc2$d2_232 <- as.character(dupc2$d2_232)
dupc2$d2_232 <- as.numeric(dupc2$d2_232)
colnames(dupc2)[2] <- "o9"
dupc2 <- join(dupc2, Dumm, by = "o9")
dupc2$NewAre <- dupc2$d2_232*dupc2$Weight
#We sum the area per crops
result  <- aggregate(NewAre ~ d2_23e, dupc2, sum)
result$AverageTot <- result$NewAre/sum(ifelse(!is.na(HouseholdLaos_2C$no_crop2), 1, 0)*HouseholdLaos_2C$Weight)
result$AverageTot <- round(result$AverageTot, digits = 0)
#Now we prepare the data for the function
#We determine other function parameters
pond <- round(sum(ifelse(!is.na(HouseholdLaos_2C$no_crop2), 1, 0)*HouseholdLaos_2C$Weight), digits = 0)
result <- result[order(-result$AverageTot),]
#As there are many different crops, we'll display several plots
result$d2_23e <- as.character(result$d2_23e)
colnames(result)[3] <- 'n'
#We change too large crops label names 
result[5,1] <- "Summer-autumn\n season rice"
result[6,1] <- "Other vegetable\n crop"
result[8,1] <- "Other annual \n crop"
result[30,1] <- "Chinese plantain,\n leaves"
xT <- "Crops"
ylimn <- -3000
#We'll plot only the 10 first crops
result1 <- result[c(1:10),]
list1 <- result$d2_23e[c(1:10)]
dig <- 0
Plota <- ggplot(data=result1, aes(x= reorder(d2_23e, -n), y= n, fill = d2_23e))+
  geom_bar(colour="black",stat="identity") +
  theme_stata(base_size = 8)+
  theme(axis.text.x = element_text(size=9, angle = 85),
        legend.position = "none")+
  labs(x= xT)+
  labs(y= "area (m2)")+
  geom_text(aes(label = n, vjust = -1))+
  ylim(ylimn,max(result1$n)+2000)+
  ggtitle(paste("Sample =", round(pond/3.223, digits = 0), "/  Population = ",pond))+
  scale_fill_viridis_d(alpha = 1,
                       begin = 0,
                       end = 1,
                       direction = 1,
                       option = "E",
                       na.value = "grey50",
                       guide = "colourbar",
                       aesthetics = "fill")
print(Plota)
cat('\n')
#Check
```

### II.1.3 Animal characteristics
```{r II.1.3, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.1.3.a. e2. If yes, which below animal does your household have?
cat('\n####',"II.1.3.a. e2. If yes, which below animal does your household have?", '\n')
#First, we select the useful data
e2dat <- HouseholdLaos_2C[,c(1,25,28,1839:1851,2396,2397)]
for (i in 4:16){
  e2dat[,i] <- as.factor(e2dat[,i])
  #We restore the column label real names
  colnames(e2dat)[i] <- var_label(e2dat)[i]
}
pond <- round(sum(ifelse(HouseholdLaos_2C$e1 == 'Yes',1,0)*HouseholdLaos_2C$Weight), digits = 0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Animals"
ylimn <- -10
ylimx <- 110
dig = 0
pal = "Dark2"
PracticePlot(e2dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

## II.2. Data analysis for Agroecological principles

### II.2.1 - Recycling
```{r II.2.1, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.1.a. d17. Does your household use ecological/agroecological/integrated practices to maintain/enhance soil fertility in your fields?
cat('\n####',"II.2.1.a. d17. Does your household use ecological/agroecological/integrated practices to maintain/enhance soil fertility in your fields?", '\n')
#We create a counting table and a title
d17count <- as.data.frame(survey::svytable(~d17, design=dstrat, exclude=NULL))
d17count$d17 <- as.character(d17count$d17)
colnames(d17count)[2] <- "n"
d17count[1,1] <- '/'
#We order the answers
d17count <- d17count[c("4","3","2","1"),]
list <- c("yes","no","do not know", "NC")
#Now we create the table with the corresponding function
PiePlotYN(d17count,list)
cat('\n')
#Check

# # #II.2.1.b. d18 - Which of the following ecological/agroecological/integrated practices
cat('\n####',"II.2.1.b. d18 - Which of the following ecological/agroecological/integrated practices", '\n')
#does your household use to maintain/enhance soil fertility in your fields?
#First, we select the useful data
d18dat <- HouseholdLaos_2C[,c(1,25,28,1068:1079,2396,2397)]
#We modify long label names
var_label(d18dat$d183) <- 'Bokashi (fermented\norganic matter)'
var_label(d18dat$d184) <- 'Legume-based\ngreen manure'
var_label(d18dat$d185) <- 'Pulses in association and/or\n rotation with main crop'
var_label(d18dat$d186) <- 'Cover crops in association and/\nor rotation with main crop'
var_label(d18dat$d188) <- 'Crop residue\nmaintenance'
var_label(d18dat$d189) <- 'Recycling\ncrop waste'
var_label(d18dat$d1810) <- 'Ramial Wood Chip (RWC) or\n otherwood chips'
var_label(d18dat$d1811) <- 'Organic agro-\nindustrial waste'
colnames(d18dat)[4:15] <- var_label(d18dat)[4:15]
pond <- round(sum(ifelse(HouseholdLaos_2C$d17 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Practices"
ylimn <- -40
ylimx <- 110
dig = 0
pal = "Dark2"
PracticePlot(d18dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.1.c. d18_11. For which crop(s) do you use animal manure?
cat('\n####',"II.2.1.c. d18_11. For which crop(s) do you use animal manure?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1811dat <- HouseholdLaos_2C[,c(1,28,1082:1092,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d181 != 0 & !is.na(HouseholdLaos_2C$d181), 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 120
dig = 0
#We apply the plotting function
CropPlot(d1811dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #II.2.1.d. d18_21. For which crop(s) do you use Compost (heap)?
cat('\n####',"II.2.1.d. d18_21. For which crop(s) do you use Compost (heap)?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1821dat <- HouseholdLaos_2C[,c(1,28,1096:1106,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d182 != 0 & !is.na(HouseholdLaos_2C$d182), 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 120
dig = 0
#We apply the plotting function
CropPlot(d1821dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #II.2.1.e. d18_31. For which crop(s) do you use Bokashi (fermented organic matter)?
cat('\n####',"II.2.1.e. d18_31. For which crop(s) do you use Bokashi (fermented organic matter)?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1831dat <- HouseholdLaos_2C[,c(1,28,1110:1120,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d183 != 0 & !is.na(HouseholdLaos_2C$d183), 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -60
ylimx <- 60
dig = 0
#We apply the plotting function
CropPlot(d1831dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #II.2.1.f. d18_41. For which crop(s) do you use legume-based green manure?
cat('\n####',"II.2.1.f. d18_41. For which crop(s) do you use legume-based green manure?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1841dat <- HouseholdLaos_2C[,c(1,28,1124:1134,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d184 != 0 & !is.na(HouseholdLaos_2C$d184), 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -30
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d1841dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #II.2.1.g. d18_51. For which crop(s) do you use pulses in association and/or rotation with main crop ?
cat('\n####',"II.2.1.g. d18_51. For which crop(s) do you use pulses in association and/or rotation with main crop ?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1851dat <- HouseholdLaos_2C[,c(1,28,1138:1148,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d185 != 0 & !is.na(HouseholdLaos_2C$d185), 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 130
dig = 0
#We apply the plotting function
CropPlot(d1851dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #II.2.1.h. d18_61. For which crop(s) do you use cover crops in association and/or rotation with main crop ?
cat('\n####',"II.2.1.h. d18_61. For which crop(s) do you use cover crops in association and/or rotation with main crop ?", '\n')
print("No household use crops in association and/or rotation with main crop")
cat('\n')
#Check

# # #II.2.1.i. d18_71. For which crop(s) do you use Biochar ?
cat('\n####',"II.2.1.i. d18_71. For which crop(s) do you use Biochar ?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1871dat <- HouseholdLaos_2C[,c(1,28,1166:1176,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d187 != 0 & !is.na(HouseholdLaos_2C$d185), 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -20
ylimx <- 130
dig = 0
#We apply the plotting function
CropPlot(d1871dat,val,ylimn,ylimx,dig)
cat('\n')

# # #II.2.1.j. d18_81. For which crop(s) do you use crop residue maintenance?
cat('\n####',"II.2.1.j. d18_81. For which crop(s) do you use crop residue maintenance?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1881dat <- HouseholdLaos_2C[,c(1,28,1180:1190,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d188 != 0 & !is.na(HouseholdLaos_2C$d188), 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d1881dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #II.2.1.k. d18_91. For which crop(s) do you use recycling crop waste?
cat('\n####',"II.2.1.k. d18_91. For which crop(s) do you use recycling crop waste?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1891dat <- HouseholdLaos_2C[,c(1,28,1194:1204,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d189 != 0 & !is.na(HouseholdLaos_2C$d188), 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -20
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d1891dat,val,ylimn,ylimx,dig)
cat('\n')

# # #II.2.1.l. d18_101. For which crop(s) do you use ramial Wood Chip (RWC) or other wood chips?
cat('\n####',"II.2.1.l. d18_101. For which crop(s) do you use ramial Wood Chip (RWC) or other wood chips?", '\n')
print("No household use RWC")
cat('\n')


# # #II.2.1.m. d18_111. For which crop(s) do you use Organic agro-industrial waste ?
cat('\n####',"II.2.1.m. d18_111. For which crop(s) do you use Organic agro-industrial waste ?", '\n')
print("No household use waste")
cat('\n')

# # #II.2.1.n. d18_99. For which crop(s) do you use Other ?
cat('\n####',"II.2.1.n. d18_99. For which crop(s) do you use Other ?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d18991dat <- HouseholdLaos_2C[,c(1,28,1236:1246,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d1899 != 0 & !is.na(HouseholdLaos_2C$d188), 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d18991dat,val,ylimn,ylimx,dig)
print("COMMENT: No translation for these data for now")
cat('\n')
```

### II.2.2 - Input reduction
```{r II.2.2, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.2.a. d20. Does your household use any ecological/ agroecological/ integrated practices to control weeds in your fields?
cat('\n####',"II.2.2.a. d20. Does your household use any ecological/ agroecological/ integrated practices to control weeds in your fields?", '\n')
#First, we select the useful data
#We create a counting table and a title
d20count <- as.data.frame(survey::svytable(~d20, design=dstrat, exclude=NULL))
d20count <- d20count[c("4","3","2","1"),]
colnames(d20count)[2] <- "n"
d20count$d20 <- as.character(d20count$d20)
d20count[4,1] <- '/'
list <- c("yes","no","do not know","NC")
#Now we create the table with the corresponding function
PiePlotYN(d20count,list)
cat('\n')
#Check

# # #II.2.2.b. d21. Which of the following ecological/agroecological/integrated practices
cat('\n####',"II.2.2.b. d21. Which of the following ecological/agroecological/integrated practices", '\n')
#does your household use to control weeds in your fields?
#First, we select the useful data
d21dat <- HouseholdLaos_2C[,c(1,25,28,1252:1266,2396,2397)]
#We modify long label names
var_label(d21dat$d211) <- "Crop rotation /\n intercropping"
var_label(d21dat$d214) <- "Sowing date /\n rate / depth"
var_label(d21dat$d215) <- "Crop spatial\n arrangement"
var_label(d21dat$d216) <- "Seed cleaning\n before sowing"
var_label(d21dat$d2114) <- "Post harvest weed seed\n destruction in field"
colnames(d21dat)[4:18] <- var_label(d21dat)[4:18]
pond <- round(sum(ifelse(HouseholdLaos_2C$d20 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Practices"
ylimn <- -20
ylimx <- 60
dig = 0
pal = "Dark2"
#Function call
PracticePlot(d21dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.2.c. e13. Does your household fertilize the forage or improved pasture?
cat('\n####',"II.2.2.c. e13. Does your household fertilize the forage or improved pasture?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e13, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("NC","No","Yes")
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.2.d. e13_1. if yes, is it with Synthetic fertilizer, Organic manure or Both above ?
cat('\n####',"II.2.2.d. e13_1. if yes, is it with Synthetic fertilizer, Organic manure or Both above ?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e13_1, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount <- dcount %>% filter(!is.na(dcount$Answer))
dcount$Answer <- c("NC","Organic manure","Synthetic fertilizer")
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Set3"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.2.e. e29. Does your household use antibiotics on your cattle/buffalo?
cat('\n####',"II.2.2.e. e29. Does your household use antibiotics on your cattle/buffalo?", '\n')
#First, we select the useful data
e29dat <- HouseholdLaos_2C[,c(1,25,28,2006:2009,2396,2397)]
#We modify long label names
var_label(e29dat$e29_11) <- "For treatment\n diseases only"
var_label(e29dat$e29_12) <- "For prevention of\n diseases only"
var_label(e29dat$e29_13) <- "For growth\n promotion"
var_label(e29dat$e29_10) <- "I dont use\n antibiotics at all"
colnames(e29dat)[4:7] <- var_label(e29dat)[4:7]
pond <- round(sum(ifelse(HouseholdLaos_2C$e28 != '', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e29dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
print("COMMENT: Many households mentionned several answers")
cat('\n')
#Check

# # #II.2.2.f. e43. Does your household use antibiotics on your pigs?
cat('\n####',"II.2.2.f. e43. Does your household use antibiotics on your pigs?", '\n')
#First, we select the useful data
e43dat <- HouseholdLaos_2C[,c(1,25,28,2065:2068,2396,2397)]
#We modify long label names
var_label(e43dat$e43_11) <- "For treatment\n diseases only"
var_label(e43dat$e43_12) <- "For prevention of\n diseases only"
var_label(e43dat$e43_13) <- "For growth\n promotion"
var_label(e43dat$e43_10) <- "I dont use\n antibiotics at all"
colnames(e43dat)[4:7] <- var_label(e43dat)[4:7]
pond <- round(sum(ifelse(HouseholdLaos_2C$e42 != '', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Answer"
ylimn <- -10
ylimx <- 50
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e43dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
print("COMMENT: Many households mentionned several answers")
cat('\n')
#Check

# # #II.2.2.g. e57. Does your household use antibiotics on your poultry?
cat('\n####',"II.2.2.g. e57. Does your household use antibiotics on your poultry?", '\n')
#First, we select the useful data
e57dat <- HouseholdLaos_2C[,c(1,25,28,2124:2127,2396,2397)]
#We modify long label names
var_label(e57dat$e57_11) <- "For treatment\n diseases only"
var_label(e57dat$e57_12) <- "For prevention of\n diseases only"
var_label(e57dat$e57_13) <- "For growth\n promotion"
var_label(e57dat$e57_10) <- "I dont use\n antibiotics at all"
colnames(e57dat)[4:7] <- var_label(e57dat)[4:7]
pond <- round(sum(ifelse(HouseholdLaos_2C$e56 == '', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Answer"
ylimn <- -10
ylimx <- 80
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e57dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
print("COMMENT: Many households mentionned several answers")
cat('\n')
#Check
```

### II.2.3 - Soil health
```{r II.2.3, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.3.a. Soil conservation practices Yes or No
cat('\n####',"II.2.3.a. Soil conservation practices Yes or No", '\n')
#We create a counting table and a title
d140count <- as.data.frame(svytable(~d140, design=dstrat, exclude=NULL))
colnames(d140count)[2] <- "n"
#We order the answers
d140count$d140 <- as.character(d140count$d140)
d140count <- d140count[c("2","1","3"),]
d140count[3,1] <- '/'
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(d140count,list)
cat('\n')
#Check

# # #II.2.3.b. d14. Which of the following soil conservation practices do you use ?
cat('\n####',"II.2.3.b. d14. Which of the following soil conservation practices do you use ?", '\n')
#First, we select the useful data
d14dat <- HouseholdLaos_2C[,c(1,25,28,944:951,2396,2397)]
#We modify long label names
var_label(d14dat$d141) <-  "Sowing in \ncontour lines"
var_label(d14dat$d142) <- "Natural or planted\n grass strips"
var_label(d14dat$d143) <- "Trees conservation \nin agricultural plots"
var_label(d14dat$d144) <- "Agroforestry \n(trees + crops)"
var_label(d14dat$d145) <- "Crop residues\n maintained to\n cover the soil"
var_label(d14dat$d147) <- "Reduced to\n no-tillage"
colnames(d14dat)[4:11] <- var_label(d14dat)[4:11]
pond <- round(sum(ifelse(HouseholdLaos_2C$d140 == '0', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Practices"
ylimn <- -20
ylimx <- 80
dig = 0
pal ="Dark2"
PracticePlot(d14dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### II.2.4 - Animal health
```{r II.2.4, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.4.a. e58. Can you see the Ribs/ Bones of the ruminants, in the past 1 year?
cat('\n####',"II.2.4.a. e58. Can you see the Ribs/ Bones of the ruminants, in the past 1 year?", '\n')
#We create a counting table and a title
e58count <- as.data.frame(svytable(~e58, design=dstrat, exclude=NULL))
colnames(e58count)[2] <- "n"
e58count <- e58count[c("3","2","1"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(e58count,list)
cat('\n')
#Check

# # #II.2.4.b. e58_1. If yes to e58, which months?
cat('\n####',"II.2.4.b. e58_1. If yes to e58, which months?", '\n')
#First, we select the useful data
e58_1dat <- HouseholdLaos_2C[,c(1,25,28,2133:2144,2396,2397)]
#We prepare the parameters for the function
colnames(e58_1dat)[4:15] <- var_label(e58_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdLaos_2C$e58 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 100
dig = 0
pal = "Dark2"
Monthplot(e58_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.4.c e59. Is there any month in the year when there is a lack of feed for the animals?
cat('\n####',"II.2.4.c e59. Is there any month in the year when there is a lack of feed for the animals?", '\n')
#We create a counting table and a title
e59count <- as.data.frame(svytable(~e59, design=dstrat, exclude=NULL))
colnames(e59count)[2] <- "n"
e59count <- e59count[c("3","2","1"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(e59count,list)
cat('\n')
#Check

# # #II.2.4.d. e59_1. If yes to e59, which months?
cat('\n####',"II.2.4.d. e59_1. If yes to e59, which months?", '\n')
#First, we select the useful data
e59_1dat <- HouseholdLaos_2C[,c(1,25,28,2147:2158,2396,2397)]
#We prepare the parameters for the function
colnames(e59_1dat)[4:15] <- var_label(e59_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdLaos_2C$e59 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 100
dig = 0
pal = "Dark2"
Monthplot(e59_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.4.e. e60. Do the animals have access to the water?
cat('\n####',"II.2.4.e. e60. Do the animals have access to the water?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e60, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("NC","No","Yes")
pond <-sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.4.f. e26. Does your household have problems with Cattle/Buffalo parasites?
cat('\n####',"II.2.4.f. e26. Does your household have problems with Cattle/Buffalo parasites?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e26, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),] 
dcount$Answer <- c("NC","No","Yes")
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.4.g. e27. How does your household deal with it? - Cattle/Buffalo
cat('\n####',"II.2.4.g. e27. How does your household deal with it? - Cattle/Buffalo", '\n')
#Chemicals (define)
#First, we select the useful data
e27dat <- HouseholdLaos_2C[,c(1,25,28,1996:1998,2396,2397)]
colnames(e27dat)[4:6] <- var_label(e27dat)[4:6]
pond <- round(sum(ifelse(!is.na(HouseholdLaos_2C$e26_1), 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Answer"
ylimn <- -35
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e27dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.4.h. e40. Does your household have problems with Pigs parasites?
cat('\n####',"II.2.4.h. e40. Does your household have problems with Pigs parasites?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e40, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),] 
dcount$Answer <- c("NC","No","Yes")
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.4.i. e41. How does your household deal with it? - Pigs
cat('\n####',"II.2.4.i. e41. How does your household deal with it? - Pigs", '\n')
#Chemicals (define)
#First, we select the useful data
e41dat <- HouseholdLaos_2C[,c(1,25,28,2055:2057,2396,2397)]
colnames(e41dat)[4:6] <- var_label(e41dat)[4:6]
pond <- round(sum(ifelse(HouseholdLaos_2C$e40 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Answer"
ylimn <- -20
ylimx <- 80
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e41dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.4.j. e54. Does your household have problems with Poultry parasites?
cat('\n####',"II.2.4.j. e54. Does your household have problems with Poultry parasites?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e54, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),] 
dcount$Answer <- c("No","Yes","NC","NA")
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.4.k. e55. How does your household deal with it? - Poultry
cat('\n####',"II.2.4.k. e55. How does your household deal with it? - Poultry", '\n')
#Chemicals (define)
#First, we select the useful data
e55dat <- HouseholdLaos_2C[,c(1,25,28,2114:2116,2396,2397)]
colnames(e55dat)[4:6] <- var_label(e55dat)[4:6]
pond <- round(sum(ifelse(HouseholdLaos_2C$e54 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Answer"
ylimn <- -20
ylimx <- 80
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e55dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### II.2.5 - Biodiversity
```{r II.2.5, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.5.a d32. Do you conserve and use traditional/local seeds?
cat('\n####',"II.2.5.a d32. Do you conserve and use traditional/local seeds?", '\n')
#We create a counting table and a title
d32count <- as.data.frame(svytable(~d32, design=dstrat, exclude=NULL))
colnames(d32count)[2] <- "n"
d32count <- d32count[c("3","2","1"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(d32count,list)
cat('\n')
#Check

# # #II.2.5.b. d32_1. If Yes to d32, for which crops?
cat('\n####',"II.2.5.b. d32_1. If Yes to d32, for which crops?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d32_1dat <- HouseholdLaos_2C[,c(1,28,1753:1763,2396,2397)]
val <- round(sum(ifelse(HouseholdLaos_2C$d32 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
ylimn <- -15
ylimx <- 200
dig = 0
#We apply the plotting function
CropPlot(d32_1dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #II.2.5.c. e5_b. Do you have any local breeds of  e4_1 at the time of the survey?
cat('\n####',"II.2.5.c. e5_b. Do you have any local breeds of  e4_1 at the time of the survey?", '\n')
#We create a counting table and a title
e5_bcount <- as.data.frame(svytable(~e5_b, design=dstrat, exclude=NULL))
colnames(e5_bcount)[2] <- "n"
e5_bcount <- e5_bcount[c("3","2","1"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(e5_bcount,list)
cat('\n')
#Check

# # #II.2.5.d. e5_b_1. Animal diversity for local breeds (most important animal)
cat('\n####',"II.2.5.d. e5_b_1. Animal diversity for local breeds (most important animal)", '\n')
#First, we select the useful data
#We create a counting table and a title
e5_b_1count <- HouseholdLaos_2C[,c(28,1872,1879,2396,2397)]
e5_b_1count$e5_b <- as.character(e5_b_1count$e5_b)
e5_b_1count$e5_b <- ifelse(e5_b_1count$e5_b == 'Yes', '1', ifelse(e5_b_1count$e5_b == 'No', '0', e5_b_1count$e5_b))
e5_b_1count$e5_b <- as.factor(e5_b_1count$e5_b)
pond <- round(sum(ifelse(HouseholdLaos_2C$e5_b == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
#Now we create the table with the corresponding function
AnimalPlot(e5_b_1count,pond)
cat('\n')
#Check


# # #II.2.5.e. Number of crops grown during the last 12 months
cat('\n####',"II.2.5.e. Number of crops grown during the last 12 months", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+TotCrop, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check
```

### II.2.6 - Synergy
```{r II.2.6, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.6.a. d26. Does your household use agroecological/integrated practices to control pests and disease in your fields? 
cat('\n####',"II.2.6.a. d26. Does your household use agroecological/integrated practices to control pests and disease in your fields?", '\n')
#We create a counting table and a title
d26count <- as.data.frame(svytable(~d26, design=dstrat, exclude=NULL))
colnames(d26count)[2] <- "n"
d26count <- d26count[c("4","3","2","1"),]
list <- c("yes","no","do not know","NC")
#Now we create the table with the corresponding function
PiePlotYN(d26count,list)
cat('\n')
#Check

# # #II.2.6.b. d27. Which ecological/agroecological/integrated practices do you
#use to control pets and diseases in your fields?
cat('\n####',"II.2.6.b. d27. Which ecological/agroecological/integrated practices do you use to control pets and diseases in your fields?", '\n')
#First, we select the useful data
d27dat <- HouseholdLaos_2C[,c(1,25,28,1484:1498,2396,2397)]
#We modify long label names
var_label(d27dat$d271) <- "Crop rotation /\n intercropping"
var_label(d27dat$d274) <- "Soil health \nmaintenance/improvement"
var_label(d27dat$d275) <- "Sanitation practices"
var_label(d27dat$d277) <- "Water and nutrient\n management"
var_label(d27dat$d278) <- "Cultivar choice (tolerant/\nresistant)/cultivar mixture"
var_label(d27dat$d279) <- "Biopesticide /\n organic pesticide"
var_label(d27dat$d2710) <- "BCAs"
var_label(d27dat$d2711) <- "Home-made efficient\n microorganism (EM)"
var_label(d27dat$d2712) <- "Commercial efficient\n microorganism (EM)"
colnames(d27dat)[4:18] <- var_label(d27dat)[4:18]
pond <- round(sum(ifelse(HouseholdLaos_2C$d26 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Practices"
ylimn <- -25
ylimx <- 80
dig = 0
pal = "Dark2"
#Function call
PracticePlot(d27dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### II.2.7 - Economic diversification
```{r II.2.7, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.7.a. b1. Does your household sell agricultural products 
#(crops, vegetables, fruits or processed products) and/or livestock?
cat('\n####',"II.2.7.a. b1. Does your household sell agricultural products (crops, vegetables, fruits or processed products) and/or livestock?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+b1, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("0.No selling\n agri-products","1.Selling agri-products","4.Selling both own\n crops/fruits/vegetables\n and livestock products",
                   "2.Selling own\n crops/fruits/\n vegetable","3.Selling own\n livestock products")
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.7.b. b2. Does your household sell derived/processed products and which?
cat('\n####',"II.2.7.b. b2. Does your household sell derived/processed products and which?", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~district_eng+b2, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("0.No processed/derived\n agri-products","3.Selling both above\n processed/derived agri-products","1.Selling processed\n products from crops")
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.7.c. Diversity of activities
cat('\n####',"II.2.7.c. Diversity of activities", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~district_eng+SoldProdTot, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- as.factor(dcount$Answer)
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.7.d. b9.Are there specific months of the year in which you face financial difficulties?
cat('\n####',"II.2.7.d. b9.Are there specific months of the year in which you face financial difficulties?", '\n')
#We create a counting table and a title
b9count <- as.data.frame(svytable(~b9, design=dstrat, exclude=NULL))
b9count$b9 <- as.character(b9count$b9)
colnames(b9count)[2] <- "n"
b9count <- b9count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(b9count,list)
cat('\n')
#Check

# # #II.2.7.e. b9_1. If yes to b9, which months?
cat('\n####',"II.2.7.e. b9_1. If yes to b9, which months?", '\n')
#First, we select the useful data
b9_1dat <- HouseholdLaos_2C[,c(1,25,28,159:170,2396,2397)]
#We prepare the parameters for the function
colnames(b9_1dat)[4:15] <- var_label(b9_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdLaos_2C$b9 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 100
dig = 0
pal = "Dark2"
Monthplot(b9_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### II.2.8 - Co-creation of knowledge
```{r II.2.8, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.8.a. c14. Do you exchange your agricultural products,
#equipment or animals with other farmers? 
cat('\n####',"II.2.8.a. c14. Do you exchange your agricultural products, equipment or animals with other farmers?", '\n')
#We create a counting table and a title
c14count <- as.data.frame(svytable(~c14, design=dstrat, exclude=NULL))
c14count$c14 <- as.character(c14count$c14)
colnames(c14count)[2] <- "n"
c14count <- c14count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(c14count,list)
cat('\n')
#Check

# # #II.2.8.b. f4. Do you have sufficient time to acquire new knowledge
#and improve your skills?
cat('\n####',"II.2.8.b. f4. Do you have sufficient time to acquire new knowledge and improve your skills?", '\n')
#First we select useful data
f4count <- as.data.frame(svytable(~f4, design=dstrat, exclude=NULL))
colnames(f4count)[1] <- "Answer"
colnames(f4count)[2] <- "n"
list <- c("4.Almost\n enough time","6.Do not know","3.Moderate amount\n of time",
          "1.No time","2.Very little time","5.Sufficient amount\n of time")
pond <- sum(HouseholdLaos_2C$Weight)
xT = "Answer"
ylimn <- -30
#Now we create the table with the corresponding function
ListBPlotNO(f4count,list,pond,xT,ylimn)
cat('\n')
#Check
```

### II.2.9 - Social value and diet
```{r II.2.9, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.9.a. i1. In general, what is the proportion of the food (rice, vegetable, animal products, etc.) consumed by your family that comes from your own farm or homegarden?
cat('\n####',"II.2.9.a. i1. In general, what is the proportion of the food (rice, vegetable, animal products, etc.) consumed by your family that comes from your own farm or homegarden?", '\n')
#First, we select the useful data
i1count <- as.data.frame(svytable(~i1, design=dstrat, exclude=NULL))
colnames(i1count)[1] <- "Answer"
colnames(i1count)[2] <- "n"
list <- c("2.25-50%","3.50-75%","1.Less than 25%","4.Over 75%")
pond <- sum(HouseholdLaos_2C$Weight)
#Now we create the table with the corresponding function
xT = "Answer"
ylimn <- -10
ListBPlotNO(i1count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #II.2.9.b g5. Do you think the working hours (including household chores and taking care of family members) across family members are equitably distributed?
cat('\n####',"II.2.9.b g5. Do you think the working hours (including household chores and taking care of family members) across family members are equitably distributed?", '\n')
#We create a counting table and a title
g5count <- as.data.frame(svytable(~g5, design=dstrat, exclude=NULL))
g5count$g5 <- as.character(g5count$g5)
colnames(g5count)[2] <- "n"
g5count <- g5count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(g5count,list)
cat('\n')
#Check

# # #II.2.9.c. i2. Were there months, in the past 12 months, in which you did 
#not have enough food to meet your familys needs?
cat('\n####',"II.2.9.c. i2. Were there months, in the past 12 months, in which you did not have enough food to meet your familys needs?", '\n')
#We create a counting table and a title
i2count <- as.data.frame(svytable(~i2, design=dstrat, exclude=NULL))
i2count$i2 <- as.character(i2count$i2)
colnames(i2count)[2] <- "n"
i2count <- i2count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(i2count,list)
cat('\n')
#Check

# # #II.2.9.d. i3. If yes, which were the months in the past 12 months during 
#which you did not have enough food to meet your familys needs?
cat('\n####',"II.2.9.d. i3. If yes, which were the months in the past 12 months during which you did not have enough food to meet your familys needs?", '\n')
#First, we select the useful data
i3dat <- HouseholdLaos_2C[,c(1,25,28,2192:2203,2396,2397)]
#We prepare the parameters for the function
colnames(b9_1dat)[4:15] <- var_label(b9_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdLaos_2C$i2 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 60
dig = 0
pal = "Dark2"
Monthplot(i3dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.9.e. g1. Who makes the decision on what (e.g. crops, animals) and how to produce (e.g., with or without herbicide, tillage or no tillage, compost or chemical fertiliser)?
cat('\n####',"II.2.9.e. g1. Who makes the decision on what (e.g. crops, animals) and how to produce (e.g., with or without herbicide, tillage or no tillage, compost or chemical fertiliser)?", '\n')
#We create a counting table and a title
g1count <- as.data.frame(svytable(~g1, design=dstrat, exclude=NULL))
g1count$g1 <- as.character(g1count$g1)
colnames(g1count)[2] <- "n"
list <- c("Do not know","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members","Myself alone")
pond <- sum(HouseholdLaos_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g1count,list)
cat('\n')
#Check

# # #II.2.9.f. g2. Who makes the decision on purchasing, selling, or transferring major household assets (land, cattle, equipment)?
cat('\n####',"II.2.9.f. g2. Who makes the decision on purchasing, selling, or transferring major household assets (land, cattle, equipment)?", '\n')
#We create a counting table and a title
g2count <- as.data.frame(svytable(~g2, design=dstrat, exclude=NULL))
g2count$g2 <- as.character(g2count$g2)
colnames(g2count)[2] <- "n"
list <- c("DNK","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members","Myself alone")
pond <- sum(HouseholdLaos_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g2count,list)
cat('\n')
print("DNK = Do not know")
#Check

# # #II.2.9.g. g3. Who makes the decision on borrowing or lending money?
cat('\n####',"II.2.9.g. g3. Who makes the decision on borrowing or lending money?", '\n')
#We create a counting table and a title
g3count <- as.data.frame(svytable(~g3, design=dstrat, exclude=NULL))
g3count$g3 <- as.character(g3count$g3)
colnames(g3count)[2] <- "n"
list <- c("DNK","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members","Myself alone")
pond <- sum(HouseholdLaos_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g3count,list)
cat('\n')
print("DNK = Do not know")
#Check

# # #II.2.9.h. g4. Who makes the decision about how the household income is used?
cat('\n####',"II.2.9.h. g4. Who makes the decision about how the household income is used?", '\n')
#We create a counting table and a title
g4count <- as.data.frame(svytable(~g4, design=dstrat, exclude=NULL))
g4count$g4 <- as.character(g4count$g4)
colnames(g4count)[2] <- "n"
list <- c("Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members","Myself alone")
pond <- sum(HouseholdLaos_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g4count,list)
cat('\n')
print("DNK = Do not know")
#Check
```

### II.2.10 - Fairness
```{r II.2.10, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.10.a. b22. Did you sell any certified crop/vegetables/fruit/livestock
#related product in the past year/12 months?
cat('\n####',"II.2.10.a. b22. Did you sell any certified crop/vegetables/fruit/livestock related product in the past year/12 months?", '\n')
#We create a counting table and a title
b22count <- as.data.frame(svytable(~b22, design=dstrat, exclude=NULL))
b22count$b22 <- as.character(b22count$b22)
colnames(b22count)[2] <- "n"
b22count <- b22count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(b22count,list)
cat('\n')
#Check

# # #II.2.10.b. b22_1. If yes, which one(s)?
cat('\n####',"II.2.10.b. b22_1. If yes, which one(s)?", '\n')
#First, we select the useful data
b22_1dat <- HouseholdLaos_2C[,c(1,25,28,208:222,2396,2397)]
#We modify long label names
var_label(b22_1dat$b22_113) <- "Dried meat (pork,\n beef, etc.)"
#We prepare the parameters for the function
colnames(b22_1dat)[4:18] <- var_label(b22_1dat)[4:18]
#WARNING
pond <- round(sum(ifelse(HouseholdLaos_2C$b22 == 'Yes', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Certified crops"
ylimn <- -10
ylimx <- 110
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(b22_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.10.c. c8. Did you sign a contract whereby the buyer commits to buy 
#from you following some at specific conditions (price, volume, quality, time...)?
cat('\n####',"II.2.10.c. c8. Did you sign a contract whereby the buyer commits to buy from you following some at specific conditions (price, volume, quality, time...)?", '\n')
#First, we select the useful data
c8count <- as.data.frame(svytable(~c8, design=dstrat, exclude=NULL))
colnames(c8count)[1] <- "Answer"
colnames(c8count)[2] <- "n"
c8count <- c8count[c("3","2","1"),]
list <- c("yes","no","NC")
pond <- sum(HouseholdLaos_2C$Weight)
xT = "Answer"
ylimn <- 0
#Now we create the table with the corresponding function
ListBPlotNO(c8count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #II.2.10.d. b14_1. Does buyer provide any of the following
cat('\n####',"II.2.10.d. b14_1. Does buyer provide any of the following", '\n')
#First, we select the useful data
b14_1dat <- HouseholdLaos_2C[,c(1,25,28,674:682,2396,2397)]
#We prepare the parameters for the function
colnames(b14_1dat)[4:12] <- var_label(b14_1dat)[4:12]
pond <- round(sum(ifelse(HouseholdLaos_2C$b12_1 != '', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Answer"
ylimn <- -10
ylimx <- 80
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(b14_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.10.e. b14_2. Does buyer provide any of the following
cat('\n####',"II.2.10.e. b14_2. Does buyer provide any of the following", '\n')
#First, we select the useful data
b14_2dat <- HouseholdLaos_2C[,c(1,25,28,699:707,2396,2397)]
#We prepare the parameters for the function
colnames(b14_2dat)[4:12] <- var_label(b14_2dat)[4:12]
pond <- round(sum(ifelse(HouseholdLaos_2C$b12_2 != '', 1,0)*HouseholdLaos_2C$Weight), digits=0)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Answer"
ylimn <- -10
ylimx <- 50
dig = 1
pal = "Dark2"
#Function Call
PracticePlot(b14_2dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.10.f. l7. In general, does your household have difficulties paying
#back your loans?
cat('\n####',"II.2.10.f. l7. In general, does your household have difficulties paying back your loans?", '\n')
#We create a counting table and a title
l7count <- as.data.frame(svytable(~l7, design=dstrat, exclude=NULL))
l7count$l7 <- as.character(l7count$l7)
colnames(l7count)[2] <- "n"
l7count <- l7count[c("3","2","1"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(l7count,list)
cat('\n')
#Check

# # #II.2.10.g. h1. Would you like your children to be farmers too?
cat('\n####',"II.2.10.g. h1. Would you like your children to be farmers too?", '\n')
#First, we select the useful data
h1count <- as.data.frame(svytable(~h1, design=dstrat, exclude=NULL))
colnames(h1count)[1] <- "Answer"
colnames(h1count)[2] <- "n"
list <- c("5. Do not know","4. No, agriculture is\n not a good job",
          "3. They should emigrate\n if they had the chance","2. Yes, maybe",
          "1. Yes, strongly")
pond <- sum(HouseholdLaos_2C$Weight)
xT = "Answer"
ylimn <- -20
#Now we create the table with the corresponding function
ListBPlotNO(h1count,list,pond,xT,ylimn)
cat('\n')
#Check
```

### II.2.11 - Connectivity
```{r II.2.11, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.11.a. c13. Do you collaborate with other people for any task ?
cat('\n####',"II.2.11.a. c13. Do you collaborate with other people for any task ?", '\n')
#First, we select the useful data
c13dat <- HouseholdLaos_2C[,c(1,25,28,605:612,2396,2397)]
#We modify long label names
var_label(c13dat$c131) <- "Share labor (mutual\n help, working together\n on each other farm)"
var_label(c13dat$c132) <- "Manage water/\nirrigation systems"
var_label(c13dat$c134) <- "Buy agricultural\n inputs"
var_label(c13dat$c135) <- "Selling products\n to the markets for\n other farmers"
var_label(c13dat$c136) <- "Experiment new\n farming practices"
var_label(c13dat$c130) <-"No collaboration\n with other people\n on these issues"
#We prepare the parameters for the function
colnames(c13dat)[4:11] <- var_label(c13dat)[4:11]
pond <- sum(HouseholdLaos_2C$Weight)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Months"
ylimn <- -20
ylimx <- 100
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(c13dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.11.b c15. Are you involved in some form of advocacy work (aiming 
#to influence decision-making within political institutions)?
cat('\n####',"II.2.11.b c15. Are you involved in some form of advocacy work (aiming to influence decision-making within political institutions)?", '\n')
#We create a counting table and a title
c15count <- as.data.frame(svytable(~c15, design=dstrat, exclude=NULL))
c15count$c15 <- as.character(c15count$c15)
colnames(c15count)[2] <- "n"
c15count <- c15count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(c15count,list)
cat('\n')
#Check

# # #II.2.11.c f3.Do you have enough time for your family and your social relationships?
cat('\n####',"II.2.11.c f3.Do you have enough time for your family and your social relationships?", '\n')
#First, we select the useful data
f3count <- as.data.frame(svytable(~f3, design=dstrat, exclude=NULL))
colnames(f3count)[1] <- "Answer"
colnames(f3count)[2] <- "n"
list <- c("4. Almost enough\n time","3. Moderate amount\n of time","1. No time",
          "5. Sufficient amount\n of time","2. Very little time")
pond <- sum(HouseholdLaos_2C$Weight)
xT = "Answer"
ylimn <- -10
#Now we create the table with the corresponding function
ListBPlotNO(f3count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #II.2.11.d b10. If you sell crops/vegetables/fruits or processed products,
#do you know what is their main final destination?
cat('\n####',"II.2.11.d b10. If you sell crops/vegetables/fruits or processed products, do you know what is their main final destination?", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~district_eng+b10, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("f./","e.Do not know","c.Export","d.Other",
                   "a.The local market \n(lower or equal to district level market)",
                   "b.The provincial or national market")
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Dark2"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #II.2.11.d b16. If you sell livestock or livestock derived products, 
#do you know what is their main final destination?
cat('\n####',"II.2.11.d b16. If you sell livestock or livestock derived products, do you know what is their main final destination?", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~district_eng+b16, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount %>% filter(dcount$district_eng != '')
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("f./","e.Do not know","c.export","d.Other",
                   "a.The local market (lower\n or equal to district level market)",
                   "b.The provincial or national market")
pond <- sum(HouseholdLaos_2C$Weight)
ylimn <- 0
dig = 0
pal = "Dark2"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check
```

### II.2.12 - Land and natural resource governance
```{r II.2.12, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.12.a. l1. In the past year/12 months, did your household benefit from government
#subsidies to support investment in production or commercialization activities?
cat('\n####',"II.2.12.a. l1. In the past year/12 months, did your household benefit from government subsidies to support investment in production or commercialization activities?", '\n')
#We create a counting table and a title
l1count <- as.data.frame(svytable(~l1, design=dstrat, exclude=NULL))
l1count$l1 <- as.character(l1count$l1)
colnames(l1count)[2] <- "n"
l1count <- l1count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(l1count,list)
cat('\n')
#Check

# # #II.2.12.b. l2. How much of your total household income in 2022 did these 
#government subsidies represent?
cat('\n####',"II.2.12.b. l2. How much of your total household income in 2022 did these government subsidies represent?", '\n')
#We create a counting table and a title
l2count <- as.data.frame(svytable(~l2, design=dstrat, exclude=NULL))
colnames(l2count)[1] <- "Answer"
colnames(l2count)[2] <- "n"
l2count <- l2count %>%  filter(Answer != '')
list <- c("1.Less than 25%","2.25-50%","3.50-75%","4.Over 75%","Do not know")
pond <- round(sum(l2count$n),digits = 0)
xT = "Answer"
ylimn <- -20
#Now we create the table with the corresponding function
ListBPlotNO(l2count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #II.2.12.c. d9-10-11. Land ownership
cat('\n####',"II.2.12.c. d9-10-11. Land ownership", '\n')
#First, we select the useful data
d9_1dat <- HouseholdLaos_2C[,c(1,25,28,804,806,808,2396,2397)]
#We modify long label names
var_label(d9_1dat$d9_1) <- "Having plots\n rented-in?"
var_label(d9_1dat$d10_1) <- "Having plots\n rented-out?"
var_label(d9_1dat$d11_1) <- "Having plots\n owned?"
d9_1dat$d9_1 <- as.character(d9_1dat$d9_1)
d9_1dat$d9_1 <- ifelse(d9_1dat$d9_1 == "Yes", '1','0')
d9_1dat$d9_1 <- as.factor(d9_1dat$d9_1)
d9_1dat$d10_1 <- as.character(d9_1dat$d10_1)
d9_1dat$d10_1 <- ifelse(d9_1dat$d10_1 == "Yes", '1','0')
d9_1dat$d10_1 <- as.factor(d9_1dat$d10_1)
d9_1dat$d11_1 <- as.character(d9_1dat$d11_1)
d9_1dat$d11_1 <- ifelse(d9_1dat$d11_1 == "Yes", '1','0')
d9_1dat$d11_1 <- as.factor(d9_1dat$d11_1)
#We prepare the parameters for the function
colnames(d9_1dat)[4:6] <- var_label(d9_1dat)[4:6]
pond <- sum(HouseholdLaos_2C$Weight)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- ""
ylimn <- -20
ylimx <- 110
dig = 1
pal = "Dark2"
#Function call
PracticePlot(d9_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #II.2.12.c. e12. Does your household have private land to feed the animals?
cat('\n####',"II.2.12.c. e12. Does your household have private land to feed the animals?", '\n')
#We create a counting table and a title
e12count <- as.data.frame(svytable(~OwnPast, design=dstrat, exclude=NULL))
e12count$OwnPast <- as.character(e12count$OwnPast)
colnames(e12count)[2] <- "n"
e12count <- e12count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(e12count,list)
cat('\n')
#Check
```

### II.2.13 - Participation
```{r II.2.13, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #II.2.13.a. c2. Are you a member of one or more farmer organization (e.g. crops/fruits/livestock/honey/ water/Forest etc)?
cat('\n####',"II.2.13.a. c2. Are you a member of one or more farmer organization (e.g. crops/fruits/livestock/honey/ water/Forest etc)?", '\n')
c2count <- as.data.frame(svytable(~c2, design=dstrat, exclude=NULL))
colnames(c2count)[1] <- "Answer"
colnames(c2count)[2] <- "n"
list <- c("1.No","3.Yes, more\n than one","2.Yes, one")
pond <- sum(HouseholdLaos_2C$Weight)
xT = "Answer"
ylimn <- -25
#Now we create the table with the corresponding function
ListBPlotNO(c2count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #II.2.13.b. c1. Are you or anyone in your household active in one or several Unions? YN
cat('\n####',"II.2.13.b. c1. Are you or anyone in your household active in one or several Unions? YN", '\n')
c1_0count <- as.data.frame(svytable(~OwnPast, design=dstrat, exclude=NULL))
c1_0count$OwnPast <- as.character(c1_0count$OwnPast)
colnames(c1_0count)[2] <- "n"
c1_0count <- c1_0count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(c1_0count,list)
cat('\n')
#Check

# # #II.2.13.c. c1. Are you or anyone in your household active in one or several of the following?
cat('\n####',"II.2.13.c. c1. Are you or anyone in your household active in one or several of the following?", '\n')
#First, we select the useful data
c1dat <- HouseholdLaos_2C[,c(1,25,28,543:550,2396,2397)]
#We modify long label names
var_label(c1dat$c1_1) <- "c1_1. Women\n union"
var_label(c1dat$c1_2) <- "c1_2. Youth\n union"
var_label(c1dat$c1_3) <- "c1_3. Veteran\n union"
var_label(c1dat$c1_4) <- "c1_4. Farmer\n union"
var_label(c1dat$c1_5) <- "c1_5. Elderly\n union"
var_label(c1dat$c1_6) <- "c1_6. Political\n party"
#We prepare the parameters for the function
colnames(c1dat)[4:11] <- var_label(c1dat)[4:11]
pond <- sum(HouseholdLaos_2C$Weight)
pond2 <- sum(HouseholdLaos_2C$Weight)
xT <- "Months"
ylimn <- -10
ylimx <- 85
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(c1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```



# III. Vietnam
```{r III, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis'}
##1.1 Data import
#dta format (from Ky) datasets import
setwd("C:/Users/titou/OneDrive/Bureau/ASSET Stats/WORKDIRECTORY/1.ASSET_data_cleaning-Titouan/ASSET_data_cleaning")
#We import all the dta files transmitted by Ky as *Vietnam* database
HouseholdVietnam_2C <- readRDS("HouseholdVietnam_2C.rds")
ClowlandVietnam_2C <- readRDS("ClowlandVietnam_2C.rds")
CuplandVietnam_2C <- readRDS("CuplandVietnam_2.rds")
HouMemberVietnam_2C <- readRDS("HouMemberVietnam_2C.rds")

#
colnames(HouseholdVietnam_2C)[26] <- "district_eng"
  
##1.2 - Preparation of functions and data

# # #1.2.a. YES, NO, DNK, NA  PIE PLOT
PiePlotYN <- function(data,list){
  #Changing the index by real answers:
  data$d <- list
  # Preparation of the plot
  # Compute percentages
  data$fraction <- data$n / sum(data$n)
  # Compute the cumulative percentages (top of each rectangle)
  data$ymax <- cumsum(data$fraction)
  # Compute the bottom of each rectangle
  data$ymin <- c(0, head(data$ymax, n=-1))
  # Compute label position
  data$labelPosition <- (data$ymax + data$ymin) / 2
  # Compute a good label
  data$label <- paste0(data$d, "\n", round(data$fraction*100, digits = 1), "%")
  #Prepare the color list
  col <- c("forestgreen","darkolivegreen2","lightblue","grey88")
  # Make the plot
  plot <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=d)) +
    geom_rect(fill = col[1:nrow(data)],colour = "black") +
    geom_label( x=3.5, aes(y=labelPosition, label=label), size=4, fill = col[1:nrow(data)]) +
    coord_polar(theta="y") +
    xlim(c(2, 4)) +
    theme_void() +
    theme(plot.title = element_text(hjust = 0.5, size = 13), legend.position = "none") +
    ggtitle(paste("Sample =", round(sum(data$n)/3.62, digits = 0), "/  Population = ",sum(data$n)))
  print(plot)
  }

# # #1.2.b. ADAPTATIVE PIE PLOT
PiePlot <- function(data,list){
  #Changing the index by real answers:
  data$d <- list
  # Preparation of the plot
  # Compute percentages
  data$fraction <- data$n / sum(data$n)
  # Compute the cumulative percentages (top of each rectangle)
  data$ymax <- cumsum(data$fraction)
  # Compute the bottom of each rectangle
  data$ymin <- c(0, head(data$ymax, n=-1))
  # Compute label position
  data$labelPosition <- (data$ymax + data$ymin) / 2
  # Compute a good label
  data$label <- paste0(data$d, "\n", round(data$fraction*100, digits = 1), "%")
  #Prepare the color list
  col <- c("#0066CC","lightblue","grey88")
  # Make the plot
  plot <- ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=d)) +
    geom_rect(fill = col[1:nrow(data)],colour = "black") +
    geom_label( x=3.5, aes(y=labelPosition, label=label), size=4, fill = col[1:nrow(data)]) +
    coord_polar(theta="y") +
    xlim(c(2, 4)) +
    theme_void() +
    theme(plot.title = element_text(hjust = 0.5, size = 13), legend.position = "none") +
    ggtitle(paste("Sample =", round(sum(data$n)/3.62, digits = 0), "/  Population = ",sum(data$n)))
  print(plot)
  }

# # #1.2.c. List PLOT
ListBPlot <- function(data,list,pond,xT,ylimn,dig){
  colnames(data)[1] <- 'Answer'
  data$Answer <- list
  #We convert absolute values to % y divinding by the total number of households
  data$Percentage_of_households <- round(data$n/as.numeric(pond)*100, digits=dig)
  #And now a distribution plot
  Plota <- ggplot(data=data, aes(x= reorder(Answer, -Percentage_of_households), y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=9, angle = 85),
          legend.position = "none")+
    labs(x= xT)+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(ylimn,max(data$Percentage_of_households)+20)+
    ggtitle(paste("Sample =", round(pond/3.62, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plota)
}

# # #1.2.d. List PLOT without order
ListBPlotNO <- function(data,list,pond,xT,ylimn,dig){
  colnames(data)[1] <- 'Answer'
  data$Answer <- list
  #We convert absolute values to % y divinding by the total number of households
  data$Percentage_of_households <- round(data$n/as.numeric(pond)*100, digits=dig)
  #And now a distribution plot
  Plota <- ggplot(data=data, aes(x= reorder(Answer, Answer), y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=9, angle = 85),
          legend.position = "none")+
    labs(x= xT)+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(ylimn,max(data$Percentage_of_households)+20)+
    ggtitle(paste("Sample =", round(pond/3.62, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plota)
}

# # #1.2.e. List PLOT with province information (as x)
ListBPlotProv <- function(data,pond,ylimn,dig,pal){
  dcount <- data
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ district_eng, data=HouseholdVietnam_2C, sum)
  dcount <- join(dcount, provtot, by = "district_eng")
  colnames(dcount)[4] <- "nbHHtot"
  dcount$Percentage_of_households <- round(dcount$n/as.numeric(dcount$nbHHtot)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcount)/2
  mycolors <- colorRampPalette(brewer.pal(9,pal))(nb.cols)
  #And now a distribution plot
  plotb <- ggplot(data=dcount, aes(x= `district_eng`, y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9))+
    ylim(ylimn, max(dcount$Percentage_of_households)+20)+
    scale_fill_manual(values = mycolors)+
    theme_stata(base_size = 9)+
    theme(legend.title=element_blank())+
    ggtitle(paste("Dien Bien dist.: S =",round(pond*0.51/3.62,digits = 0), "/ P =", round(pond*0.51,digits = 0) ,
                  "\n Moc Chau dist.: S = ",round(pond*0.49/3.62,digits = 0), "/ P =", round(pond*0.49,digits = 0)))
  print(plotb)
}

# # #1.2.f. List PLOT with province information (as x)
ListBPlotProvYN <- function(data,pond,ylimn,dig,pal){
  dcount <- data
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ district_eng, data=HouseholdVietnam_2C, sum)
  dcount <- join(dcount, provtot, by = "district_eng")
  colnames(dcount)[4] <- "nbHHtot"
  dcount$Percentage_of_households <- round(dcount$n/as.numeric(dcount$nbHHtot)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcount)
  mycolors <- colorRampPalette(brewer.pal(9,pal))(nb.cols)
  #And now a distribution plot
  plotb <- ggplot(data=dcount, aes(x= `district_eng`, y=Percentage_of_households, fill = Answer))+
    geom_bar(colour="black",position="stack", stat="identity")+
    geom_text(aes(label = Percentage_of_households), position = position_stack(vjust = .5))+
    scale_fill_manual(values = mycolors)+
    theme_stata(base_size = 9)+
    theme(legend.title=element_blank())+
    ggtitle(paste("Dien Bien dist.: S =",round(pond*0.51/3.62,digits = 0), "/ P =", round(pond*0.51,digits = 0) ,
                  "\n Moc Chau dist.: S = ",round(pond*0.49/3.62,digits = 0), "/ P =", round(pond*0.49,digits = 0)))
  print(plotb)
}

# # #1.2.g. PRACTICES PLOT
PracticePlot <- function(data,pond,pond2,xT,ylimn,ylimx,dig,pal){
  #Then we adapt the format to be able to plot it and create a table
  dmelt <- melt(data ,  id.vars = c('o9', 'district_eng','village_eng_preload','fpc','Weight'), variable.name = 'Practices')
  dstratb <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Practices+value, design=dstratb, exclude=NULL))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcountNAR <- dcount %>%  filter(!is.na(Answer) & Answer != '' & Answer != 0)
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcountNAR)
  mycolors <- colorRampPalette(brewer.pal(8, pal))(nb.cols)
  #And now a distribution plot
  plota <- ggplot(data=dcountNAR, aes(x=reorder(Practices, -Percentage_of_households), y=Percentage_of_households, fill = Practices))+
    geom_bar(colour="black",stat="identity")+
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8,angle = 60), legend.position = "none")+
    geom_text(aes(label = Percentage_of_households, vjust = -1)) + ylim(ylimn, ylimx)+
    scale_fill_manual(values= mycolors)+
    labs(x= xT)+
    ggtitle(paste("Sample =", round(pond/3.62, digits = 0), "/  Population = ",pond))
  print(plota)
  
  # # # #b.b Plot with provinces and total %
  #We create a counting table
  dcount <- as.data.frame(svytable(~district_eng+Practices+value, design=dstratb, exclude=NULL))
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != '' & value != 0)
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ district_eng, data=HouseholdVietnam_2C, sum)
  dcountNAR <- join(dcountNAR, provtot, by = "district_eng")
  colnames(dcountNAR)[4] <- "n"
  colnames(dcountNAR)[5] <- "nbHHtot"
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(dcountNAR$nbHHtot)*100, digits=dig)
  #And now a distribution plot
  plotb <- ggplot(data=dcountNAR, aes(x=reorder(Practices, -Percentage_of_households), y=Percentage_of_households, fill = `district_eng`))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    theme_stata(base_size = 9)+
    theme(axis.text.x = element_text(size=8,angle = 60),
          legend.title=element_blank())+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9))+
    ylim(ylimn, ylimx)+
    scale_fill_brewer(palette= pal, direction = -1)+
    labs(x= xT)+
    ggtitle(paste("Dien Bien dist.: S =",round(pond2*0.51/3.62,digits = 0), "/ P =", round(pond2*0.51,digits = 0) ,
                  "\n Moc Chau dist.: S = ",round(pond2*0.49/3.62,digits = 0), "/ P =", round(pond2*0.49,digits = 0)))
  print(plotb)
}

# # #1.2.h. PRACTICES PLOT FOR MONTHS
Monthplot <- function(data,pond,pond2,xT,ylimn,ylimx,dig,pal){
  #Then we adapt the format to be able to plot it and create a table
  dmelt <- melt(data ,  id.vars = c('o9', 'district_eng','village_eng_preload','fpc','Weight'), variable.name = 'Practices')
  dstratb <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Practices+value, design=dstratb, exclude=NULL))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcountNARa <- dcount %>%  filter(!is.na(Answer) & Answer != 0)
  #We convert absolute values to % y divinding by the total number of households
  dcountNARa$Percentage_of_households <- round(dcountNARa$n/as.numeric(pond)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcountNARa)
  mycolors <- colorRampPalette(brewer.pal(8, pal))(nb.cols)
  #And now a distribution plot
  plota <- ggplot(data=dcountNARa, aes(x=Practices, y=Percentage_of_households, fill = Practices))+
    geom_bar(colour="black",stat="identity")+
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8,angle = 60), legend.position = "none",
          panel.grid.major=element_line(colour="grey"))+
    geom_text(aes(label = Percentage_of_households, vjust = -1)) + ylim(ylimn, ylimx)+
    scale_fill_manual(values= mycolors)+
    labs(x= xT)+
    ggtitle(paste("Sample =", round(pond/3.62, digits = 0), "/  Population = ",pond))
  print(plota)
  
  # # # #b.b Plot with provinces and total %
  #We create a counting table
  dcount <- as.data.frame(svytable(~district_eng+Practices+value, design=dstratb, exclude=NULL))
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != 0)
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ district_eng, data=HouseholdVietnam_2C, sum)
  dcountNAR <- join(dcountNAR, provtot, by = "district_eng")
  colnames(dcountNAR)[4] <- "n"
  colnames(dcountNAR)[5] <- "nbHHtot"
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(dcountNAR$nbHHtot)*100, digits=dig)
  #And now a distribution plot
  plotb <- ggplot(data=dcountNAR, aes(x=Practices, y=Percentage_of_households, fill = `district_eng`))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    theme_stata(base_size = 9)+
    theme(axis.text.x = element_text(size=8,angle = 60),legend.title=element_blank())+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9))+
    ylim(ylimn, ylimx)+
    scale_fill_brewer(palette= pal, direction = -1)+
    labs(x= xT)+
    ggtitle(paste("Dien Bien dist.: S =",round(pond2*0.51/3.62,digits = 0), "/ P =", round(pond2*0.51,digits = 0) ,
                  "\n Moc Chau dist.: S = ",round(pond2*0.49/3.62,digits = 0), "/ P =", round(pond2*0.49,digits = 0)))
  print(plotb)
}

# # #1.2.i. CROP PLOT (big or small tables)
#For this function, we should use a database including column with household id 
#+ 11 columns with binary values for each crops
CropPlot <- function(data,pond, ylimn,ylimx,dig){
  #We replace binary values by crop names
  for (i in 3:13){
    data[,i] <- as.character(data[,i])
    for (j in 1:595){
      data[j,i] <- ifelse(data[j,i] == '1', dcrops[j,i], data[j,i])
    }
  }
  # We melt data frame into long format
  dmelt <- melt(data, id.vars = c("o9","village_eng_preload","fpc","Weight"))
  dmelt <- dmelt %>%  filter(!is.na(o9))
  # SVy design implementation
  dstrate <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  #We count the answers and filter NA and "no" values
  dcount <- as.data.frame(svytable(~value, design=dstrate, exclude=NULL))
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != 0)
  colnames(dcountNAR)[2] <- "n"
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=dig)
  #We order the table
  dcountNAR <- dcountNAR[order(-dcountNAR$Percentage_of_households), ]
  if (nrow(dcountNAR) > 15){
    dcountNARa <- dcountNAR[1:as.numeric(nrow(dcountNAR)/2),]
    dcountNARb <- dcountNAR[as.numeric((nrow(dcountNAR)/2+1)):as.numeric(nrow(dcountNAR)),]
    #And now a distribution plot
    Plota <- ggplot(data=dcountNARa, aes(x= reorder(value, -Percentage_of_households), y=Percentage_of_households, fill = value))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=9, angle = 85), legend.position = "none"
          , axis.title.x = element_blank())+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(ylimn,ylimx)+
      ggtitle(paste("Sample =", round(pond/3.62, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
    print(Plota)
    #2nd plot
    Plotb  <- ggplot(data=dcountNARb, aes(x= reorder(value, -Percentage_of_households), y=Percentage_of_households, fill = value))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=9, angle = 85), legend.position = "none", 
          axis.title.x = element_blank())+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(ylimn,ylimx)+
    ggtitle(paste("Sample =", round(pond/3.62, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plotb)} else {
    #And now a distribution plot
      Plota <- ggplot(data=dcountNAR, aes(x= reorder(value, -Percentage_of_households), y=Percentage_of_households, fill = value))+
      geom_bar(colour="black",stat="identity") +
      theme_stata(base_size = 8)+
      theme(axis.text.x = element_text(size=9, angle = 85), legend.position = "none"
            , axis.title.x = element_blank())+
      geom_text(aes(label = Percentage_of_households, vjust = -1))+
      ylim(ylimn,ylimx)+
      ggtitle(paste("Sample =", round(pond/3.62, digits = 0), "/  Population = ",pond))+
      scale_fill_viridis_d(alpha = 1,
                           begin = 0,
                           end = 1,
                           direction = 1,
                           option = "E",
                           na.value = "grey50",
                           guide = "colourbar",
                           aesthetics = "fill")
      print(Plota)
    
  }
}

# # #1.2.j. ANIMAL PLOT
AnimalPlot <- function(data,pond){
  data[,3] <- as.character(data[,3])
  colnames(data)[2] <- "Animal"
  for (j in 1:594){
    data[j,3] <- ifelse(data[j,3] == 1, data[j,2], data[j,3])
  }
  data$Animal <- ifelse(is.na(data$Animal), '', data$Animal)
  #We count the answers and filter NA and "no" values
  dstratAn <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = data)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Animal, design=dstratAn, exclude=NULL))
  colnames(dcount)[2] <- "n"
  dcountNAR <- dcount %>%  filter(Animal != 0 & Animal != '')
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=1)
  #We order the table
  dcountNAR <- dcountNAR[order(-dcountNAR$Percentage_of_households), ]
  #And now a distribution plot
  Plota <- ggplot(data=dcountNAR, aes(x= reorder(Animal, -Percentage_of_households), y=Percentage_of_households, fill = Animal))+
    geom_bar(colour="black",stat="identity") +
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8, angle = 85), legend.position = "none", 
          axis.title.x = element_blank())+
    geom_text(aes(label = Percentage_of_households, vjust = -1))+
    ylim(-10,max(dcountNAR$Percentage_of_households)+20)+
    ggtitle(paste("Sample =", round(pond/3.62, digits = 0), "/  Population = ",pond))+
    scale_fill_viridis_d(alpha = 1,
                         begin = 0,
                         end = 1,
                         direction = 1,
                         option = "E",
                         na.value = "grey50",
                         guide = "colourbar",
                         aesthetics = "fill")
  print(Plota)
}

# # #1.3 Preparation of Crops reference table
{
#First we turn upland and lowland data to wide format (Duplicate alert = Normal,
#we had no time to take care of it yet)
dlowc <- ClowlandVietnam_2C[,c(1:2,9)]
dlowcwide <- reshape(dlowc, direction = "wide", timevar = "crop1_now", idvar = "hhid_re2")
dlowcwide <- dlowcwide %>% relocate(d2_13e.2 , .before = d2_13e.3)
dupc <- CuplandVietnam_2C[,c(1:2,8)]
colnames(dupc)[colnames(dupc) == "hhid_re3"] ="hhid_re2"
dupcwide <- reshape(dupc, direction = "wide", timevar = "crop2_now", idvar = "hhid_re2")
#We create a table with all the id
HHid <- HouseholdVietnam_2C[,1:2]
colnames(HHid)[colnames(HHid) == "o9"] = "hhid_re2"
#We merge the tables
dcrops <- merge(HHid, dlowcwide, by.x= "hhid_re2", all = T)
dcrops <- merge(dcrops, dupcwide, by.x = "hhid_re2", all = T)
#And we remove useless columns
dcrops <- dcrops[,-c(2,8)]
x <- HouseholdVietnam_2C[,c(1,2)]
colnames(x)[1] <- "hhid_re2"
dcrops <- join(x,dcrops,by = "hhid_re2", match = "first")
# #Additionnal stuffs
#We convert data to the proper format
dlowc$d2_13e <- as.factor(dlowc$d2_13e)
dupc$d2_23e <- as.factor(dupc$d2_23e)
#We create a column including the information if the household is growing crops or no
HouseholdVietnam_2C$CropYN <- ifelse(is.na(HouseholdVietnam_2C$no_crop1) & is.na(HouseholdVietnam_2C$no_crop2), '0', '1')
}

# # #Preparation of household head table and related stuff
{
Province <- cbind(as.character(HouseholdVietnam_2C$o9),as.character(HouseholdVietnam_2C$district_eng))
HouMemberProv <- merge(Province, HouMemberVietnam_2C, by.x = "V1", by.y = "hhid_re1")
HouHead <- HouMemberProv[HouMemberProv$a2 == '1',]
HouHead <- copy_labels(HouHead, HouMemberVietnam_2C)
colnames(HouMemberProv)[1:2] <- c("o9","Province")
colnames(HouHead)[1:2] <- c("o9","Province")
#We add HH information to the main table
HouseholdVietnam_2C <- join(HouseholdVietnam_2C, HouHead, by = "o9", match = "first")
HouseholdVietnam_2C$Fill <- c(1)
HouseholdVietnam_2C <- HouseholdVietnam_2C %>% relocate(Fill, .after = d18_11111_a)

#Also, we create a categorical variable with age range instead of quantitative value
HouseholdVietnam_2C$AgeCat <- cut(HouseholdVietnam_2C$a4_1,
                      breaks=c(20,30, 35, 40, 45, 50, 55, 60, 65, 70,100),
                      labels=c('<30', '30-34', '35-39', '40-44','45-49','50-54',
                               '55-59','60-64','65-69','>69'))
}

# # #Preparation of other columns
{
#For some columns, we just add NA as factor level to include it to the tables then

  HouseholdVietnam_2C$a3 <- factor(HouseholdVietnam_2C$a3, exclude=NULL)
HouseholdVietnam_2C$AgeCat <- factor(HouseholdVietnam_2C$AgeCat, exclude=NULL)
HouseholdVietnam_2C$a6 <- factor(HouseholdVietnam_2C$a6, exclude=NULL)
HouseholdVietnam_2C$d17 <- factor(HouseholdVietnam_2C$d17, exclude=NULL)
HouseholdVietnam_2C$d20 <- factor(HouseholdVietnam_2C$d20, exclude=NULL)
HouseholdVietnam_2C$e13 <- factor(HouseholdVietnam_2C$e13, exclude=NULL)
HouseholdVietnam_2C$e13_1 <- factor(HouseholdVietnam_2C$e13_1, exclude=NULL)
HouseholdVietnam_2C$d140 <- factor(HouseholdVietnam_2C$d140, exclude=NULL)
HouseholdVietnam_2C$e58 <- factor(HouseholdVietnam_2C$e58, exclude=NULL)
HouseholdVietnam_2C$e59 <- factor(HouseholdVietnam_2C$e59, exclude=NULL)
HouseholdVietnam_2C$e60 <- factor(HouseholdVietnam_2C$e60, exclude=NULL)
HouseholdVietnam_2C$e26 <- factor(HouseholdVietnam_2C$e26, exclude=NULL)
HouseholdVietnam_2C$e40 <- factor(HouseholdVietnam_2C$e40, exclude=NULL)
HouseholdVietnam_2C$e54 <- factor(HouseholdVietnam_2C$e54, exclude=NULL)
HouseholdVietnam_2C$d32 <- factor(HouseholdVietnam_2C$d32, exclude=NULL)
HouseholdVietnam_2C$e5_b <- factor(HouseholdVietnam_2C$e5_b, exclude=NULL)
HouseholdVietnam_2C$TotCrop <- ifelse(!is.na(HouseholdVietnam_2C$no_crop1),HouseholdVietnam_2C$no_crop1,0) +
  ifelse(!is.na(HouseholdVietnam_2C$no_crop2),HouseholdVietnam_2C$no_crop2,0)
HouseholdVietnam_2C$TotCrop <- as.factor(HouseholdVietnam_2C$TotCrop)
HouseholdVietnam_2C$TotCrop <- factor(HouseholdVietnam_2C$TotCrop, exclude=NULL)
HouseholdVietnam_2C$d26 <- factor(HouseholdVietnam_2C$d26, exclude=NULL)
HouseholdVietnam_2C$b1 <- factor(HouseholdVietnam_2C$b1, exclude=NULL)
HouseholdVietnam_2C$b2 <- factor(HouseholdVietnam_2C$b2, exclude=NULL)
HouseholdVietnam_2C$b9 <- factor(HouseholdVietnam_2C$b9, exclude=NULL)
HouseholdVietnam_2C$c8 <- factor(HouseholdVietnam_2C$c8, exclude=NULL)
HouseholdVietnam_2C$l7 <- factor(HouseholdVietnam_2C$l7, exclude=NULL)
HouseholdVietnam_2C$b10 <- factor(HouseholdVietnam_2C$b10, exclude=NULL)
HouseholdVietnam_2C$b16 <- factor(HouseholdVietnam_2C$b16, exclude=NULL)
HouseholdVietnam_2C$l2 <- factor(HouseholdVietnam_2C$l2, exclude=NULL)

#(Need to create an indicator including all the product household sell,
  #animal and crops)
  #1st for lowland
  Province <- cbind(as.character(HouseholdVietnam_2C$o9),as.character(HouseholdVietnam_2C$district_eng))
  LowlandProv <- merge(Province, ClowlandVietnam_2C, by.x = "V1", by.y = "hhid_re2")
  colnames(LowlandProv)[1:2] <- c("o9","Province")
  LowlandSold <- LowlandProv %>% filter(LowlandProv$d2_136 != 0)
  ncrop_soldl <- LowlandSold %>%
    dplyr::count(`Province`,`o9`)
  #2nd for upland
  UplandProv <- merge(Province, CuplandVietnam_2C, by.x = "V1", by.y = "hhid_re3")
  colnames(UplandProv)[1:2] <- c("o9","Province")
  UplandSold <- UplandProv %>% filter(UplandProv$d2_236 != 0)
  ncrop_soldu <- UplandSold %>%
    dplyr::count(`Province`,`o9`)
  #3rd for the 3 main animals
  AniSold <- HouseholdVietnam_2C[,c(1,26,1918,1946,1965)]
  for (i in 3:5){
    AniSold[,i] <- ifelse(AniSold[,i] > 0, '1', '0')
    AniSold[,i] <- as.numeric(AniSold[,i])
  }
    AniSold$Nani <- ifelse(!is.na(AniSold$e5_4),AniSold$e5_4,0) + ifelse(!is.na(AniSold$e6_4),AniSold$e6_4,0) + ifelse(!is.na(AniSold$e7_4),AniSold$e7_4,0)
  #Now we merge these 3 tables together
  Dummy <- merge(ncrop_soldl, ncrop_soldu, by = "o9", all = T)
  SoldProd <- merge(AniSold,Dummy, by = "o9", all = T)
  SoldProd$SoldProdTot <- as.numeric(ifelse(!is.na(SoldProd$Nani), SoldProd$Nani,'0'))+ 
    as.numeric(ifelse(!is.na(SoldProd$n.x), SoldProd$n.x,'0'))+
    as.numeric(ifelse(!is.na(SoldProd$n.y), SoldProd$n.y,'0'))
  SoldProd <- SoldProd[,c(1,11)]
  HouseholdVietnam_2C <- join(HouseholdVietnam_2C,SoldProd, by = "o9")
  
  #Create another column
  HouseholdVietnam_2C$OwnPast <- ifelse(HouseholdVietnam_2C$e12_1 == '1' |
                                          HouseholdVietnam_2C$e12_3 == '1' |
                                          HouseholdVietnam_2C$e12_5 == '1', '1', '0')
  HouseholdVietnam_2C$OwnPast <- factor(HouseholdVietnam_2C$OwnPast, exclude=NULL)
}

##1.4 Preparation of Sampling weight through svy design function
{
#First we add a column in which we add the sampling weight for each household
x <- as.data.frame(summary(HouseholdVietnam_2C$village_eng_preload))
x$fpc <- c(66,56,89,121,95,75,51,139,121,94,180,252,176,
           123,94,109,83,46,95,87)
x$Weight <- x$fpc/x$`summary(HouseholdVietnam_2C$village_eng_preload)`
x$village_eng_preload <- rownames(x)
colnames(x)[1] <- "SurH"
HouseholdVietnam_2C <- join(HouseholdVietnam_2C, x, by = "village_eng_preload")
dstrat <- svydesign(
  id = ~1, strata = ~village_eng_preload,
  weights = ~Weight, data = HouseholdVietnam_2C,
  fpc = ~fpc)
#We add the proper labels to the main database
label <- readRDS("HouseholdVietnam_2C.rds")
HouseholdVietnam_2C <- copy_labels(HouseholdVietnam_2C,label)
}
```

## III.1. Data analysis - General

### III.1.1 Household characteristics
```{r III.1.1, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
##III.1.1 Household characteristics
{
# # #III.1.1.a. o10. Are both the man and the woman available for the interview?
cat('\n####',"III.1.1.a o10. Are both the man and the woman available for the interview?", '\n')
#We create a counting table and a title
o10count <- as.data.frame(svytable(~o10, design=dstrat))
colnames(o10count)[2] <- "n"
list <- c("yes","no")
#Now we create the plot with the corresponding function
PiePlotYN(o10count,list)
cat('\n')
#Check

# # #III.1.1.b. o11. Who do you do the interview with? (Men and Women
#distribution as respondent) - General
cat('\n####',"III.1.1.b. o11. Who do you do the interview with? (Men and Women distribution as respondent) - General", '\n')
#We create a counting table and a title
o11count <- as.data.frame(svytable(~o11, design=dstrat))
colnames(o11count)[2] <- "n"
list <- c("Male","Female")
pond <- sum(o11count$n)
#Now we create the plot with the corresponding function
PiePlot(o11count,list)
cat('\n')
#Check

# # #III.1.1.c. o11. Who do you do the interview with? (Men and Women
#distribution as respondent) - /District
cat('\n####',"III.1.1.c. o11. Who do you do the interview with? (Men and Women distribution as respondent) - /District", '\n')
#We create a counting table and add the information required for the function
dcount <- as.data.frame(svytable(~district_eng+o11, design=dstrat))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount$Answer <- c("Male","Male","Female","Female")
pond <- sum(dcount$n)
ylimn <- 0
dig = 1
pal = "Blues"
#Now we create the plot with the corresponding function
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.1.1.d. a3. What is the sex of a1 (Household head)?
cat('\n####',"III.1.1.d. a3. What is the sex of a1 (Household head)?", '\n')
#We create a counting table and a title
a3count <- as.data.frame(svytable(~a3, design=dstrat, exclude=NULL))
colnames(a3count)[2] <- "n"
list <- c("Male","Female","NA")
pond <- sum(a3count$n)
#Now we create the table with the corresponding function
PiePlot(a3count,list)
print("COMMENT: HH maybe passed away, I wait for confirmation (also for following plots)")
cat('\n')
#Check

# # #III.1.1.e. Household head age distribution
cat('\n####',"III.1.1.e. Household head age distribution", '\n')
#First we create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+AgeCat, design=dstrat))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
pond <- sum(dcount$n)
xT <- "Age (years)"
ylimn <- 0
dig = 0
pal = "Greens"
#Now we create the plot with the corresponding function
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.1.1.f. Household head occupation distribution
cat('\n####',"III.1.1.f. Household head occupation distribution", '\n')
dcount <- as.data.frame(svytable(~district_eng+a6, design=dstrat))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c('a. Agricultural work\n (own farm)','b.Other farm\n salaried employment\n (permanent)',
                   'c.Other farm\n salaried employment\n (temporary)','d.Government','e.Business (owner)', 
                   'f.Salaried employment\n (non-agricultural work)','g.Housewife/\n caregiver',
                   'h.Unable\n to work','i.Other',NA)
pond <- sum(dcount$n)
xT <- "Occupation"
ylimn <- -20
dig <- 0
pal = "Greens"
#Now we create the plot with the corresponding function
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.1.1.g. Distribution of Household members number
cat('\n####',"III.1.1.g. Distribution of Household members number", '\n')
#First we create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+a0, design=dstrat))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
pond <- sum(dcount$n)
xT <- "Num of household members"
ylimn <- 0
dig <- 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check
}

```

### III.1.2 Land & Crops characteristics
```{r III.1.2, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.1.2.a. d1. What kinds of land did your household have in the past 12 months?
cat('\n####',"III.1.2.a. d1. What kinds of land did your household have in the past 12 months?", '\n')
#First, we select the useful data
d1dat <- HouseholdVietnam_2C[,c(1,26,32,661:667,2832,2833)]
#We restore the column proper names
colnames(d1dat)[4:10] <- var_label(d1dat)[4:10]
#We fulfil the information required in the function
pond <- sum(HouseholdVietnam_2C$Weight)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Kind of land owned"
ylimn <- -20
ylimx <- 110
dig = 0
pal = "Dark2"
PracticePlot(d1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.1.2.b. Growing crops - Yes or No
cat('\n####',"III.1.2.b. Growing crops - Yes or No", '\n')
#We create a counting table and a title
CropYNcount <- as.data.frame(svytable(~CropYN, design=dstrat))
CropYNcount <- CropYNcount[c("2","1"),]
colnames(CropYNcount)[2] <- "n"
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(CropYNcount,list)
cat('\n')
#Check

# # #III.1.2.c. Crop diversity - Lowland (Household based)
cat('\n####',"III.1.2.c. Crop diversity - Lowland (Household based)", '\n')
#First we need to apply a new survey design
Dumm <- HouseholdVietnam_2C[,c(1,32,2832,2833)]
colnames(dlowc)[2] <- "o9"
dlowc2 <- join(dlowc, Dumm, by = "o9")
dstratf <- svydesign(
  id = ~1, strata = ~village_eng_preload,
  weights = ~Weight, data = dlowc2)
#We create a counting table and a title
Cropcount <- as.data.frame(svytable(~d2_13e, design=dstratf))
colnames(Cropcount)[2] <- "n"
#We determine other function parameters
pond <- sum(HouseholdVietnam_2C$Weight)
#As there are many different crops, we'll display several plots
Cropcount <- Cropcount[order(-Cropcount$n),]
Cropcount$d2_13e <- as.character(Cropcount$d2_13e)
#We change too large crops label names 
Cropcount[1,1] <- "Summer-autumn\n season rice"
Cropcount[2,1] <- "Winter-Spring\n season rice"
Cropcount[5,1] <- "Other vegetable\n crop"
Cropcount[6,1] <- "Sweet potatoes\n, tuber"
Cropcount[17,1] <- "Cauliflowers,\n Broccoli"
Cropcount[18,1] <- "Chinese kale/\n Gailan"
Cropcount[29,1] <- "Chinese\n flowering cabbage/\n choysum"
Cropcount[30,1] <- "Chrysanthemum,\n leaves"
Cropcount[32,1] <- "Lettuce,\n romaine,\n leaves"
Cropcount[37,1] <- "Other orchards\n crop"
Cropcount[39,1] <- "Zucchini,\n common green,\n fruit"
Cropcount[40,1] <- "Basil, sweet,\n leaves"
Cropcount[43,1] <- "Green mustard/\n Choysum"
Cropcount[47,1] <- "Long bean,\ Chinese"
Cropcount[48,1] <- "Moutainous\n rice"
Cropcount[49,1] <- "Other annual\n crop"
Cropcount[53,1] <- "Pomelos and\n grapefruits"
Cropcount[55,1] <- "Sawtooth herb /\n Culantro"
xT <- "Crops"
ylimn <- -15
#For the 14 first crops
Cropcount1 <- Cropcount[c(1:14),]
list1 <- Cropcount$d2_13e[c(1:14)]
dig <- 0
ListBPlot(Cropcount1,list1,pond,xT,ylimn,dig)
#For the 14 second crops
ylimn <- -10
dig <- 1
Cropcount2 <- Cropcount[c(15:28),]
list2 <- Cropcount$d2_13e[c(15:28)]
ListBPlot(Cropcount2,list2,pond,xT,ylimn,dig)
#For the 14 third crops
Cropcount3 <- Cropcount[c(29:42),]
list3 <- Cropcount$d2_13e[c(29:42)]
ListBPlot(Cropcount3,list3,pond,xT,ylimn,dig)
#For the 14 fourth crops
Cropcount4 <- Cropcount[c(43:56),]
list4 <- Cropcount$d2_13e[c(43:56)]
ListBPlot(Cropcount4,list4,pond,xT,ylimn,dig)
cat('\n')
#Check

# # #III.1.2.d. Crop diversity - Upland (Household based)
cat('\n####',"III.1.2.d. Crop diversity - Upland (Household based)", '\n')
#First we need to apply a new survey design
colnames(dupc)[2] <- "o9"
dupc2 <- join(dupc, Dumm, by = "o9")
dupc2 <- dupc2[!is.na(dupc2$Weight),]
dstratg <- svydesign(
  id = ~1, strata = ~village_eng_preload,
  weights = ~Weight, data = dupc2)
#We create a counting table and a title
Cropcount <- as.data.frame(svytable(~d2_23e, design=dstratg))
colnames(Cropcount)[2] <- "n"
#We determine other function parameters
pond <- sum(HouseholdVietnam_2C$Weight)
#As there are many different crops, we'll display several plots
Cropcount <- Cropcount[order(-Cropcount$n),]
Cropcount$d2_23e <- as.character(Cropcount$d2_23e)
#We change too large crops label names 
Cropcount[8,1] <- "Summer-autumn\n season rice"
Cropcount[11,1] <- "Other vegetable\n crop"
Cropcount[12,1] <-"Winter-Spring\n season rice"
Cropcount[20,1] <- "Other orchards\n crop"
Cropcount[23,1] <- "Pomelos and\n grapefruits"
Cropcount[27,1] <-"Other perenial\n crop"
Cropcount[28,1] <- "Eggplant,\n Thai"
Cropcount[38,1] <- "Sweet potatoes,\n leaves"
xT <- "Crops"
ylimn <- -10
#For the 14 first crops
Cropcount1 <- Cropcount[c(1:14),]
list1 <- Cropcount$d2_23e[c(1:14)]
dig <- 0
ListBPlot(Cropcount1,list1,pond,xT,ylimn,dig)
#For the 14 second crops
ylimn <- -5
dig <- 1
Cropcount2 <- Cropcount[c(15:28),]
list2 <- Cropcount$d2_23e[c(15:28)]
ListBPlot(Cropcount2,list2,pond,xT,ylimn,dig)
#For the 14 third crops
Cropcount3 <- Cropcount[c(29:38),]
list3 <- Cropcount$d2_23e[c(29:38)]
ListBPlot(Cropcount3,list3,pond,xT,ylimn,dig)
cat('\n')
#Check

# # #III.1.2.e. Crop diversity - Lowland (Area based)
cat('\n####',"III.1.2.e. Crop diversity - Lowland (Area based)", '\n')
dlowc2 <- ClowlandVietnam_2C[,c(1:2,9,11)]
dlowc2$d2_132 <- as.character(dlowc2$d2_132)
dlowc2$d2_132 <- as.numeric(dlowc2$d2_132)
colnames(dlowc2)[2] <- "o9"
dlowc2 <- join(dlowc2, Dumm, by = "o9")
dlowc2$NewAre <- dlowc2$d2_132*dlowc2$Weight
#We sum the area per crops
result  <- aggregate(NewAre ~ d2_13e, dlowc2, sum)
result$AverageTot <- result$NewAre/sum(ifelse(!is.na(HouseholdVietnam_2C$no_crop1), 1, 0)*HouseholdVietnam_2C$Weight)
result$AverageTot <- as.numeric(format(result$AverageTot,scientific = FALSE, digits = 1))
result$AverageTot <- round(result$AverageTot, digits = 0)
#Now we prepare the data for the function
#We determine other function parameters
pond <- round(sum(ifelse(!is.na(HouseholdVietnam_2C$no_crop1), 1, 0)*HouseholdVietnam_2C$Weight), digits = 0)
result <- result[order(-result$AverageTot),]
#As there are many different crops, we'll display several plots
result$d2_13e <- as.character(result$d2_13e)
colnames(result)[3] <- 'n'
#We change too large crops label names 
result[1,1] <- "Summer-autumn\n season rice"
result[2,1] <- "Winter-Spring\n season rice"
result[5,1] <- "Other vegetable\n crop"
result[10,1] <- "Sweet potatoes\n, tuber"
result[19,1] <- "Zucchini,\n common green,\n fruit"
result[24,1] <- "Other orchards\n crop"
result[26,1] <- "Long bean,\ Chinese"
result[28,1] <- "Pomelos and\n grapefruits"
result[30,1] <- "Cauliflowers,\n Broccoli"
result[31,1] <- "Other annual\n crop"
result[37,1] <- "Chinese\n flowering cabbage/\n choysum"
result[38,1] <- "Basil, sweet,\n leaves"
result[41,1] <- "Moutainous\n rice"
result[43,1] <- "Chinese kale/\n Gailan"
result[45,1] <- "Chrysanthemum,\n leaves"
result[54,1] <- "Sawtooth herb /\n Culantro"
result[56,1] <- "Lettuce,\n romaine,\n leaves"
result[57,1] <- "Green mustard/\n Choysum"
xT <- "Crops"
ylimn <- -400
#We'll plot only the 10 first crops
result1 <- result[c(1:10),]
list1 <- result$d2_13e[c(1:10)]
dig <- 0
Plota <- ggplot(data=result1, aes(x= reorder(d2_13e, -n), y= n, fill = d2_13e))+
  geom_bar(colour="black",stat="identity") +
  theme_stata(base_size = 8)+
  theme(axis.text.x = element_text(size=8, angle = 85),
        legend.position = "none")+
  labs(x= xT)+
  labs(y= "area (m2)")+
  geom_text(aes(label = n, vjust = -1))+
  ylim(ylimn,max(result1$n)+200)+
  ggtitle(paste("Sample =", round(pond/3.62, digits = 0), "/  Population = ",pond))+
  scale_fill_viridis_d(alpha = 1,
                       begin = 0,
                       end = 1,
                       direction = 1,
                       option = "E",
                       na.value = "grey50",
                       guide = "colourbar",
                       aesthetics = "fill")
print(Plota)
cat('\n')
#Check

# # #III.1.2.f. Crop diversity - Upland (Area based)
cat('\n####',"III.1.2.f. Crop diversity - Upland (Area based)", '\n')
dupc2 <- CuplandVietnam_2C[,c(1:2,8,10)]
dupc2$d2_232 <- as.character(dupc2$d2_232)
dupc2$d2_232 <- as.numeric(dupc2$d2_232)
colnames(dupc2)[2] <- "o9"
dupc2 <- join(dupc2, Dumm, by = "o9")
dupc2$NewAre <- dupc2$d2_232*dupc2$Weight
#We sum the area per crops
result  <- aggregate(NewAre ~ d2_23e, dupc2, sum)
result$AverageTot <- result$NewAre/sum(ifelse(!is.na(HouseholdVietnam_2C$no_crop2), 1, 0)*HouseholdVietnam_2C$Weight)
result$AverageTot <- round(result$AverageTot, digits = 0)
#Now we prepare the data for the function
#We determine other function parameters
pond <- round(sum(ifelse(!is.na(HouseholdVietnam_2C$no_crop2), 1, 0)*HouseholdVietnam_2C$Weight), digits = 0)
result <- result[order(-result$AverageTot),]
#As there are many different crops, we'll display several plots
result$d2_23e <- as.character(result$d2_23e)
colnames(result)[3] <- 'n'
#We change too large crops label names 
result[9,1] <- "Summer-autumn\n season rice"
result[13,1] <- "Other vegetable\n crop"
result[17,1] <-"Winter-Spring\n season rice"
result[19,1] <-"Other perenial\n crop"
result[20,1] <- "Other orchards\n crop"
result[27,1] <- "Pomelos and\n grapefruits"
result[33,1] <- "Eggplant,\n Thai"
result[38,1] <- "Sweet potatoes,\n leaves"
xT <- "Crops"
ylimn <- -600
#We'll plot only the 10 first crops
result1 <- result[c(1:10),]
list1 <- result$d2_23e[c(1:10)]
dig <- 0
Plota <- ggplot(data=result1, aes(x= reorder(d2_23e, -n), y= n, fill = d2_23e))+
  geom_bar(colour="black",stat="identity") +
  theme_stata(base_size = 8)+
  theme(axis.text.x = element_text(size=9, angle = 85),
        legend.position = "none")+
  labs(x= xT)+
  labs(y= "area (m2)")+
  geom_text(aes(label = n, vjust = -1))+
  ylim(ylimn,max(result1$n)+500)+
  ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))+
  scale_fill_viridis_d(alpha = 1,
                       begin = 0,
                       end = 1,
                       direction = 1,
                       option = "E",
                       na.value = "grey50",
                       guide = "colourbar",
                       aesthetics = "fill")
print(Plota)
cat('\n')
#Check
```

### III.1.3 Animal characteristics
```{r III.1.3, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.1.3.a. e2. If yes, which below animal does your household have?
cat('\n####',"III.1.3.a. e2. If yes, which below animal does your household have?", '\n')
#First, we select the useful data
e2dat <- HouseholdVietnam_2C[,c(1,26,32,1871:1883,2832,2833)]
for (i in 4:16){
  e2dat[,i] <- as.factor(e2dat[,i])
  #We restore the column label real names
  colnames(e2dat)[i] <- var_label(e2dat)[i]
}
pond <- round(sum(ifelse(HouseholdVietnam_2C$e1 == '1',1,0)*HouseholdVietnam_2C$Weight), digits = 0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Animals"
ylimn <- -10
ylimx <- 85
dig = 0
pal = "Dark2"
PracticePlot(e2dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

## III.2. Data analysis for Agroecological principles

### III.2.1 - Recycling
```{r III.2.1, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.1.a. d17. Does your household use ecological/agroecological/integrated practices to maintain/enhance soil fertility in your fields?
cat('\n####',"III.2.1.a. d17. Does your household use ecological/agroecological/integrated practices to maintain/enhance soil fertility in your fields?", '\n')
#We create a counting table and a title
d17count <- as.data.frame(survey::svytable(~d17, design=dstrat, exclude=NULL))
d17count$d17 <- as.character(d17count$d17)
colnames(d17count)[2] <- "n"
d17count[4,1] <- '/'
#We order the answers
d17count <- d17count[c("2","1","3","4"),]
list <- c("yes","no","do not know", "NC")
#Now we create the table with the corresponding function
PiePlotYN(d17count,list)
cat('\n')
#Check

# # #III.2.1.b. d18 - Which of the following ecological/agroecological/integrated practices
cat('\n####',"III.2.1.b. d18 - Which of the following ecological/agroecological/integrated practices", '\n')
#does your household use to maintain/enhance soil fertility in your fields?
#First, we select the useful data
d18dat <- HouseholdVietnam_2C[,c(1,26,32,1114:1125,2832,2833)]
#We modify long label names
var_label(d18dat$d183) <- 'Bokashi (fermented\norganic matter)'
var_label(d18dat$d184) <- 'Legume-based\ngreen manure'
var_label(d18dat$d185) <- 'Pulses in association and/or\n rotation with main crop'
var_label(d18dat$d186) <- 'Cover crops in association and/\nor rotation with main crop'
var_label(d18dat$d188) <- 'Crop residue\nmaintenance'
var_label(d18dat$d189) <- 'Recycling\ncrop waste'
var_label(d18dat$d1810) <- 'Ramial Wood Chip (RWC) or\n otherwood chips'
var_label(d18dat$d1811) <- 'Organic agro-\nindustrial waste'
colnames(d18dat)[4:15] <- var_label(d18dat)[4:15]
pond <- round(sum(ifelse(HouseholdVietnam_2C$d17 == '2', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Practices"
ylimn <- -35
ylimx <- 100
dig = 0
pal = "Dark2"
PracticePlot(d18dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.1.c. d18_11. For which crop(s) do you use animal manure?
cat('\n####',"III.2.1.c. d18_11. For which crop(s) do you use animal manure?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1811dat <- HouseholdVietnam_2C[,c(1,32,1128:1138,2832,2833)]
val <- round(sum(ifelse(HouseholdVietnam_2C$d181 != 0 & !is.na(HouseholdVietnam_2C$d181), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
ylimn <- -30
ylimx <- 60
dig = 0
#We apply the plotting function
CropPlot(d1811dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #III.2.1.d. d18_21. For which crop(s) do you use Compost (heap)?
cat('\n####',"III.2.1.d. d18_21. For which crop(s) do you use Compost (heap)?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1821dat <- HouseholdVietnam_2C[,c(1,32,1142:1152,2832,2833)]
val <- round(sum(ifelse(HouseholdVietnam_2C$d182 != 0 & !is.na(HouseholdVietnam_2C$d182), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
ylimn <- -20
ylimx <- 60
dig = 0
#We apply the plotting function
CropPlot(d1821dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #III.2.1.e. d18_31. For which crop(s) do you use Bokashi (fermented organic matter)?
cat('\n####',"III.2.1.e. d18_31. For which crop(s) do you use Bokashi (fermented organic matter)?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1831dat <- HouseholdVietnam_2C[,c(1,32,1156:1166,2832,2833)]
val <- round(sum(ifelse(HouseholdVietnam_2C$d183 != 0 & !is.na(HouseholdVietnam_2C$d183), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
ylimn <- -40
ylimx <- 100
dig = 0
#We apply the plotting function
CropPlot(d1831dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #III.2.1.f. d18_41. For which crop(s) do you use legume-based green manure?
cat('\n####',"III.2.1.f. d18_41. For which crop(s) do you use legume-based green manure?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1841dat <- HouseholdVietnam_2C[,c(1,32,1170:1180,2832,2833)]
val <- round(sum(ifelse(HouseholdVietnam_2C$d184 != 0 & !is.na(HouseholdVietnam_2C$d184), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
ylimn <- -45
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d1841dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #III.2.1.g. d18_51. For which crop(s) do you use pulses in association and/or rotation with main crop ?
cat('\n####',"III.2.1.g. d18_51. For which crop(s) do you use pulses in association and/or rotation with main crop ?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1851dat <- HouseholdVietnam_2C[,c(1,32,1184:1194,2832,2833)]
val <- round(sum(ifelse(HouseholdVietnam_2C$d185 != 0 & !is.na(HouseholdVietnam_2C$d185), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
ylimn <- -20
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d1851dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #III.2.1.h. d18_61. For which crop(s) do you use cover crops in association and/or rotation with main crop ?
cat('\n####',"III.2.1.h. d18_61. For which crop(s) do you use cover crops in association and/or rotation with main crop ?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1861dat <- HouseholdVietnam_2C[,c(1,32,1198:1208,2832,2833)]
val <- round(sum(ifelse(HouseholdVietnam_2C$d186 != 0 & !is.na(HouseholdVietnam_2C$d186), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
ylimn <- -20
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d1861dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #III.2.1.i. d18_71. For which crop(s) do you use Biochar ?
cat('\n####',"III.2.1.i. d18_71. For which crop(s) do you use Biochar ?", '\n')
print("No household use recycling crop waste")
cat('\n')

# # #III.2.1.j. d18_81. For which crop(s) do you use crop residue maintenance?
cat('\n####',"III.2.1.j. d18_81. For which crop(s) do you use crop residue maintenance?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d1881dat <- HouseholdVietnam_2C[,c(1,32,1226:1236,2832,2833)]
val <- round(sum(ifelse(HouseholdVietnam_2C$d188 != 0 & !is.na(HouseholdVietnam_2C$d188), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
ylimn <- -10
ylimx <- 80
dig = 0
#We apply the plotting function
CropPlot(d1881dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #III.2.1.k. d18_91. For which crop(s) do you use recycling crop waste?
cat('\n####',"III.2.1.k. d18_91. For which crop(s) do you use recycling crop waste?", '\n')
print("No household use recycling crop waste")
cat('\n')

# # #III.2.1.l. d18_101. For which crop(s) do you use ramial Wood Chip (RWC) or other wood chips?
cat('\n####',"III.2.1.l. d18_101. For which crop(s) do you use ramial Wood Chip (RWC) or other wood chips?", '\n')
print("No household use RWC")
cat('\n')


# # #III.2.1.m. d18_111. For which crop(s) do you use Organic agro-industrial waste ?
cat('\n####',"III.2.1.m. d18_111. For which crop(s) do you use Organic agro-industrial waste ?", '\n')
print("No household use waste")
cat('\n')

# # #III.2.1.n. d18_99. For which crop(s) do you use Other ?
cat('\n####',"III.2.1.n. d18_99. For which crop(s) do you use Other ?", '\n')
print("No interest in these answers as no translation for now")
cat('\n')
```

### III.2.2 - Input reduction
```{r III.2.2, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.2.a. d20. Does your household use any ecological/ agroecological/ integrated practices to control weeds in your fields?
cat('\n####',"III.2.2.a. d20. Does your household use any ecological/ agroecological/ integrated practices to control weeds in your fields?", '\n')
#First, we select the useful data
#We create a counting table and a title
d20count <- as.data.frame(survey::svytable(~d20, design=dstrat, exclude=NULL))
d20count <- d20count[c("2","1","3","4"),]
colnames(d20count)[2] <- "n"
d20count$d20 <- as.character(d20count$d20)
d20count[4,1] <- '/'
list <- c("yes","no","do not know","NA")
#Now we create the table with the corresponding function
PiePlotYN(d20count,list)
cat('\n')
#Check

# # #III.2.2.b. d21. Which of the following ecological/agroecological/integrated practices
cat('\n####',"III.2.2.b. d21. Which of the following ecological/agroecological/integrated practices", '\n')
#does your household use to control weeds in your fields?
#First, we select the useful data
d21dat <- HouseholdVietnam_2C[,c(1,26,32,1298:1312,2832,2833)]
#We modify long label names
var_label(d21dat$d211) <- "Crop rotation /\n intercropping"
var_label(d21dat$d214) <- "Sowing date /\n rate / depth"
var_label(d21dat$d215) <- "Crop spatial\n arrangement"
var_label(d21dat$d216) <- "Seed cleaning\n before sowing"
var_label(d21dat$d2114) <- "Post harvest weed seed\n destruction in field"
colnames(d21dat)[4:18] <- var_label(d21dat)[4:18]
pond <- round(sum(ifelse(HouseholdVietnam_2C$d20 == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Practices"
ylimn <- -20
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(d21dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.2.c. e13. Does your household fertilize the forage or improved pasture?
cat('\n####',"III.2.2.c. e13. Does your household fertilize the forage or improved pasture?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e13, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("No","Yes","NC")
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.2.2.d. e13_1. if yes, is it with Synthetic fertilizer, Organic manure or Both above ?
cat('\n####',"III.2.2.d. e13_1. if yes, is it with Synthetic fertilizer, Organic manure or Both above ?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e13_1, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount <- dcount %>% filter(!is.na(dcount$Answer))
dcount$Answer <- c("1.Synthetic fertilizer","2.Organic manure","3.Both")
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Set3"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.2.2.e. e29. Does your household use antibiotics on your cattle/buffalo?
cat('\n####',"III.2.2.e. e29. Does your household use antibiotics on your cattle/buffalo?", '\n')
#First, we select the useful data
e29dat <- HouseholdVietnam_2C[,c(1,26,32,2033:2036,2832,2833)]
#We modify long label names
var_label(e29dat$e291) <- "For treatment\n diseases only"
var_label(e29dat$e292) <- "For prevention of\n diseases only"
var_label(e29dat$e293) <- "For growth\n promotion"
var_label(e29dat$e290) <- "I dont use\n antibiotics at all"
colnames(e29dat)[4:7] <- var_label(e29dat)[4:7]
pond <- round(sum(ifelse(!is.na(HouseholdVietnam_2C$e28), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e29dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
print("COMMENT: Many households mentionned several answers")
cat('\n')
#Check

# # #III.2.2.f. e43. Does your household use antibiotics on your pigs?
cat('\n####',"III.2.2.f. e43. Does your household use antibiotics on your pigs?", '\n')
#First, we select the useful data
e43dat <- HouseholdVietnam_2C[,c(1,26,32,2094:2097,2832,2833)]
#We modify long label names
var_label(e43dat$e431) <- "For treatment\n diseases only"
var_label(e43dat$e432) <- "For prevention of\n diseases only"
var_label(e43dat$e433) <- "For growth\n promotion"
var_label(e43dat$e430) <- "I dont use\n antibiotics at all"
colnames(e43dat)[4:7] <- var_label(e43dat)[4:7]
pond <- round(sum(ifelse(!is.na(HouseholdVietnam_2C$e43) & HouseholdVietnam_2C$e43 != '', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e43dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
print("COMMENT: Many households mentionned several answers")
cat('\n')
#Check

# # #III.2.2.g. e57. Does your household use antibiotics on your poultry?
cat('\n####',"III.2.2.g. e57. Does your household use antibiotics on your poultry?", '\n')
#First, we select the useful data
e57dat <- HouseholdVietnam_2C[,c(1,26,32,2156:2159,2832,2833)]
#We modify long label names
var_label(e57dat$e571) <- "For treatment\n diseases only"
var_label(e57dat$e572) <- "For prevention of\n diseases only"
var_label(e57dat$e573) <- "For growth\n promotion"
var_label(e57dat$e570) <- "I dont use\n antibiotics at all"
colnames(e57dat)[4:7] <- var_label(e57dat)[4:7]
pond <- round(sum(ifelse(!is.na(HouseholdVietnam_2C$e56), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e57dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
print("COMMENT: Many households mentionned several answers")
cat('\n')
#Check
```

### III.2.3 - Soil health
```{r III.2.3, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.3.a. Soil conservation practices Yes or No
cat('\n####',"III.2.3.a. Soil conservation practices Yes or No", '\n')
#We create a counting table and a title
d140count <- as.data.frame(svytable(~d140, design=dstrat, exclude=NULL))
colnames(d140count)[2] <- "n"
#We order the answers
d140count$d140 <- as.character(d140count$d140)
d140count[3,1] <- '/'
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(d140count,list)
cat('\n')
#Check

# # #III.2.3.b. d14. Which of the following soil conservation practices do you use ?
cat('\n####',"III.2.3.b. d14. Which of the following soil conservation practices do you use ?", '\n')
#First, we select the useful data
d14dat <- HouseholdVietnam_2C[,c(1,26,32,990:997,2832,2833)]
#We modify long label names
var_label(d14dat$d141) <-  "Sowing in \ncontour lines"
var_label(d14dat$d142) <- "Natural or planted\n grass strips"
var_label(d14dat$d143) <- "Trees conservation \nin agricultural plots"
var_label(d14dat$d144) <- "Agroforestry \n(trees + crops)"
var_label(d14dat$d145) <- "Crop residues\n maintained to\n cover the soil"
var_label(d14dat$d147) <- "Reduced to\n no-tillage"
colnames(d14dat)[4:11] <- var_label(d14dat)[4:11]
pond <- round(sum(ifelse(HouseholdVietnam_2C$d140 == '0', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Practices"
ylimn <- -10
ylimx <- 50
dig = 0
pal ="Dark2"
PracticePlot(d14dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### III.2.4 - Animal health
```{r III.2.4, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.4.a. e58. Can you see the Ribs/ Bones of the ruminants, in the past 1 year?
cat('\n####',"III.2.4.a. e58. Can you see the Ribs/ Bones of the ruminants, in the past 1 year?", '\n')
#We create a counting table and a title
e58count <- as.data.frame(svytable(~e58, design=dstrat, exclude=NULL))
colnames(e58count)[2] <- "n"
e58count <- e58count[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(e58count,list)
cat('\n')
#Check

# # #III.2.4.b. e58_1. If yes to e58, which months?
cat('\n####',"III.2.4.b. e58_1. If yes to e58, which months?", '\n')
#First, we select the useful data
e58_1dat <- HouseholdVietnam_2C[,c(1,26,32,2167:2178,2832,2833)]
#We prepare the parameters for the function
colnames(e58_1dat)[4:15] <- var_label(e58_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdVietnam_2C$e58 == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 100
dig = 0
pal = "Dark2"
Monthplot(e58_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.4.c e59. Is there any month in the year when there is a lack of feed for the animals?
cat('\n####',"III.2.4.c e59. Is there any month in the year when there is a lack of feed for the animals?", '\n')
#We create a counting table and a title
e59count <- as.data.frame(svytable(~e59, design=dstrat, exclude=NULL))
colnames(e59count)[2] <- "n"
e59count <- e59count[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(e59count,list)
cat('\n')
#Check

# # #III.2.4.d. e59_1. If yes to e59, which months?
cat('\n####',"III.2.4.d. e59_1. If yes to e59, which months?", '\n')
#First, we select the useful data
e59_1dat <- HouseholdVietnam_2C[,c(1,26,32,2181:2192,2832,2833)]
#We prepare the parameters for the function
colnames(e59_1dat)[4:15] <- var_label(e59_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdVietnam_2C$e59 == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 100
dig = 0
pal = "Dark2"
Monthplot(e59_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.4.e. e60. Do the animals have access to the water?
cat('\n####',"III.2.4.e. e60. Do the animals have access to the water?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e60, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("No","Yes","NC")
pond <-sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.2.4.f. e26. Does your household have problems with Cattle/Buffalo parasites?
cat('\n####',"III.2.4.f. e26. Does your household have problems with Cattle/Buffalo parasites?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e26, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),] 
dcount$Answer <- c("No","Yes","NC")
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.2.4.g. e27. How does your household deal with it? - Cattle/Buffalo
cat('\n####',"III.2.4.g. e27. How does your household deal with it? - Cattle/Buffalo", '\n')
#Chemicals (define)
#First, we select the useful data
e27dat <- HouseholdVietnam_2C[,c(1,26,32,2024:2026,2832,2833)]
colnames(e27dat)[4:6] <- var_label(e27dat)[4:6]
pond <- round(sum(ifelse(!is.na(HouseholdVietnam_2C$e26_1), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e27dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.4.h. e40. Does your household have problems with Pigs parasites?
cat('\n####',"III.2.4.h. e40. Does your household have problems with Pigs parasites?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e40, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),] 
dcount$Answer <- c("NA","No","Yes","NC")
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
#COMMENT: MISSING ANSWERS FROM PEOPLE OWNING PIGS
cat('\n')
#Check

# # #III.2.4.i. e41. How does your household deal with it? - Pigs
cat('\n####',"III.2.4.i. e41. How does your household deal with it? - Pigs", '\n')
#Chemicals (define)
#First, we select the useful data
e41dat <- HouseholdVietnam_2C[,c(1,26,32,2085:2087,2832,2833)]
colnames(e41dat)[4:6] <- var_label(e41dat)[4:6]
pond <- round(sum(ifelse(HouseholdVietnam_2C$e40 == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e41dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.4.j. e54. Does your household have problems with Poultry parasites?
cat('\n####',"III.2.4.j. e54. Does your household have problems with Poultry parasites?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+e54, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),] 
dcount$Answer <- c("No","Yes","NC")
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
#COMMENT: MISSING ANSWERS FROM PEOPLE OWNING POULTRY
cat('\n')
#Check

# # #III.2.4.k. e55. How does your household deal with it? - Poultry
cat('\n####',"III.2.4.k. e55. How does your household deal with it? - Poultry", '\n')
#Chemicals (define)
#First, we select the useful data
e55dat <- HouseholdVietnam_2C[,c(1,26,32,2146:2148,2832,2833)]
colnames(e55dat)[4:6] <- var_label(e55dat)[4:6]
pond <- round(sum(ifelse(HouseholdVietnam_2C$e54 == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Answer"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(e55dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### III.2.5 - Biodiversity
```{r III.2.5, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.5.a d32. Do you conserve and use traditional/local seeds?
cat('\n####',"III.2.5.a d32. Do you conserve and use traditional/local seeds?", '\n')
#We create a counting table and a title
d32count <- as.data.frame(svytable(~d32, design=dstrat, exclude=NULL))
colnames(d32count)[2] <- "n"
d32count <- d32count[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(d32count,list)
cat('\n')
#Check

# # #III.2.5.b. d32_1. If Yes to d32, for which crops?
cat('\n####',"III.2.5.b. d32_1. If Yes to d32, for which crops?", '\n')
#We prepare the data we want to analyze by replacing yes (&) values by crop name
d32_1dat <- HouseholdVietnam_2C[,c(1,32,1786:1796,2832,2833)]
val <- round(sum(ifelse(HouseholdVietnam_2C$d32 == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
ylimn <- -15
ylimx <- 60
dig = 0
#We apply the plotting function
CropPlot(d32_1dat,val,ylimn,ylimx,dig)
cat('\n')
#Check

# # #III.2.5.c. e5_b. Do you have any local breeds of  e4_1 at the time of the survey?
cat('\n####',"III.2.5.c. e5_b. Do you have any local breeds of  e4_1 at the time of the survey?", '\n')
#We create a counting table and a title
e5_bcount <- as.data.frame(svytable(~e5_b, design=dstrat, exclude=NULL))
colnames(e5_bcount)[2] <- "n"
e5_bcount <- e5_bcount[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(e5_bcount,list)
cat('\n')
#Check

# # #III.2.5.d. e5_b_1. Animal diversity for local breeds (most important animal)
cat('\n####',"III.2.5.d. e5_b_1. Animal diversity for local breeds (most important animal)", '\n')
#First, we select the useful data
#We create a counting table and a title
e5_b_1count <- HouseholdVietnam_2C[,c(32,1905,1911,2832,2833)]
pond <- round(sum(ifelse(HouseholdVietnam_2C$e5_b == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
#Now we create the table with the corresponding function
AnimalPlot(e5_b_1count,pond)
cat('\n')
#Check

# # #III.2.5.e. Number of crops grown during the last 12 months
cat('\n####',"III.2.5.e. Number of crops grown during the last 12 months", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+TotCrop, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check
```

### III.2.6 - Synergy
```{r III.2.6, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.6.a. d26. Does your household use agroecological/integrated practices to control pests and disease in your fields? 
cat('\n####',"III.2.6.a. d26. Does your household use agroecological/integrated practices to control pests and disease in your fields?", '\n')
#We create a counting table and a title
d26count <- as.data.frame(svytable(~d26, design=dstrat, exclude=NULL))
colnames(d26count)[2] <- "n"
d26count <- d26count[c("2","1","3","4"),]
list <- c("yes","no","do not know","NC")
#Now we create the table with the corresponding function
PiePlotYN(d26count,list)
cat('\n')
#Check

# # #III.2.6.b. d27. Which ecological/agroecological/integrated practices do you
#use to control pets and diseases in your fields?
cat('\n####',"III.2.6.b. d27. Which ecological/agroecological/integrated practices do you use to control pets and diseases in your fields?", '\n')
#First, we select the useful data
d27dat <- HouseholdVietnam_2C[,c(1,26,32,1517:1531,2832,2833)]
#We modify long label names
var_label(d27dat$d271) <- "Crop rotation /\n intercropping"
var_label(d27dat$d274) <- "Soil health \nmaintenance/improvement"
var_label(d27dat$d275) <- "Sanitation practices"
var_label(d27dat$d277) <- "Water and nutrient\n management"
var_label(d27dat$d278) <- "Cultivar choice (tolerant/\nresistant)/cultivar mixture"
var_label(d27dat$d279) <- "Biopesticide /\n organic pesticide"
var_label(d27dat$d2710) <- "BCAs"
var_label(d27dat$d2711) <- "Home-made efficient\n microorganism (EM)"
var_label(d27dat$d2712) <- "Commercial efficient\n microorganism (EM)"
colnames(d27dat)[4:18] <- var_label(d27dat)[4:18]
pond <- round(sum(ifelse(HouseholdVietnam_2C$d26 == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Practices"
ylimn <- -30
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(d27dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### III.2.7 - Economic diversification
```{r III.2.7, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.7.a. b1. Does your household sell agricultural products 
#(crops, vegetables, fruits or processed products) and/or livestock?
cat('\n####',"III.2.7.a. b1. Does your household sell agricultural products (crops, vegetables, fruits or processed products) and/or livestock?", '\n')
#We create a counting table and a title
dcount <- as.data.frame(svytable(~district_eng+b1, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("0.No selling\n agri-products","1.Selling own\n crops/fruits/\n vegetable",
                     "2.Selling own\n livestock products","3.Selling both own\n crops/fruits/vegetables\n and livestock products")
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProvYN(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.2.7.b. b2. Does your household sell derived/processed products and which?
cat('\n####',"III.2.7.b. b2. Does your household sell derived/processed products and which?", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~district_eng+b2, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("0.No processed/derived agri-products","1.Selling processed products from crops","3.Selling both above processed/derived agri-products")
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check
  
# # #III.2.7.c. Diversity of activities
cat('\n####',"III.2.7.c. Diversity of activities", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~district_eng+SoldProdTot, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- as.factor(dcount$Answer)
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Greens"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.2.7.d. b9.Are there specific months of the year in which you face financial difficulties?
cat('\n####',"III.2.7.d. b9.Are there specific months of the year in which you face financial difficulties?", '\n')
#We create a counting table and a title
b9count <- as.data.frame(svytable(~b9, design=dstrat, exclude=NULL))
b9count$b9 <- as.character(b9count$b9)
colnames(b9count)[2] <- "n"
b9count <- b9count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(b9count,list)
cat('\n')
#Check

# # #III.2.7.e. b9_1. If yes to b9, which months?
cat('\n####',"III.2.7.e. b9_1. If yes to b9, which months?", '\n')
#First, we select the useful data
b9_1dat <- HouseholdVietnam_2C[,c(1,26,32,182:193,2832,2833)]
#We prepare the parameters for the function
colnames(b9_1dat)[4:15] <- var_label(b9_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdVietnam_2C$b9 == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 60
dig = 0
pal = "Dark2"
Monthplot(b9_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```

### III.2.8 - Co-creation of knowledge
```{r III.2.8, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.8.a. c14. Do you exchange your agricultural products,
#equipment or animals with other farmers? 
cat('\n####',"III.2.8.a. c14. Do you exchange your agricultural products, equipment or animals with other farmers?", '\n')
#We create a counting table and a title
c14count <- as.data.frame(svytable(~c14, design=dstrat, exclude=NULL))
c14count$c14 <- as.character(c14count$c14)
colnames(c14count)[2] <- "n"
c14count <- c14count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(c14count,list)
cat('\n')
#Check

# # #III.2.8.b. f4. Do you have sufficient time to acquire new knowledge
#and improve your skills?
cat('\n####',"III.2.8.b. f4. Do you have sufficient time to acquire new knowledge and improve your skills?", '\n')
#First we select useful data
f4count <- as.data.frame(svytable(~f4, design=dstrat, exclude=NULL))
colnames(f4count)[1] <- "Answer"
colnames(f4count)[2] <- "n"
list <- c("1.No time","2.Very little time","3.Moderate amount of time","4.Almost enough time",
  "5.Sufficient amount of time", "6.Do not know")
pond <- sum(HouseholdVietnam_2C$Weight)
xT = "Answer"
ylimn <- -30
#Now we create the table with the corresponding function
ListBPlotNO(f4count,list,pond,xT,ylimn)
cat('\n')
#Check
```

### III.2.9 - Social value and diet
```{r III.2.9, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.9.a. i1. In general, what is the proportion of the food (rice, vegetable, animal products, etc.) consumed by your family that comes from your own farm or homegarden?
cat('\n####',"III.2.9.a. i1. In general, what is the proportion of the food (rice, vegetable, animal products, etc.) consumed by your family that comes from your own farm or homegarden?", '\n')
#First, we select the useful data
i1count <- as.data.frame(svytable(~i1, design=dstrat, exclude=NULL))
colnames(i1count)[1] <- "Answer"
colnames(i1count)[2] <- "n"
list <- c("1.Less than 25%","2.25-50%","3.50-75%","4.Over 75%")
pond <- sum(HouseholdVietnam_2C$Weight)
#Now we create the table with the corresponding function
xT = "Answer"
ylimn <- -10
ListBPlotNO(i1count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #III.2.9.b g5. Do you think the working hours (including household chores and taking care of family members) across family members are equitably distributed?
cat('\n####',"III.2.9.b g5. Do you think the working hours (including household chores and taking care of family members) across family members are equitably distributed?", '\n')
#We create a counting table and a title
g5count <- as.data.frame(svytable(~g5, design=dstrat, exclude=NULL))
g5count$g5 <- as.character(g5count$g5)
colnames(g5count)[2] <- "n"
g5count <- g5count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(g5count,list)
cat('\n')
#Check

# # #III.2.9.c. i2. Were there months, in the past 12 months, in which you did 
#not have enough food to meet your familys needs?
cat('\n####',"III.2.9.c. i2. Were there months, in the past 12 months, in which you did not have enough food to meet your familys needs?", '\n')
#We create a counting table and a title
i2count <- as.data.frame(svytable(~i2, design=dstrat, exclude=NULL))
i2count$i2 <- as.character(i2count$i2)
colnames(i2count)[2] <- "n"
i2count <- i2count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(i2count,list)
cat('\n')
#Check

# # #III.2.9.d. i3. If yes, which were the months in the past 12 months during 
#which you did not have enough food to meet your familys needs?
cat('\n####',"III.2.9.d. i3. If yes, which were the months in the past 12 months during which you did not have enough food to meet your familys needs?", '\n')
#First, we select the useful data
i3dat <- HouseholdVietnam_2C[,c(1,26,32,2225:2236,2832,2833)]
#We prepare the parameters for the function
colnames(b9_1dat)[4:15] <- var_label(b9_1dat)[4:15]
pond <- round(sum(ifelse(HouseholdVietnam_2C$i2 == '1', 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Months"
ylimn <- 0
ylimx <- 60
dig = 0
pal = "Dark2"
Monthplot(i3dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.9.e. g1. Who makes the decision on what (e.g. crops, animals) and how to produce (e.g., with or without herbicide, tillage or no tillage, compost or chemical fertiliser)?
cat('\n####',"III.2.9.e. g1. Who makes the decision on what (e.g. crops, animals) and how to produce (e.g., with or without herbicide, tillage or no tillage, compost or chemical fertiliser)?", '\n')
#We create a counting table and a title
g1count <- as.data.frame(svytable(~g1, design=dstrat, exclude=NULL))
g1count$g1 <- as.character(g1count$g1)
colnames(g1count)[2] <- "n"
list <- c("Myself alone","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members")
pond <- sum(HouseholdVietnam_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g1count,list)
cat('\n')
#Check

# # #III.2.9.f. g2. Who makes the decision on purchasing, selling, or transferring major household assets (land, cattle, equipment)?
cat('\n####',"III.2.9.f. g2. Who makes the decision on purchasing, selling, or transferring major household assets (land, cattle, equipment)?", '\n')
#We create a counting table and a title
g2count <- as.data.frame(svytable(~g2, design=dstrat, exclude=NULL))
g2count$g2 <- as.character(g2count$g2)
colnames(g2count)[2] <- "n"
list <- c("Myself alone","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members", "DNK")
pond <- sum(HouseholdVietnam_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g2count,list)
cat('\n')
print("DNK = Do not know")
#Check

# # #III.2.9.g. g3. Who makes the decision on borrowing or lending money?
cat('\n####',"III.2.9.g. g3. Who makes the decision on borrowing or lending money?", '\n')
#We create a counting table and a title
g3count <- as.data.frame(svytable(~g3, design=dstrat, exclude=NULL))
g3count$g3 <- as.character(g3count$g3)
colnames(g3count)[2] <- "n"
list <- c("Myself alone","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members", "DNK")
pond <- sum(HouseholdVietnam_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g3count,list)
cat('\n')
print("DNK = Do not know")
#Check

# # #III.2.9.h. g4. Who makes the decision about how the household income is used?
cat('\n####',"III.2.9.h. g4. Who makes the decision about how the household income is used?", '\n')
#We create a counting table and a title
g4count <- as.data.frame(svytable(~g4, design=dstrat, exclude=NULL))
g4count$g4 <- as.character(g4count$g4)
colnames(g4count)[2] <- "n"
list <- c("Myself alone","Me in consultation with\n spouse/other family members",
          "My spouse/other\n family members", "DNK")
pond <- sum(HouseholdVietnam_2C$Weight)
#Now we create the table with the corresponding function
PiePlot(g4count,list)
cat('\n')
print("DNK = Do not know")
#Check
```

### III.2.10 - Fairness
```{r III.2.10, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.10.a. b22. Did you sell any certified crop/vegetables/fruit/livestock
#related product in the past year/12 months?
cat('\n####',"III.2.10.a. b22. Did you sell any certified crop/vegetables/fruit/livestock related product in the past year/12 months?", '\n')
#We create a counting table and a title
b22count <- as.data.frame(svytable(~b22, design=dstrat, exclude=NULL))
b22count$b22 <- as.character(b22count$b22)
colnames(b22count)[2] <- "n"
b22count <- b22count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(b22count,list)
cat('\n')
#Check

# # #III.2.10.b. b22_1. If yes, which one(s)?
cat('\n####',"III.2.10.b. b22_1. If yes, which one(s)?", '\n')
#First, we select the useful data
b22_1dat <- HouseholdVietnam_2C[,c(1,26,32,245:259,2832,2833)]
#We modify long label names
var_label(b22_1dat$b22_113) <- "Dried meat (pork,\n beef, etc.)"
#We prepare the parameters for the function
colnames(b22_1dat)[4:18] <- var_label(b22_1dat)[4:18]
#WARNING
pond <- 10.4
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Certified crops"
ylimn <- -20
ylimx <- 110
dig = 1
pal = "Dark2"
#Function Call
PracticePlot(b22_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.10.c. c8. Did you sign a contract whereby the buyer commits to buy 
#from you following some at specific conditions (price, volume, quality, time...)?
cat('\n####',"III.2.10.c. c8. Did you sign a contract whereby the buyer commits to buy from you following some at specific conditions (price, volume, quality, time...)?", '\n')
#First, we select the useful data
c8count <- as.data.frame(svytable(~c8, design=dstrat, exclude=NULL))
colnames(c8count)[1] <- "Answer"
colnames(c8count)[2] <- "n"
list <- c("no","NC")
pond <- sum(HouseholdVietnam_2C$Weight)
xT = "Answer"
ylimn <- -20
#Now we create the table with the corresponding function
ListBPlotNO(c8count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #III.2.10.d. b14_1. Does buyer provide any of the following
cat('\n####',"III.2.10.d. b14_1. Does buyer provide any of the following", '\n')
#First, we select the useful data
b14_1dat <- HouseholdVietnam_2C[,c(1,26,32,717:725,2832,2833)]
#We prepare the parameters for the function
colnames(b14_1dat)[4:12] <- var_label(b14_1dat)[4:12]
pond <- round(sum(ifelse(!is.na(HouseholdVietnam_2C$b12_1), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Answer"
ylimn <- -20
ylimx <- 100
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(b14_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.10.e. b14_2. Does buyer provide any of the following
cat('\n####',"III.2.10.e. b14_2. Does buyer provide any of the following", '\n')
#First, we select the useful data
b14_2dat <- HouseholdVietnam_2C[,c(1,26,32,742:750,2832,2833)]
#We prepare the parameters for the function
colnames(b14_2dat)[4:12] <- var_label(b14_2dat)[4:12]
pond <- round(sum(ifelse(!is.na(HouseholdVietnam_2C$b12_2), 1,0)*HouseholdVietnam_2C$Weight), digits=0)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Answer"
ylimn <- -20
ylimx <- 60
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(b14_2dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.10.f. l7. In general, does your household have difficulties paying
#back your loans?
cat('\n####',"III.2.10.f. l7. In general, does your household have difficulties paying back your loans?", '\n')
#We create a counting table and a title
l7count <- as.data.frame(svytable(~l7, design=dstrat, exclude=NULL))
l7count$l7 <- as.character(l7count$l7)
colnames(l7count)[2] <- "n"
l7count <- l7count[c("2","1","3"),]
list <- c("yes","no","NC")
#Now we create the table with the corresponding function
PiePlotYN(l7count,list)
cat('\n')
#Check

# # #III.2.10.g. h1. Would you like your children to be farmers too?
cat('\n####',"III.2.10.g. h1. Would you like your children to be farmers too?", '\n')
#First, we select the useful data
h1count <- as.data.frame(svytable(~h1, design=dstrat, exclude=NULL))
colnames(h1count)[1] <- "Answer"
colnames(h1count)[2] <- "n"
list <- c("1. Yes, strongly","2. Yes, maybe","3. They should emigrate\n if they had the chance",
          "4. No, agriculture is\n not a good job","5. Do not know")
pond <- sum(HouseholdVietnam_2C$Weight)
xT = "Answer"
ylimn <- -20
#Now we create the table with the corresponding function
ListBPlotNO(h1count,list,pond,xT,ylimn)
cat('\n')
#Check
```

### III.2.11 - Connectivity
```{r III.2.11, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.11.a. c13. Do you collaborate with other people for any task ?
cat('\n####',"III.2.11.a. c13. Do you collaborate with other people for any task ?", '\n')
#First, we select the useful data
c13dat <- HouseholdVietnam_2C[,c(1,26,32,647:653,655,2832,2833)]
#We modify long label names
var_label(c13dat$c131) <- "Share labor (mutual\n help, working together\n on each other farm)"
var_label(c13dat$c132) <- "Manage water/\nirrigation systems"
var_label(c13dat$c134) <- "Buy agricultural\n inputs"
var_label(c13dat$c135) <- "Selling products\n to the markets for\n other farmers"
var_label(c13dat$c136) <- "Experiment new\n farming practices"
var_label(c13dat$c130) <-"No collaboration\n with other people\n on these issues"
#We prepare the parameters for the function
colnames(c13dat)[4:11] <- var_label(c13dat)[4:11]
pond <- sum(HouseholdVietnam_2C$Weight)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Months"
ylimn <- -20
ylimx <- 100
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(c13dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.11.b c15. Are you involved in some form of advocacy work (aiming 
#to influence decision-making within political institutions)?
cat('\n####',"III.2.11.b c15. Are you involved in some form of advocacy work (aiming to influence decision-making within political institutions)?", '\n')
#We create a counting table and a title
c15count <- as.data.frame(svytable(~c15, design=dstrat, exclude=NULL))
c15count$c15 <- as.character(c15count$c15)
colnames(c15count)[2] <- "n"
c15count <- c15count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(c15count,list)
cat('\n')
#Check

# # #III.2.11.c f3.Do you have enough time for your family and your social relationships?
cat('\n####',"III.2.11.c f3.Do you have enough time for your family and your social relationships?", '\n')
#First, we select the useful data
f3count <- as.data.frame(svytable(~f3, design=dstrat, exclude=NULL))
colnames(f3count)[1] <- "Answer"
colnames(f3count)[2] <- "n"
list <- c("1. No time","2. Very little time","3. Moderate amount of time",
          "4. Almost enough time","5. Sufficient amount of time")
pond <- sum(HouseholdVietnam_2C$Weight)
xT = "Answer"
ylimn <- -30
#Now we create the table with the corresponding function
ListBPlotNO(f3count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #III.2.11.d b10. If you sell crops/vegetables/fruits or processed products,
#do you know what is their main final destination?
cat('\n####',"III.2.11.d b10. If you sell crops/vegetables/fruits or processed products, do you know what is their main final destination?", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~district_eng+b10, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[c(3:14),]
dcount <- dcount[order(dcount$district_eng,dcount$Answer),]
dcount$Answer <- c("a.The local market \n(lower or equal to district level market)",
                    "b.The provincial or national market","c.Export","d.Other",
                    "e.Do not know","f./")
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Dark2"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check

# # #III.2.11.d b16. If you sell livestock or livestock derived products, 
#do you know what is their main final destination?
cat('\n####',"III.2.11.d b16. If you sell livestock or livestock derived products, do you know what is their main final destination?", '\n')
#First we select useful data
dcount <- as.data.frame(svytable(~district_eng+b16, design=dstrat, exclude=NULL))
colnames(dcount)[2] <- "Answer"
colnames(dcount)[3] <- "n"
dcount <- dcount[c(3:12),]
dcount$Answer <- c("a.The local market (lower\n or equal to district level market)",
                   "b.The provincial or national market","d.Other",
                   "e.Do not know","f./")
pond <- sum(HouseholdVietnam_2C$Weight)
ylimn <- 0
dig = 0
pal = "Dark2"
ListBPlotProv(dcount,pond,ylimn,dig,pal)
cat('\n')
#Check
```

### III.2.12 - Land and natural resource governance
```{r III.2.12, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.12.a. l1. In the past year/12 months, did your household benefit from government
#subsidies to support investment in production or commercialization activities?
cat('\n####',"III.2.12.a. l1. In the past year/12 months, did your household benefit from government subsidies to support investment in production or commercialization activities?", '\n')
#We create a counting table and a title
l1count <- as.data.frame(svytable(~l1, design=dstrat, exclude=NULL))
l1count$l1 <- as.character(l1count$l1)
colnames(l1count)[2] <- "n"
l1count <- l1count[c("2","1"),]
list <- c("yes","no")
#Now we create the table with the corresponding function
PiePlotYN(l1count,list)
cat('\n')
#Check

# # #III.2.12.b. l2. How much of your total household income in 2022 did these 
#government subsidies represent?
cat('\n####',"III.2.12.b. l2. How much of your total household income in 2022 did these government subsidies represent?", '\n')
#We create a counting table and a title
l2count <- as.data.frame(svytable(~l2, design=dstrat, exclude=NULL))
colnames(l2count)[1] <- "Answer"
colnames(l2count)[2] <- "n"
l2count <- l2count %>%  filter(!is.na(Answer))
list <- c("1.Less than 25%","2.25-50%","3.50-75%","4.Do not know")
pond <- round(sum(l2count$n),digits = 0)
xT = "Answer"
ylimn <- -20
#Now we create the table with the corresponding function
ListBPlotNO(l2count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #III.2.12.c. d9-10-11. Land ownership
cat('\n####',"III.2.12.c. d9-10-11. Land ownership", '\n')
#First, we select the useful data
d9_1dat <- HouseholdVietnam_2C[,c(1,26,32,847,849,851,2832,2833)]
#We modify long label names
var_label(d9_1dat$d9_1) <- "Having plots\n rented-in?"
var_label(d9_1dat$d10_1) <- "Having plots\n rented-out?"
var_label(d9_1dat$d11_1) <- "Having plots\n owned?"
#We prepare the parameters for the function
colnames(c13dat)[4:6] <- var_label(c13dat)[4:6]
pond <- sum(HouseholdVietnam_2C$Weight)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- ""
ylimn <- -20
ylimx <- 110
dig = 1
pal = "Dark2"
#Function call
PracticePlot(d9_1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check

# # #III.2.12.c. e12. Does your household have private land to feed the animals?
cat('\n####',"III.2.12.c. e12. Does your household have private land to feed the animals?", '\n')
#We create a counting table and a title
e12count <- as.data.frame(svytable(~OwnPast, design=dstrat, exclude=NULL))
e12count$OwnPast <- as.character(e12count$OwnPast)
colnames(e12count)[2] <- "n"
e12count <- e12count[c("2","1","3"),]
list <- c("yes","no","NA")
#Now we create the table with the corresponding function
PiePlotYN(e12count,list)
cat('\n')
#Check
```

### III.2.13 - Participation
```{r III.2.13, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #III.2.13.a. c2. Are you a member of one or more farmer organization (e.g. crops/fruits/livestock/honey/ water/Forest etc)?
cat('\n####',"III.2.13.a. c2. Are you a member of one or more farmer organization (e.g. crops/fruits/livestock/honey/ water/Forest etc)?", '\n')
c2count <- as.data.frame(svytable(~c2, design=dstrat, exclude=NULL))
colnames(c2count)[1] <- "Answer"
colnames(c2count)[2] <- "n"
list <- c("1.No","2.Yes, one","3.Yes, more than one")
pond <- sum(HouseholdVietnam_2C$Weight)
xT = "Answer"
ylimn <- -25
#Now we create the table with the corresponding function
ListBPlotNO(c2count,list,pond,xT,ylimn)
cat('\n')
#Check

# # #III.2.13.b. c1. Are you or anyone in your household active in one or several Unions? YN
cat('\n####',"III.2.13.b. c1. Are you or anyone in your household active in one or several Unions? YN", '\n')
c1_0count <- as.data.frame(svytable(~OwnPast, design=dstrat, exclude=NULL))
c1_0count$OwnPast <- as.character(c1_0count$OwnPast)
colnames(c1_0count)[2] <- "n"
c1_0count <- c1_0count[c("2","1","3"),]
list <- c("yes","no","NA")
#Now we create the table with the corresponding function
PiePlotYN(c1_0count,list)
cat('\n')
#Check

# # #III.2.13.c. c1. Are you or anyone in your household active in one or several of the following?
cat('\n####',"III.2.13.c. c1. Are you or anyone in your household active in one or several of the following?", '\n')
#First, we select the useful data
c1dat <- HouseholdVietnam_2C[,c(1,26,32,581:588,2832,2833)]
#We modify long label names
var_label(c1dat$c1_1) <- "c1_1. Women\n union"
var_label(c1dat$c1_2) <- "c1_2. Youth\n union"
var_label(c1dat$c1_3) <- "c1_3. Veteran\n union"
var_label(c1dat$c1_4) <- "c1_4. Farmer\n union"
var_label(c1dat$c1_5) <- "c1_5. Elderly\n union"
var_label(c1dat$c1_6) <- "c1_6. Political\n party"
#We prepare the parameters for the function
colnames(c1dat)[4:11] <- var_label(c1dat)[4:11]
pond <- sum(HouseholdVietnam_2C$Weight)
pond2 <- sum(HouseholdVietnam_2C$Weight)
xT <- "Months"
ylimn <- -20
ylimx <- 85
dig = 0
pal = "Dark2"
#Function Call
PracticePlot(c1dat,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
#Check
```



# IV. Overall data
```{r IV, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis'}
# # #1.2.c. List PLOT with Country information (as x)
ListBPlotCounYN <- function(data,pond,ylimn,dig,pal){
    dstratx <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = data)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~country_eng_preload+Answer, design=dstratx, exclude=NULL))
  dcountNAR <- dcount %>%  filter(country_eng_preload != '')
  provtot <- aggregate(Weight ~ country_eng_preload, data=data, sum)
  dcountNAR <- join(dcountNAR, provtot, by = "country_eng_preload")
  colnames(dcountNAR)[3] <- "n"
  colnames(dcountNAR)[4] <- "nbHHtot"
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(dcountNAR$nbHHtot)*100, digits=dig)

    #And now a distribution plot
    plotb <- ggplot(data=dcountNAR, aes(x= `country_eng_preload`, y=Percentage_of_households, fill = Answer))+
      geom_bar(colour="black",position="stack", stat="identity")+
      geom_text(aes(label = Percentage_of_households), position = position_stack(vjust = .5), size = 3)+
      scale_fill_brewer(palette= pal, direction = 1)+
      theme_stata(base_size = 8)+
      theme(legend.title=element_blank())+
      ggtitle(paste("Cambodia : S =",round(pond*0.3476/3.62,digits = 0), "/ P =", round(pond*0.3476,digits = 0) ,
                    " - Laos : S = ",round(pond*0.313/3.62,digits = 0), "/ P =", round(pond*0.313,digits = 0),
                    "\n Vietnam : S = ",round(pond*0.339/3.62,digits = 0), "/ P =", round(pond*0.339,digits = 0)))
    print(plotb)
}

# # #1.2.e. PRACTICES PLOT
PracticePlot <- function(data,pond,pond2,xT,ylimn,ylimx,dig,pal){
  #Then we adapt the format to be able to plot it and create a table
  dmelt <- melt(data ,  id.vars = c('o9', 'country_eng_preload','village_eng_preload','fpc','Weight'), variable.name = 'Practices')
  dstratb <- svydesign(
    id = ~1, strata = ~village_eng_preload,
    weights = ~Weight, data = dmelt)
  
  # # # #b.a Plot with AE practicionners only as %
  #We can now create a counting table
  dcount <- as.data.frame(svytable(~Practices+value, design=dstratb, exclude=NULL))
  colnames(dcount)[2] <- "Answer"
  colnames(dcount)[3] <- "n"
  dcountNAR <- dcount %>%  filter(!is.na(Answer) & Answer != '' & Answer != 0)
  #We convert absolute values to % y divinding by the total number of households
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(pond)*100, digits=dig)
  # Define the number of colors you want
  nb.cols <- nrow(dcountNAR)
  mycolors <- colorRampPalette(brewer.pal(8, pal))(nb.cols)
  #And now a distribution plot
  plota <- ggplot(data=dcountNAR, aes(x=reorder(Practices, -Percentage_of_households), y=Percentage_of_households, fill = Practices))+
    geom_bar(colour="black",stat="identity")+
    theme_stata(base_size = 9)+
    theme(axis.text.x = element_text(size=8,angle = 60), legend.position = "none")+
    geom_text(aes(label = Percentage_of_households, vjust = -1)) + ylim(ylimn, ylimx)+
    scale_fill_manual(values= mycolors)+
    labs(x= xT)+
    ggtitle(paste("Sample =", round(pond/3.97, digits = 0), "/  Population = ",pond))
  print(plota)
  
  # # # #b.b Plot with Communes and total %
  #We create a counting table
  dcount <- as.data.frame(svytable(~country_eng_preload+Practices+value, design=dstratb, exclude=NULL))
  dcount <- dcount %>% filter(country_eng_preload != '')
  dcountNAR <- dcount %>%  filter(!is.na(value) & value != '' & value != 0)
  #We convert absolute values to % y divinding by the total number of households
  provtot <- aggregate(Weight ~ country_eng_preload, data=data, sum)
  dcountNAR <- join(dcountNAR, provtot, by = "country_eng_preload")
  colnames(dcountNAR)[4] <- "n"
  colnames(dcountNAR)[5] <- "nbHHtot"
  dcountNAR$Percentage_of_households <- round(dcountNAR$n/as.numeric(dcountNAR$nbHHtot)*100, digits=dig)
  #And now a distribution plot
  plotb <- ggplot(data=dcountNAR, aes(x=reorder(Practices, -Percentage_of_households), y=Percentage_of_households, fill = `country_eng_preload`))+
    geom_bar(colour="black",stat="identity",position = 'dodge')+
    theme_stata(base_size = 8)+
    theme(axis.text.x = element_text(size=8,angle = 60),legend.title=element_blank())+
    geom_text(aes(label = Percentage_of_households), vjust = -1, position = position_dodge(0.9), size = 3)+
    ylim(ylimn, ylimx)+
    scale_fill_brewer(palette= pal, direction = -1)+
    labs(x= xT)+
    ggtitle(paste("Cambodia : S =",round(pond*0.3476/3.62,digits = 0), "/ P =", round(pond*0.3476,digits = 0) ,
                  " - Laos : S = ",round(pond*0.313/3.62,digits = 0), "/ P =", round(pond*0.313,digits = 0),
                  "\n Vietnam : S = ",round(pond*0.339/3.62,digits = 0), "/ P =", round(pond*0.339,digits = 0)))
  print(plotb)
}
```

## IV.1. Data analysis - General

### IV.1.1 Land and animals characteristics
```{r IV.1.1, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IIV.1.1.a. d1. What kinds of land did your household have in the past 12 months?
cat('\n####',"IIV.1.1.a. d1. What kinds of land did your household have in the past 12 months?", '\n')
#We prepare the data of each country
Camb <- HouseholdCambodia_2C[,c(1,20,32,582:589,2658,2659)]
for (i in 4:11){
  Camb[,i] <- as.character(Camb[,i])
}
#We group all fallow in the same column
Camb$d1_4 <- ifelse(Camb$d1_4 !=1 & Camb$d1_8 == 1, '1',Camb$d1_4)
Camb <- Camb[,c(1:10,12:13)]
Lao <- HouseholdLaos_2C[,c(1,19,28,617:623,2396,2397)]
for (i in 3:9){
  Lao[,i] <- as.character(Lao[,i])
}
Viet <- HouseholdVietnam_2C[,c(1,20,32,661:667,2832,2833)]
for (i in 3:9){
  Viet[,i] <- as.character(Viet[,i])
}
#We merge a table regrouping data for each countries
CLV <- rbind(Camb,Lao,Viet)
#We restore the column label real names
CLV <- copy_labels(CLV, HouseholdVietnam_2C)
colnames(CLV)[4:10] <- var_label(CLV)[4:10]
#We fulfil the information required in the function
pond <- sum(CLV$Weight)
pond2 <- sum(CLV$Weight)
xT <- "Kind of land owned"
ylimn <- -30
ylimx <- 110
dig = 0
pal = "Dark2"
PracticePlot(CLV,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')

##2.2 Animal characteristics
# # #IV.1.1.a. e2. If yes, which below animal does your household have?
cat('\n####',"IV.1.1.a. e2. If yes, which below animal does your household have?", '\n')
#We prepare the data of each country
Camb <- HouseholdCambodia_2C[,c(1,20,32,2032:2044,2658,2659)]
for (i in 4:16){
  Camb[,i] <- as.character(Camb[,i])
}
Lao <- HouseholdLaos_2C[,c(1,19,28,1839:1851,2396,2397)]
for (i in 4:16){
  Lao[,i] <- as.character(Lao[,i])
}
Viet <- HouseholdVietnam_2C[,c(1,20,32,1871:1883,2832,2833)]
for (i in 4:16){
  Viet[,i] <- as.character(Viet[,i])
}
#We merge a table regrouping data for each countries
CLV <- rbind(Camb,Lao,Viet)
#We restore the column label real names
CLV <- copy_labels(CLV, HouseholdVietnam_2C)
colnames(CLV)[4:16] <- var_label(CLV)[4:16]
pond <- sum(CLV$Weight)
pond2 <- sum(CLV$Weight)
xT <- "Animals"
ylimn <- -10
ylimx <- 100
dig = 0
pal = "Dark2"
PracticePlot(CLV,pond,pond2,xT,ylimn,ylimx,dig,pal)
}
```

## IV.2. Data analysis for Agroecological principles

### IV.2.1 - Recycling
```{r IV.2.1, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.1.a. d17. Does your household use ecological/agroecological/integrated practices...
cat('\n####',"IV.2.1.a. d17. Does your household use ecological/agroecological/integrated practices to maintain/enhance soil fertility in your fields?", '\n')
#We prepare the data of each country
Camb <- HouseholdCambodia_2C[,c(20,32,1104,2658,2659)]
Lao <- HouseholdLaos_2C[,c(19,28,1066,2396,2397)]
Viet <- HouseholdVietnam_2C[,c(20,32,1112,2832,2833)]
#We merge a table regrouping data for each countries
CLV <- rbind(Camb,Lao,Viet)
CLV$d17 <- as.character(CLV$d17)
CLV$d17[CLV$d17 == "1"] <- "Yes"
CLV$d17[CLV$d17 == "2"] <- "Yes"
CLV$d17[CLV$d17 == "0"] <- "No"
CLV$d17[CLV$d17 == "88"] <- "Do not know"
CLV$d17[CLV$d17 == ""] <- "NC"
colnames(CLV)[3] <- 'Answer'
#Function parameters
pond <- sum(CLV$Weight)
xT <- "Answer"
ylimn <- 0
dig <- 0
pal <- "Greens"
#Now we create the table with the corresponding function
ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
cat('\n')

# # #IV.2.1.b. d18 - Which of the following ecological/agroecological/integrated practices
#does your household use to maintain/enhance soil fertility in your fields?
cat('\n####',"IV.2.1.b. d18 - Which of the following ecological/agroecological/integrated practices does your household use to maintain/enhance soil fertility in your fields?", '\n')
#We prepare the data of each country
Camb <- HouseholdCambodia_2C[,c(1,20,32,1106:1117,2658,2659)]
for (i in 4:15){
  Camb[,i] <- as.character(Camb[,i])
}
Lao <- HouseholdLaos_2C[,c(1,19,28,1068:1079,2396,2397)]
for (i in 4:15){
  Lao[,i] <- as.character(Lao[,i])
}
Viet <- HouseholdVietnam_2C[,c(1,20,32,1114:1125,2832,2833)]
for (i in 4:15){
  Viet[,i] <- as.character(Viet[,i])
}
#We merge a table regrouping data for each countries
CLV2 <- rbind(Camb,Lao,Viet)
#We restore the column label real names
CLV2 <- copy_labels(CLV2, HouseholdVietnam_2C)
#We fulfil the information required in the function
#First, we select the useful data
#We modify long label names
var_label(CLV2$d183) <- 'Bokashi (fermented\norganic matter)'
var_label(CLV2$d184) <- 'Legume-based\ngreen manure'
var_label(CLV2$d185) <- 'Pulses in association\nand/or rotation\nwith main crop'
var_label(CLV2$d186) <- 'Cover crops in\nassociation and/\nor rotation\nwith main crop'
var_label(CLV2$d188) <- 'Crop residue\nmaintenance'
var_label(CLV2$d189) <- 'Recycling\ncrop waste'
var_label(CLV2$d1810) <- 'Ramial Wood Chip\n (RWC) or other\nwood chips'
var_label(CLV2$d1811) <- 'Organic agro-\nindustrial waste'
colnames(CLV2)[4:15] <- var_label(CLV2)[4:15]
pond <- sum(CLV2$Weight)
pond2 <- sum(CLV2$Weight)
xT <- "Practices"
ylimn <- -15
ylimx <- 100
dig = 0
pal = "Greens"
PracticePlot(CLV2,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
}
```

### IV.2.2 - Input reduction
```{r IV.2.2, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.2.a. d20. Does your household use any ecological/ agroecological/ integrated practices to control weeds in your fields?
  cat('\n####',"IV.2.2.a. d20. Does your household use any ecological/ agroecological/ integrated practices to control weeds in your fields?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,1324,2658,2659)]
  Camb$d20 <- as.character(Camb$d20)
  Lao <- HouseholdLaos_2C[,c(19,28,1250,2396,2397)]
  Lao$d20 <- as.character(Lao$d20)
  Viet <- HouseholdVietnam_2C[,c(20,32,1296,2832,2833)]
  Viet$d20 <- as.character(Viet$d20)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$d20[CLV$d20 == "1"] <- "Yes"
  CLV$d20[CLV$d20 == "0"] <- "No"
  CLV$d20[CLV$d20 == "88"] <- "Do not know"
  CLV$d20[CLV$d20 == ""] <- "NC"
  CLV$d20[is.na(CLV$d20)] <- "NC"
  colnames(CLV)[3] <- 'Answer'
  #Function parameters
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')

# # #IV.2.2.b. d21. Which of the following ecological/agroecological/integrated practices
#does your household use to control weeds in your fields?
  cat('\n####',"IV.2.2.b. d21. Which of the following ecological/agroecological/integrated practices does your household use to control weeds in your fields?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(1,20,32,1326:1340,2658,2659)]
  for (i in 4:18){
    Camb[,i] <- as.character(Camb[,i])
  }
  Lao <- HouseholdLaos_2C[,c(1,19,28,1252:1266,2396,2397)]
  for (i in 4:18){
    Lao[,i] <- as.character(Lao[,i])
  }
  Viet <- HouseholdVietnam_2C[,c(1,20,32,1298:1312,2832,2833)]
  for (i in 4:18){
    Viet[,i] <- as.character(Viet[,i])
  }
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  #We restore the column label real names
  CLV <- copy_labels(CLV, HouseholdVietnam_2C)
#We modify long label names
var_label(CLV$d211) <- "Crop rotation /\n intercropping"
var_label(CLV$d214) <- "Sowing date /\n rate / depth"
var_label(CLV$d215) <- "Crop spatial\n arrangement"
var_label(CLV$d216) <- "Seed cleaning\n before sowing"
var_label(CLV$d2114) <- "Post harvest\n weed seed destruction\n in field"
colnames(CLV)[4:18] <- var_label(CLV)[4:18]
pond <- sum(CLV$Weight)
pond2 <- sum(CLV$Weight)
xT <- "Practices"
ylimn <- -25
ylimx <- 100
dig = 0
pal = "Dark2"
#Function call
PracticePlot(CLV,pond,pond2,xT,ylimn,ylimx,dig,pal)
cat('\n')
}
```
  
### IV.2.3 - Soil health

```{r IV.2.3, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
# # #IV.2.3.a. Soil conservation practices Yes or No
  cat('\n####',"IV.2.3.a. Soil conservation practices Yes or No", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,957,2658,2659)]
  Camb$d140 <- as.character(Camb$d140)
  Lao <- HouseholdLaos_2C[,c(19,28,943,2396,2397)]
  Lao$d140 <- as.character(Lao$d140)
  Viet <- HouseholdVietnam_2C[,c(20,32,989,2832,2833)]
  Viet$d140 <- as.character(Viet$d140)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$d140[CLV$d140 == "1"] <- "No"
  CLV$d140[CLV$d140 == "0"] <- "Yes"
  CLV$d140[is.na(CLV$d140)] <- "NC"
  colnames(CLV)[3] <- 'Answer'
  #Function parameters
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  #We order the answers
  pal = "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')

# # #IV.2.3.b. d14. Which of the following soil conservation practices do you use ?
  #We prepare the data of each country
  cat('\n####',"IV.2.3.b. d14. Which of the following soil conservation practices do you use ?", '\n')
  Camb <- HouseholdCambodia_2C[,c(1,20,32,958:965,2658,2659)]
  for (i in 4:11){
    Camb[,i] <- as.character(Camb[,i])
  }
  Lao <- HouseholdLaos_2C[,c(1,19,28,944:951,2396,2397)]
  for (i in 4:11){
    Lao[,i] <- as.character(Lao[,i])
  }
  Viet <- HouseholdVietnam_2C[,c(1,20,32,990:997,2832,2833)]
  for (i in 4:11){
    Viet[,i] <- as.character(Viet[,i])
  }
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  #We restore the column label real names
  CLV <- copy_labels(CLV, HouseholdVietnam_2C)
  #We modify long label names
  var_label(CLV$d141) <-  "Sowing in \ncontour lines"
  var_label(CLV$d142) <- "Natural or planted\n grass strips"
  var_label(CLV$d143) <- "Trees conservation \nin agricultural plots"
  var_label(CLV$d144) <- "Agroforestry \n(trees + crops)"
  var_label(CLV$d145) <- "Crop residues\n maintained to\n cover the soil"
  var_label(CLV$d147) <- "Reduced to\n no-tillage"
  colnames(CLV)[4:11] <- var_label(CLV)[4:11]
  pond <- sum(CLV$Weight)
  pond2 <- sum(CLV$Weight)
  xT <- "Practices"
  ylimn <- -10
  ylimx <- 50
  dig = 0
  pal = "Dark2"
  PracticePlot(CLV,pond,pond2,xT,ylimn,ylimx,dig,pal)
  cat('\n')
```

### IV.2.4 - Animal health

```{r IV.2.4, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.4.a. e58. Can you see the Ribs/ Bones of the ruminants, in the past 1 year?
  cat('\n####',"IV.2.4.a. e58. Can you see the Ribs/ Bones of the ruminants, in the past 1 year?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,2349,2658,2659)]
  Camb$e58 <- as.character(Camb$e58)
  Lao <- HouseholdLaos_2C[,c(19,28,2131,2396,2397)]
  Lao$e58 <- as.character(Lao$e58)
  Viet <- HouseholdVietnam_2C[,c(20,32,2165,2832,2833)]
  Viet$e58 <- as.character(Viet$e58)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$e58[CLV$e58 == "0"] <- "No"
  CLV$e58[CLV$e58 == "1"] <- "Yes"
  CLV$e58[is.na(CLV$e58)] <- "NC"
  CLV$e58[CLV$e58 == ''] <- "NC"
  colnames(CLV)[3] <- 'Answer'
  #Function parameters
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal <- "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')
  
  # # #IV.2.4.b. e59. Is there any month in the year when there is a lack of feed for the animals?
  cat('\n####',"IV.2.4.b. e59. Is there any month in the year when there is a lack of feed for the animals?", '\n')
  Camb <- HouseholdCambodia_2C[,c(20,32,2363,2658,2659)]
  Camb$e59 <- as.character(Camb$e59)
  Lao <- HouseholdLaos_2C[,c(19,28,2145,2396,2397)]
  Lao$e59 <- as.character(Lao$e59)
  Viet <- HouseholdVietnam_2C[,c(20,32,2179,2832,2833)]
  Viet$e59 <- as.character(Viet$e59)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$e59[CLV$e59 == "0"] <- "No"
  CLV$e59[CLV$e59 == "1"] <- "Yes"
  CLV$e59[is.na(CLV$e59)] <- "NC"
  CLV$e59[CLV$e59 == ''] <- "NC"
  colnames(CLV)[3] <- 'Answer'
  #Function parameters
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal <- "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')
}
```

### IV.2.5 - Biodiversity
```{r IV.2.5, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.5.a d32. Do you conserve and use traditional/local seeds?
  cat('\n####',"IV.2.5.a d32. Do you conserve and use traditional/local seeds?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,1942,2658,2659)]
  Camb$d32<- as.character(Camb$d32)
  Lao <- HouseholdLaos_2C[,c(19,28,1751,2396,2397)]
  Lao$d32 <- as.character(Lao$d32)
  Viet <- HouseholdVietnam_2C[,c(20,32,1784,2832,2833)]
  Viet$d32 <- as.character(Viet$d32)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$d32[CLV$d32 == "0"] <- "No"
  CLV$d32[CLV$d32 == "1"] <- "Yes"
  CLV$d32[is.na(CLV$d32)] <- "NC"
  CLV$d32[CLV$d32 == ''] <- "NC"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal <- "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')
}
```

### IV.2.6 - Synergy
```{r IV.2.6, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.6.a. d26. Does your household use agroecological/integrated practices to control pests and disease in your fields?
  cat('\n####',"IV.2.6.a. d26. Does your household use agroecological/integrated practices to control pests and disease in your fields?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,1601,2658,2659)]
  Camb$d26<- as.character(Camb$d26)
  Lao <- HouseholdLaos_2C[,c(19,28,1482,2396,2397)]
  Lao$d26 <- as.character(Lao$d26)
  Viet <- HouseholdVietnam_2C[,c(20,32,1515,2832,2833)]
  Viet$d26 <- as.character(Viet$d26)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$d26[CLV$d26 == "0"] <- "No"
  CLV$d26[CLV$d26 == "1"] <- "Yes"
  CLV$d26[CLV$d26 == "88"] <- "Do not know"
  CLV$d26[is.na(CLV$d26)] <- "NC"
  CLV$d26[CLV$d26 == ''] <- "NC"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')

# # #IV.2.6.b. d27. Which ecological/agroecological/integrated practices do you
#use to control pets and diseases in your fields?
  cat('\n####',"IV.2.6.b. d27. Which ecological/agroecological/integrated practices do you use to control pets and diseases in your fields?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(1,20,32,1603:1616,1618,2658,2659)]
  for (i in 4:18){
    Camb[,i] <- as.character(Camb[,i])
  }
  Lao <- HouseholdLaos_2C[,c(1,19,28,1484:1498,2396,2397)]
  for (i in 4:18){
    Lao[,i] <- as.character(Lao[,i])
  }
  Viet <- HouseholdVietnam_2C[,c(1,20,32,1517:1531,2832,2833)]
  for (i in 4:18){
    Viet[,i] <- as.character(Viet[,i])
  }
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  #We restore the column label real names
  CLV <- copy_labels(CLV, HouseholdVietnam_2C)
  #We modify long label names
  var_label(CLV$d271) <- "Crop rotation /\n intercropping"
  var_label(CLV$d274) <- "Soil health maintenance/\nimprovement"
  var_label(CLV$d275) <- "Sanitation practices (removal of damaged/\ninfected plants and fruits)"
  var_label(CLV$d277) <- "Water and nutrient\n management"
  var_label(CLV$d278) <- "Cultivar choice (tolerant/\nresistant) / cultivar mixture"
  var_label(CLV$d279) <- "Biopesticide /\n organic pesticide"
  var_label(CLV$d2710) <- "BCAs"
  var_label(CLV$d2711) <- "Home-made efficient\n microorganism (EM)"
  var_label(CLV$d2712) <- "Commercial efficient\n microorganism (EM)"
  colnames(CLV)[4:18] <- var_label(CLV)[4:18]
  pond <- sum(CLV$Weight)
  pond2 <- sum(CLV$Weight)
  xT <- "Practices"
  ylimn <- -40
  ylimx <- 40
  dig = 0
  pal = "Dark2"
  #Function call
  PracticePlot(CLV,pond,pond2,xT,ylimn,ylimx,dig,pal)
  cat('\n')
}
```

### IV.2.7 - Economic diversification
```{r IV.2.7, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.7.a. b9.Are there specific months of the year in which you face financial difficulties?
  cat('\n####',"IV.2.7.a. b9.Are there specific months of the year in which you face financial difficulties?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,171,2658,2659)]
  Camb$b9<- as.character(Camb$b9)
  Lao <- HouseholdLaos_2C[,c(19,28,157,2396,2397)]
  Lao$b9 <- as.character(Lao$b9)
  Viet <- HouseholdVietnam_2C[,c(20,32,194,2832,2833)]
  Viet$b9 <- as.character(Viet$b9)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$b9[CLV$b9 == "0"] <- "No"
  CLV$b9[CLV$b9 == "1"] <- "Yes"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')

# # #IV.2.7.b. b9_1. If yes to b9, which months?
   cat('\n####',"IV.2.7.b. b9_1. If yes to b9, which months?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(1,20,32,173:184,2658,2659)]
  for (i in 4:15){
    Camb[,i] <- as.character(Camb[,i])
  }
  Lao <- HouseholdLaos_2C[,c(1,19,28,159:170,2396,2397)]
  for (i in 4:15){
    Lao[,i] <- as.character(Lao[,i])
  }
  Viet <- HouseholdVietnam_2C[,c(1,20,32,196:207,2832,2833)]
  for (i in 4:15){
    Viet[,i] <- as.character(Viet[,i])
  }
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  #We restore the column label real names
  CLV <- copy_labels(CLV, HouseholdVietnam_2C)
  colnames(CLV)[4:15] <- var_label(CLV)[4:15]
  pond <- sum(CLV$Weight)
  pond2 <- sum(CLV$Weight)
  xT <- "Months"
  ylimn <- 0
  ylimx <- 60
  dig = 0
  pal = "Dark2"
  PracticePlot(CLV,pond,pond2,xT,ylimn,ylimx,dig,pal)
  cat('\n')
}
```

### IV.2.8 - Co-creation of knowledge
```{r IV.2.8, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.8.a. c14. Do you exchange your agricultural products ?
  cat('\n####',"IV.2.8.a. c14. Do you exchange your agricultural products ?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,578,2658,2659)]
  Camb$c14<- as.character(Camb$c14)
  Lao <- HouseholdLaos_2C[,c(19,28,614,2396,2397)]
  Lao$c14 <- as.character(Lao$c14)
  Viet <- HouseholdVietnam_2C[,c(20,32,658,2832,2833)]
  Viet$c14 <- as.character(Viet$c14)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$c14[CLV$c14 == "0"] <- "No"
  CLV$c14[CLV$c14 == "1"] <- "Yes"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')

  # # #IV.2.8.b. f4. Do you have sufficient time to acquire new knowledge
  #and improve your skills?
  cat('\n####',"IV.2.8.b. f4. Do you have sufficient time to acquire new knowledge
  and improve your skills?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,2381,2658,2659)]
  Camb$f4<- as.character(Camb$f4)
  Lao <- HouseholdLaos_2C[,c(19,28,2163,2396,2397)]
  Lao$f4 <- as.character(Lao$f4)
  Viet <- HouseholdVietnam_2C[,c(20,32,2197,2832,2833)]
  Viet$f4 <- as.character(Viet$f4)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$f4[CLV$f4 == "No time"] <- "1.No time"
  CLV$f4[CLV$f4 == "Very little time"] <- "2.Very little time"
  CLV$f4[CLV$f4 == "Moderate amount of time"] <- "3.Moderate amount of time"
  CLV$f4[CLV$f4 == "Almost enough time"] <- "4.Almost enough time"
  CLV$f4[CLV$f4 == "Sufficient amount of time"] <- "5.Sufficient amount of time"
  CLV$f4[CLV$f4 == "Do not know"] <- "6.Do not know"
  CLV$f4[CLV$f4 == "1"] <- "1.No time"
  CLV$f4[CLV$f4 == "2"] <- "2.Very little time"
  CLV$f4[CLV$f4 == "3"] <- "3.Moderate amount of time"
  CLV$f4[CLV$f4 == "4"] <- "4.Almost enough time"
  CLV$f4[CLV$f4 == "5"] <- "5.Sufficient amount of time"
  CLV$f4[CLV$f4 == "88"] <- "6.Do not know"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')
}
```

### IV.2.9 - Social value and diet

```{r IV.2.9, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.9.a. i1. In general, what is the proportion of the food (rice, vegetable, animal products, etc.) consumed by your family that comes from your own farm or homegarden?
  cat('\n####',"IV.2.9.a. i1. In general, what is the proportion of the food (rice, vegetable, animal products, etc.) consumed by your family that comes from your own farm or homegarden?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,2406,2658,2659)]
  Camb$i1<- as.character(Camb$i1)
  Lao <- HouseholdLaos_2C[,c(19,28,2189,2396,2397)]
  Lao$i1 <- as.character(Lao$i1)
  Viet <- HouseholdVietnam_2C[,c(20,32,2222,2832,2833)]
  Viet$i1 <- as.character(Viet$i1)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$i1[CLV$i1 == "Less than 25%"] <- "1.Less than 25%"
  CLV$i1[CLV$i1 == "25-50%"] <- "2.25-50%"
  CLV$i1[CLV$i1 == "50-75%"] <- "3.50-75%"
  CLV$i1[CLV$i1 == "Over 75%"] <- "4.Over 75%"
  CLV$i1[CLV$i1 == "Do not know"] <- "5.Do not know"
  CLV$i1[CLV$i1 == "1"] <- "1.Less than 25%"
  CLV$i1[CLV$i1 == "2"] <- "2.25-50%"
  CLV$i1[CLV$i1 == "3"] <- "3.50-75%"
  CLV$i1[CLV$i1 == "4"] <- "4.Over 75%"
  CLV$i1[CLV$i1 == "Do not know"] <- "5.Do not know"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')

# # #IV.2.9.b g5. Do you think the working hours (including household chores and taking 
#care of family members) across family members are equitably distributed?
  cat('\n####',"IV.2.9.b g5. Do you think the working hours (including household chores and taking care of family members) across family members are equitably distributed?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,2387,2658,2659)]
  Camb$g5<- as.character(Camb$g5)
  Lao <- HouseholdLaos_2C[,c(19,28,2169,2396,2397)]
  Lao$g5 <- as.character(Lao$g5)
  Viet <- HouseholdVietnam_2C[,c(20,32,2203,2832,2833)]
  Viet$g5 <- as.character(Viet$g5)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$g5[CLV$g5 == "0"] <- "No"
  CLV$g5[CLV$g5 == "1"] <- "Yes"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')
}
```

### IV.2.10 - Fairness
```{r IV.2.10, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.10.a. b22. Did you sell any certified crop/vegetables/fruit/livestock
#related product in the past year/12 months?
cat('\n####',"IV.2.10.a. b22. Did you sell any certified crop/vegetables/fruit/livestock related product in the past year/12 months?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,225,2658,2659)]
  Camb$b22<- as.character(Camb$b22)
  Lao <- HouseholdLaos_2C[,c(19,28,206,2396,2397)]
  Lao$b22 <- as.character(Lao$b22)
  Viet <- HouseholdVietnam_2C[,c(20,32,243,2832,2833)]
  Viet$b22 <- as.character(Viet$b22)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$b22[CLV$b22 == "0"] <- "No"
  CLV$b22[CLV$b22 == "1"] <- "Yes"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the table with the corresponding function
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')
 }
```

### IV.2.11 - Connectivity

```{r IV.2.11, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.11.a. c13. Do you collaborate with other people for any task ?
  cat('\n####',"IV.2.11.a. c13. Do you collaborate with other people for any task ?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(1,20,32,569:574,576,2658,2659)]
  for (i in 4:10){
    Camb[,i] <- as.character(Camb[,i])
  }
  Lao <- HouseholdLaos_2C[,c(1,19,28,605:610,612,2396,2397)]
  for (i in 4:10){
    Lao[,i] <- as.character(Lao[,i])
  }
  Viet <- HouseholdVietnam_2C[,c(1,20,32,647:652,655,2832,2833)]
  for (i in 4:10){
    Viet[,i] <- as.character(Viet[,i])
  }
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  #We restore the column label real names
  CLV <- copy_labels(CLV, HouseholdVietnam_2C)
  #We fulfil the information required in the function
  #We modify long label names
  var_label(CLV$c131) <- "Share labor (mutual\n help, working together\n on each other farm)"
  var_label(CLV$c132) <- "Manage water/\nirrigation systems"
  var_label(CLV$c134) <- "Buy agricultural\n inputs"
  var_label(CLV$c135) <- "Selling products\n to the markets for\n other farmers"
  var_label(CLV$c136) <- "Experiment new\n farming practices"
  colnames(CLV)[4:10] <- var_label(CLV)[4:10]
  #We prepare the parameters for the function
  pond <- sum(CLV$Weight)
  pond2 <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- -20
  ylimx <- 100
  dig = 0
  pal = "Dark2"
  #Function Call
  PracticePlot(CLV,pond,pond2,xT,ylimn,ylimx,dig,pal)
  cat('\n')

  # # #IV.2.11.b f3.Do you have enough time for your family and your social relationships?
    cat('\n####',"IV.2.11.b. f3.Do you have enough time for your family and your social relationships?", '\n')
  #We create a counting table and a title
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,2380,2658,2659)]
  Camb$f3<- as.character(Camb$f3)
  Lao <- HouseholdLaos_2C[,c(19,28,2162,2396,2397)]
  Lao$f3 <- as.character(Lao$f3)
  Viet <- HouseholdVietnam_2C[,c(20,32,2196,2832,2833)]
  Viet$f3 <- as.character(Viet$f3)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$f3[CLV$f3 == "No time"] <- "1.No time"
  CLV$f3[CLV$f3 == "Very little time"] <- "2.Very little time"
  CLV$f3[CLV$f3 == "Moderate amount of time"] <- "3.Moderate amount of time"
  CLV$f3[CLV$f3 == "Almost enough time"] <- "4.Almost enough time"
  CLV$f3[CLV$f3 == "Sufficient amount of time"] <- "5.Sufficient amount of time"
  CLV$f3[CLV$f3 == "Do not know"] <- "6.Do not know"
  CLV$f3[CLV$f3 == "1"] <- "1.No time"
  CLV$f3[CLV$f3 == "2"] <- "2.Very little time"
  CLV$f3[CLV$f3 == "3"] <- "3.Moderate amount of time"
  CLV$f3[CLV$f3 == "4"] <- "4.Almost enough time"
  CLV$f3[CLV$f3 == "5"] <- "5.Sufficient amount of time"
  CLV$f3[CLV$f3 == "88"] <- "6.Do not know"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT = "Answer"
  ylimn <- -20
  pal <- "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')
 }
```

### IV.2.12 - Land and natural resource governance
```{r IV.2.12, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
  {
  # # #3.12.a. l1. In the past year/12 months, did your household benefit from government
  #subsidies to support investment in production or Counercialization activities?
  cat('\n####',"IV.2.12.a. b22. Did you sell any certified crop/vegetables/fruit/livestock related product in the past year/12 months?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,2485,2658,2659)]
  Camb$l1<- as.character(Camb$l1)
  Lao <- HouseholdLaos_2C[,c(19,28,2268,2396,2397)]
  Lao$l1 <- as.character(Lao$l1)
  Viet <- HouseholdVietnam_2C[,c(20,32,2301,2832,2833)]
  Viet$l1 <- as.character(Viet$l1)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$l1[CLV$l1 == "0"] <- "No"
  CLV$l1[CLV$l1 == "1"] <- "Yes"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  #We create a counting table and a title
  xT = "Answer"
  ylimn <- -20
  pal <- "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')

  # # #IV.2.12.b. d9-10-11. Land ownership
  cat('\n####',"IV.2.12.b. d9-10-11. Land ownership", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(1,20,32,790,793,796,2658,2659)]
  for (i in 4:6){
    Camb[,i] <- as.character(Camb[,i])
  }
  Lao <- HouseholdLaos_2C[,c(1,19,28,804,806,808,2396,2397)]
  for (i in 4:6){
    Lao[,i] <- as.character(Lao[,i])
  }
  Viet <- HouseholdVietnam_2C[,c(1,20,32,847,849,851,2832,2833)]
  for (i in 4:6){
    Viet[,i] <- as.character(Viet[,i])
  }
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
    CLV$d9_1[CLV$d9_1 == "No"] <- "0"
    CLV$d9_1[CLV$d9_1 == "Yes"] <- "1"
    CLV$d10_1[CLV$d10_1 == "No"] <- "0"
    CLV$d10_1[CLV$d10_1 == "Yes"] <- "1"
    CLV$d11_1[CLV$d11_1 == "No"] <- "0"
    CLV$d11_1[CLV$d11_1 == "Yes"] <- "1"
  #We restore the column label real names
  CLV <- copy_labels(CLV, HouseholdVietnam_2C)
  #First, we select the useful data
  #We modify long label names
  var_label(CLV$d9_1) <- "Having plots\n rented-in?"
  var_label(CLV$d10_1) <- "Having plots\n rented-out?"
  var_label(CLV$d11_1) <- "Having plots\n owned?"
  colnames(CLV)[4:6] <- var_label(CLV)[4:6]
  #We prepare the parameters for the function
  pond <- sum(CLV$Weight)
  pond2 <- sum(CLV$Weight)
  xT <- ""
  ylimn <- -10
  ylimx <- 120
  dig = 1
  pal = "Dark2"
  #Function call
  PracticePlot(CLV,pond,pond2,xT,ylimn,ylimx,dig,pal)
  cat('\n')
  }
```

### IV.2.13 - Participation
```{r IV.2.13, include=TRUE, echo = FALSE, message = FALSE, warning = FALSE, results='asis',fig.dim = c(10, 6)}
{
# # #IV.2.13.a. c2. Are you a member of one or more farmer organization (e.g. crops/fruits/
#livestock/honey/ water/Forest etc)?
  cat('\n####',"IV.2.13.a. c2. Are you a member of one or more farmer organization (e.g. crops/fruits/livestock/honey/ water/Forest etc)?", '\n')
  #We prepare the data of each country
  Camb <- HouseholdCambodia_2C[,c(20,32,498,2658,2659)]
  Camb$c2<- as.character(Camb$c2)
  Lao <- HouseholdLaos_2C[,c(19,28,552,2396,2397)]
  Lao$c2 <- as.character(Lao$c2)
  Viet <- HouseholdVietnam_2C[,c(20,32,591,2832,2833)]
  Viet$c2 <- as.character(Viet$c2)
  #We merge a table regrouping data for each countries
  CLV <- rbind(Camb,Lao,Viet)
  CLV$c2[CLV$c2 == "No"] <- "1.No"
  CLV$c2[CLV$c2 == "Yes, one"] <- "2.Yes, one"
  CLV$c2[CLV$c2 == "Yes, more than one"] <- "3.Yes, more than one"
  CLV$c2[CLV$c2 == "0"] <- "1.No"
  CLV$c2[CLV$c2 == "1"] <- "2.Yes, one"
  CLV$c2[CLV$c2 == "2"] <- "3.Yes, more than one"
  colnames(CLV)[3] <- 'Answer'
  pond <- sum(CLV$Weight)
  xT <- "Answer"
  ylimn <- 0
  dig <- 0
  pal = "Greens"
  #Now we create the table with the corresponding function
  ListBPlotCounYN(CLV,pond,ylimn,dig,pal)
  cat('\n')
}
```
